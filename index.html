<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuoteFlow Pro - Ultimate Business Document Generator</title>
    <meta name="description" content="Professional business document generator with unlimited storage, cloud sync, and advanced analytics">
    <meta name="keywords" content="quotation, invoice, receipt, business app, PDF generator, unlimited storage">
    
    <!-- External Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #2c3e50;
            line-height: 1.6;
            padding-bottom: 80px;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ===== ENHANCED HEADER SECTION ===== */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
            margin-bottom: 30px;
            min-height: 250px;
            display: flex;
            flex-direction: column;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 4s infinite;
        }

        /* Floating Action Cards */
        .floating-cards {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
            z-index: 2;
        }

        .floating-card {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            min-width: 70px;
        }

        .floating-card:hover {
            transform: translateY(-5px) scale(1.05);
            background: rgba(255,255,255,0.3);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .floating-card-icon {
            font-size: 24px;
            margin-bottom: 5px;
            display: block;
        }

        .floating-card-text {
            font-size: 11px;
            font-weight: 600;
            line-height: 1.2;
        }

        /* Main Header Content */
        .header-main {
            flex: 1;
            padding: 40px 30px 30px 30px;
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .header-top {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .app-logo {
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.2);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            border: 2px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(10px);
        }

        .header-text {
            flex: 1;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            font-size: 16px;
            opacity: 0.95;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        /* Status Bar */
        .status-bar {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 25px;
            margin-top: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
        }

        .status-icon {
            font-size: 16px;
        }

        /* Quick Stats */
        .quick-stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }

        .stat-item {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 12px 16px;
            border: 1px solid rgba(255,255,255,0.2);
            text-align: center;
            flex: 1;
        }

        .stat-number {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .stat-label {
            font-size: 11px;
            opacity: 0.9;
        }

        /* ===== PROGRESS INDICATOR ===== */
        .progress-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .progress-circle {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 3px solid transparent;
        }

        .progress-circle.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.15);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .progress-circle.completed {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            transform: scale(1.05);
        }

        .progress-circle.inactive {
            background: #e0e6ed;
            color: #7f8c8d;
        }

        .progress-arrow {
            font-size: 24px;
            color: #7f8c8d;
            margin: 0 20px;
            animation: pulse 2s infinite;
        }

        .progress-label {
            font-size: 13px;
            font-weight: 600;
            color: #2c3e50;
            text-align: center;
        }

        /* ===== DOCUMENT NAVIGATION ===== */
        .document-nav {
            display: flex;
            background: white;
            border-radius: 20px;
            padding: 8px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .document-nav-btn {
            flex: 1;
            padding: 20px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: transparent;
            color: #7f8c8d;
            position: relative;
            overflow: hidden;
        }

        .document-nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }

        .document-nav-btn:hover::before {
            left: 100%;
        }

        .document-nav-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .document-nav-btn.invoice.active {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.3);
        }

        .document-nav-btn.receipt.active {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            box-shadow: 0 8px 25px rgba(168, 237, 234, 0.3);
        }

        /* ===== PAGE SYSTEM ===== */
        .page {
            display: none;
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== CARD SYSTEM ===== */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
        }

        .card-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 50px;
            height: 3px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        /* ===== FORM SYSTEM ===== */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
            transition: color 0.3s ease;
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e0e6ed;
            border-radius: 12px;
            font-size: 16px;
            background: rgba(255,255,255,0.9);
            color: #2c3e50;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        /* ===== BUTTON SYSTEM ===== */
        .btn {
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(79, 172, 254, 0.4);
        }

        .btn-next {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            font-size: 18px;
            padding: 20px 40px;
        }

        .btn-next:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(255, 154, 158, 0.3);
        }

        .btn-back {
            background: #6c757d;
            color: white;
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.3);
        }

        .btn-back:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(108, 117, 125, 0.4);
        }

        /* ===== STATUS BADGES ===== */
        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 15px;
        }

        .status-quote {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .status-invoice {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .status-receipt {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: white;
        }

        /* ===== LOGO UPLOAD SYSTEM ===== */
        .logo-upload {
            border: 3px dashed #667eea;
            border-radius: 16px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            margin-bottom: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .logo-upload::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.3s ease;
            opacity: 0;
        }

        .logo-upload:hover::before {
            opacity: 1;
            animation: shimmer 1.5s ease-in-out;
        }

        .logo-upload:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.2);
            border-color: #764ba2;
        }

        .logo-preview {
            max-width: 150px;
            max-height: 80px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .logo-preview:hover {
            transform: scale(1.05);
        }

        .logo-icon {
            font-size: 48px;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-text {
            font-size: 16px;
            color: #7f8c8d;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .logo-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .logo-actions .btn {
            margin: 0;
            padding: 12px 20px;
            font-size: 14px;
        }

        /* ===== LINE ITEMS ===== */
        .line-items {
            background: rgba(255,255,255,0.7);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .line-item {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(255,255,255,0.3);
            position: relative;
            transition: all 0.3s ease;
        }

        .line-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 0 4px 4px 0;
        }

        .line-item:hover {
            transform: translateX(5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.12);
        }

        .line-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .item-number {
            font-size: 12px;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 8px 16px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .remove-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(255, 154, 158, 0.4);
        }

        .total-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 15px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 18px;
            margin-top: 15px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .totals-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            margin: 25px 0;
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
            position: relative;
            overflow: hidden;
        }

        .totals-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 4s infinite;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 16px;
            position: relative;
            z-index: 1;
        }

        .total-row:last-child {
            border-top: 2px solid rgba(255,255,255,0.3);
            padding-top: 15px;
            font-size: 22px;
            font-weight: 700;
            margin-top: 15px;
        }

        .tax-input {
            width: 80px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            text-align: center;
            border-radius: 8px;
            padding: 8px;
            font-size: 16px;
            backdrop-filter: blur(10px);
        }

        .tax-input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        /* ===== PAYMENT METHODS ===== */
        .payment-method-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .payment-method {
            padding: 15px;
            border: 2px solid #e0e6ed;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .payment-method:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .payment-method.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .payment-method-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .payment-method-text {
            font-size: 12px;
            font-weight: 600;
            color: #2c3e50;
        }

        /* ===== REVIEW PAGE STYLES ===== */
        .review-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .review-summary::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 4s infinite;
        }

        .review-summary h2 {
            font-size: 28px;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .review-summary p {
            font-size: 16px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .review-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        .review-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .review-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .review-section-title {
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e6ed;
        }

        .review-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .review-label {
            font-weight: 600;
            color: #34495e;
        }

        .review-value {
            color: #2c3e50;
            text-align: right;
            max-width: 60%;
            word-wrap: break-word;
        }

        .review-items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .review-items-table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #e0e6ed;
        }

        .review-items-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #f8f9fa;
            color: #34495e;
        }

        .review-items-table tbody tr:hover {
            background: #f8f9fa;
        }

        .review-total-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            margin-bottom: 30px;
        }

        .review-total-amount {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .review-total-label {
            font-size: 14px;
            opacity: 0.9;
        }

        /* ===== ACTION BUTTONS ===== */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .action-btn {
            padding: 20px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            text-align: center;
        }

        .action-btn-icon {
            font-size: 32px;
        }

        .action-btn-text {
            font-size: 16px;
        }

        .action-btn-desc {
            font-size: 12px;
            opacity: 0.8;
        }

        .action-generate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .action-generate:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .action-edit {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            box-shadow: 0 10px 30px rgba(108, 117, 125, 0.3);
        }

        .action-edit:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(108, 117, 125, 0.4);
        }

        /* ===== SHARE OPTIONS ===== */
        .share-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .share-btn {
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            text-align: center;
        }

        .share-btn-icon {
            font-size: 24px;
        }

        .share-download {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .share-share {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .share-email {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: white;
        }

        .share-print {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: white;
        }

        .share-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        /* ===== FLOATING ACTION BUTTONS ===== */
        .fab {
            position: fixed;
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
            z-index: 999;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.6);
        }

        .fab:active {
            transform: scale(0.95);
        }

        #addItemFab {
            bottom: 25px;
            right: 25px;
        }

        #storageManagementFab {
            bottom: 100px;
            right: 25px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            font-size: 24px;
        }

        #analyticsFab {
            bottom: 175px;
            right: 25px;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            font-size: 24px;
        }

        /* ===== STORAGE DASHBOARD ===== */
        .storage-dashboard {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .storage-dashboard::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 4s infinite;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
        }

        .dashboard-title {
            font-size: 24px;
            font-weight: 700;
            margin: 0;
        }

        .dashboard-subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin: 5px 0 0 0;
        }

        .storage-overview {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
        }

        .storage-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .storage-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card-icon {
            font-size: 32px;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .card-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .card-label {
            font-size: 12px;
            opacity: 0.8;
        }

        /* ===== MODAL SYSTEM ===== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: #f8f9fa;
            color: #2c3e50;
        }

        /* ===== NOTIFICATION SYSTEM ===== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 10001;
            animation: slideInRight 0.3s ease;
            max-width: 300px;
            word-wrap: break-word;
        }

        .notification.success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .notification.info {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .notification.warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ===== ANIMATIONS ===== */
        @keyframes shimmer {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        /* ===== LOADING ANIMATIONS ===== */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== SAVE INDICATOR ===== */
        .save-indicator {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 9999;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .save-indicator.saved {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
        }

        .save-indicator.saving {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
        }

        .save-indicator.error {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header {
                min-height: 200px;
            }

            .header-main {
                padding: 30px 20px 20px 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .header p {
                font-size: 14px;
            }

            .floating-cards {
                position: static;
                justify-content: center;
                margin-top: 20px;
                flex-wrap: wrap;
            }

            .floating-card {
                min-width: 60px;
                padding: 12px;
            }

            .floating-card-icon {
                font-size: 20px;
            }

            .floating-card-text {
                font-size: 10px;
            }

            .status-bar {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .quick-stats {
                flex-direction: column;
                gap: 10px;
            }

            .form-row, .form-row-3 {
                grid-template-columns: 1fr;
            }

            .review-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .action-buttons {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .share-options {
                grid-template-columns: repeat(2, 1fr);
            }

            .storage-overview {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .fab {
                width: 56px;
                height: 56px;
                font-size: 24px;
            }

            #addItemFab {
                bottom: 20px;
                right: 20px;
            }

            #storageManagementFab {
                bottom: 85px;
                right: 20px;
            }

            #analyticsFab {
                bottom: 150px;
                right: 20px;
            }

            .payment-method-grid {
                grid-template-columns: 1fr;
            }

            .document-nav-btn {
                font-size: 14px;
                padding: 15px 10px;
            }

            .progress-step {
                flex-direction: column;
                gap: 10px;
            }

            .progress-arrow {
                transform: rotate(90deg);
                margin: 5px 0;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 0;
            }

            .header-main {
                padding: 25px 15px 20px 15px;
            }

            .header-top {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .card {
                padding: 20px;
            }

            .review-items-table,
            .review-items-table thead,
            .review-items-table tbody,
            .review-items-table th,
            .review-items-table td,
            .review-items-table tr {
                display: block;
            }

            .review-items-table thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }

            .review-items-table tr {
                border: 1px solid #e0e6ed;
                margin-bottom: 10px;
                padding: 10px;
                border-radius: 8px;
                background: white;
            }

            .review-items-table td {
                border: none;
                position: relative;
                padding-left: 50%;
                text-align: right;
                padding-bottom: 8px;
            }

            .review-items-table td:before {
                content: attr(data-label) ": ";
                position: absolute;
                left: 6px;
                width: 45%;
                text-align: left;
                font-weight: bold;
                color: #2c3e50;
            }

            .share-options {
                grid-template-columns: 1fr;
            }
        }

        /* ===== UTILITY CLASSES ===== */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .hidden { display: none !important; }
        .visible { display: block !important; }
    </style>
</head>

<body>
    <div class="container">
        <!-- ===== ENHANCED MAIN HEADER ===== -->
        <header class="header">
            <!-- Floating Action Cards -->
            <div class="floating-cards">
                <div class="floating-card" onclick="openStorageManagement()" title="Storage Management">
                    <span class="floating-card-icon">üíæ</span>
                    <div class="floating-card-text">Unlimited Storage</div>
                </div>
                <div class="floating-card" onclick="forceSync()" title="Cloud Sync">
                    <span class="floating-card-icon">‚òÅÔ∏è</span>
                    <div class="floating-card-text">Cloud Sync</div>
                </div>
                <div class="floating-card" onclick="showAnalytics()" title="Analytics">
                    <span class="floating-card-icon">üìä</span>
                    <div class="floating-card-text">Analytics</div>
                </div>
                <div class="floating-card" onclick="viewDocumentHistory()" title="History">
                    <span class="floating-card-icon">üìã</span>
                    <div class="floating-card-text">History</div>
                </div>
            </div>

            <!-- Main Header Content -->
            <div class="header-main">
                <div class="header-top">
                    <div class="logo-section">
                        <div class="app-logo">üìÑ</div>
                        <div class="header-text">
                            <h1>QuoteFlow Pro Ultimate</h1>
                            <p>Professional Business Documents with Unlimited Storage & Cloud Sync</p>
                        </div>
                    </div>
                </div>

                <!-- Status Bar -->
                <div class="status-bar">
                    <div class="status-item">
                        <span class="status-icon">üîí</span>
                        <span>Secure & Encrypted</span>
                    </div>
                    <div class="status-item">
                        <span class="status-icon">‚ö°</span>
                        <span>Instant PDF Generation</span>
                    </div>
                    <div class="status-item">
                        <span class="status-icon">üì±</span>
                        <span>Mobile Responsive</span>
                    </div>
                    <div class="status-item">
                        <span class="status-icon">üåê</span>
                        <span>Multi-Currency</span>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="quick-stats">
                    <div class="stat-item">
                        <div class="stat-number" id="documentsCount">0</div>
                        <div class="stat-label">Documents</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">99.9%</div>
                        <div class="stat-label">Uptime</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">24/7</div>
                        <div class="stat-label">Support</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- ===== PROGRESS INDICATOR ===== -->
        <div class="progress-indicator">
            <div class="progress-step">
                <div class="progress-circle active" id="step1Circle">1</div>
                <div class="progress-label">Fill Details</div>
            </div>
            <div class="progress-arrow">‚Üí</div>
            <div class="progress-step">
                <div class="progress-circle inactive" id="step2Circle">2</div>
                <div class="progress-label">Review</div>
            </div>
            <div class="progress-arrow">‚Üí</div>
            <div class="progress-step">
                <div class="progress-circle inactive" id="step3Circle">3</div>
                <div class="progress-label">Share/Send</div>
            </div>
        </div>

        <!-- ===== DOCUMENT NAVIGATION ===== -->
        <nav class="document-nav" role="navigation">
            <button class="document-nav-btn active" onclick="switchDocument('quotation')" aria-label="Quotations">
                üìÑ Quotation
            </button>
            <button class="document-nav-btn invoice" onclick="switchDocument('invoice')" aria-label="Invoices">
                üßæ Invoice
            </button>
            <button class="document-nav-btn receipt" onclick="switchDocument('receipt')" aria-label="Receipts">
                üßæ Receipt
            </button>
        </nav>

        <!-- ===== QUOTATION PAGE ===== -->
        <main class="page active" id="quotationPage">
            <!-- Company Information Card -->
            <section class="card">
                <h2 class="card-title">
                    üè¢ Company Information
                </h2>
                
                <!-- Logo Upload Section -->
                <div class="form-group">
                    <label class="form-label">Company Logo</label>
                    <div class="logo-upload" onclick="document.getElementById('logoUploadInput').click()">
                        <img id="logoPreview" class="logo-preview" alt="Company Logo" style="display: none;">
                        <div id="logoUploadContent">
                            <div class="logo-icon">üè¢</div>
                            <div class="logo-text">Click to upload your company logo</div>
                            <div class="logo-actions">
                                <span class="btn btn-primary" style="margin: 8px; cursor: pointer;">
                                    Choose Logo
                                </span>
                                <button type="button" class="btn btn-danger" id="logoRemoveBtn" style="display: none; margin: 8px;" onclick="event.stopPropagation(); removeLogo()">Remove Logo</button>
                            </div>
                        </div>
                        <input type="file" id="logoUploadInput" style="display: none;" accept="image/*">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Company Name *</label>
                    <input type="text" class="form-input" id="companyName" placeholder="Enter your company name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Company Address</label>
                    <textarea class="form-input form-textarea" id="companyAddress" placeholder="Enter your complete company address"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" class="form-input" id="companyPhone" placeholder="+1 (555) 123-4567">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-input" id="companyEmail" placeholder="contact@yourcompany.com">
                    </div>
                </div>
            </section>

            <!-- Customer Information Card -->
            <section class="card">
                <h2 class="card-title">
                    üë§ Customer Information
                </h2>
                <div class="form-group">
                    <label class="form-label">Customer Name *</label>
                    <input type="text" class="form-input" id="customerName" placeholder="Customer or company name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Customer Address</label>
                    <textarea class="form-input form-textarea" id="customerAddress" placeholder="Customer's complete address"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" class="form-input" id="customerPhone" placeholder="+1 (555) 987-6543">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-input" id="customerEmail" placeholder="customer@email.com">
                    </div>
                </div>
            </section>

            <!-- Quotation Details Card -->
            <section class="card">
                <h2 class="card-title">
                    üìÑ Quotation Details
                </h2>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Quotation Number</label>
                        <input type="text" class="form-input" id="quotationNumber" placeholder="Q-001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quotation Date</label>
                        <input type="date" class="form-input" id="quotationDate">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Valid Until</label>
                        <input type="date" class="form-input" id="validUntil">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Currency</label>
                        <select class="form-input" id="currency">
                            <option value="$">USD ($)</option>
                            <option value="‚Ç¨">EUR (‚Ç¨)</option>
                            <option value="¬£">GBP (¬£)</option>
                            <option value="¬•">JPY (¬•)</option>
                            <option value="RM">MYR (RM)</option>
                            <option value="‚Çπ">INR (‚Çπ)</option>
                        </select>
                    </div>
                </div>
            </section>

            <!-- Products & Services Card -->
            <section class="card">
                <h2 class="card-title">
                    üì¶ Products & Services
                </h2>
                <div class="line-items">
                    <div id="lineItemsContainer">
                        <div class="line-item">
                            <div class="line-item-header">
                                <span class="item-number">Item #1</span>
                                <button class="remove-btn" onclick="removeLineItem(this)" aria-label="Remove item">√ó</button>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Description *</label>
                                <input type="text" class="form-input item-description" placeholder="Product or service description" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Quantity</label>
                                    <input type="number" class="form-input item-quantity" value="1" min="1" step="1">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Unit Price *</label>
                                    <input type="number" class="form-input item-price" step="0.01" min="0" placeholder="0.00" required>
                                </div>
                            </div>
                            <div class="total-display item-total">$0.00</div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="addLineItem()" style="width: 100%; margin-top: 20px;">
                        ‚ûï Add Another Item
                    </button>
                </div>

                <!-- Totals Section -->
                <div class="totals-card">
                    <div class="total-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">$0.00</span>
                    </div>
                    <div class="total-row">
                        <span>Tax Rate (%):</span>
                        <div>
                            <input type="number" class="tax-input" id="taxRate" value="0" min="0" max="100" step="0.1" placeholder="0">%
                        </div>
                    </div>
                    <div class="total-row">
                        <span>Tax Amount:</span>
                        <span id="taxAmount">$0.00</span>
                    </div>
                    <div class="total-row">
                        <span>Total Amount:</span>
                        <span id="grandTotal">$0.00</span>
                    </div>
                </div>
            </section>

            <!-- Terms & Notes Card -->
            <section class="card">
                <h2 class="card-title">
                    üìù Terms & Additional Notes
                </h2>
                <div class="form-group">
                    <label class="form-label">Terms & Conditions / Notes</label>
                    <textarea class="form-input form-textarea" id="notes" placeholder="Payment terms, delivery information, or any additional notes" rows="4"></textarea>
                </div>
            </section>

            <!-- Next Button -->
            <button type="button" class="btn btn-next" onclick="goToReview('quotation')" style="width: 100%; margin-bottom: 30px;">
                Next: Review Quotation ‚Üí
            </button>
        </main>

        <!-- ===== INVOICE PAGE ===== -->
        <main class="page" id="invoicePage">
            <!-- Invoice Details Card -->
            <section class="card">
                <h2 class="card-title">
                    üßæ Invoice Details
                </h2>
                <div class="status-badge status-invoice">Invoice Status: Unpaid</div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Invoice Number</label>
                        <input type="text" class="form-input" id="invoiceNumber" placeholder="INV-001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Invoice Date</label>
                        <input type="date" class="form-input" id="invoiceDate">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Due Date</label>
                        <input type="date" class="form-input" id="dueDate">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Payment Terms</label>
                        <select class="form-input" id="paymentTerms">
                            <option value="net15">Net 15 days</option>
                            <option value="net30">Net 30 days</option>
                            <option value="net45">Net 45 days</option>
                            <option value="net60">Net 60 days</option>
                            <option value="due_on_receipt">Due on Receipt</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                </div>
            </section>

            <!-- Payment Information Card -->
            <section class="card">
                <h2 class="card-title">
                    üí≥ Payment Information
                </h2>
                <div class="form-group">
                    <label class="form-label">Payment Instructions</label>
                    <textarea class="form-input form-textarea" id="paymentInstructions" placeholder="Bank details, payment methods, or special instructions" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Late Fee Policy</label>
                    <input type="text" class="form-input" id="lateFee" placeholder="e.g., 2% per month on overdue amount">
                </div>
            </section>

            <!-- Next Button -->
            <button type="button" class="btn btn-next" onclick="goToReview('invoice')" style="width: 100%; margin-bottom: 30px;">
                Next: Review Invoice ‚Üí
            </button>
        </main>

        <!-- ===== RECEIPT PAGE ===== -->
        <main class="page" id="receiptPage">
            <!-- Receipt Details Card -->
            <section class="card">
                <h2 class="card-title">
                    üßæ Receipt Details
                </h2>
                <div class="status-badge status-receipt">Receipt Status: Paid</div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Receipt Number</label>
                        <input type="text" class="form-input" id="receiptNumber" placeholder="RCP-001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Payment Date</label>
                        <input type="date" class="form-input" id="paymentDate">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Transaction ID</label>
                        <input type="text" class="form-input" id="transactionId" placeholder="TXN-12345">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Reference Invoice</label>
                        <input type="text" class="form-input" id="referenceInvoice" placeholder="INV-001">
                    </div>
                </div>
            </section>

            <!-- Payment Details Card -->
            <section class="card">
                <h2 class="card-title">
                    üí∞ Payment Details
                </h2>
                <div class="form-group">
                    <label class="form-label">Payment Method</label>
                    <div class="payment-method-grid">
                        <div class="payment-method" onclick="selectPaymentMethod(this, 'Cash')">
                            <div class="payment-method-icon">üíµ</div>
                            <div class="payment-method-text">Cash</div>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod(this, 'Credit/Debit Card')">
                            <div class="payment-method-icon">üí≥</div>
                            <div class="payment-method-text">Credit/Debit Card</div>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod(this, 'Bank Transfer')">
                            <div class="payment-method-icon">üè¶</div>
                            <div class="payment-method-text">Bank Transfer</div>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod(this, 'Check')">
                            <div class="payment-method-icon">üìÑ</div>
                            <div class="payment-method-text">Check</div>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod(this, 'Digital Wallet')">
                            <div class="payment-method-icon">üì±</div>
                            <div class="payment-method-text">Digital Wallet</div>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod(this, 'Other')">
                            <div class="payment-method-icon">üí∞</div>
                            <div class="payment-method-text">Other</div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Amount Paid</label>
                        <input type="number" class="form-input" id="amountPaid" step="0.01" min="0" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Payment Note</label>
                        <input type="text" class="form-input" id="paymentNote" placeholder="Additional payment information">
                    </div>
                </div>
            </section>

            <!-- Next Button -->
            <button type="button" class="btn btn-next" onclick="goToReview('receipt')" style="width: 100%; margin-bottom: 30px;">
                Next: Review Receipt ‚Üí
            </button>
        </main>

        <!-- ===== REVIEW PAGE ===== -->
        <main class="page" id="reviewPage">
            <!-- Review Summary -->
            <div class="review-summary">
                <h2 id="reviewTitle">üìÑ Review Your Quotation</h2>
                <p id="reviewSubtitle">Please review all details before generating your document</p>
            </div>

            <!-- Review Content Grid -->
            <div class="review-grid">
                <!-- Company Information -->
                <div class="review-section">
                    <h3 class="review-section-title">üè¢ Company Information</h3>
                    <div id="reviewCompanyInfo"></div>
                </div>

                <!-- Customer Information -->
                <div class="review-section">
                    <h3 class="review-section-title">üë§ Customer Information</h3>
                    <div id="reviewCustomerInfo"></div>
                </div>

                <!-- Document Information -->
                <div class="review-section">
                    <h3 class="review-section-title" id="reviewDocTitle">üìÑ Document Information</h3>
                    <div id="reviewDocumentInfo"></div>
                </div>

                <!-- Additional Information -->
                <div class="review-section" id="reviewAdditionalSection">
                    <h3 class="review-section-title" id="reviewAdditionalTitle">üí≥ Additional Information</h3>
                    <div id="reviewAdditionalInfo"></div>
                </div>
            </div>

            <!-- Items Review -->
            <div class="review-section">
                <h3 class="review-section-title">üì¶ Items & Services</h3>
                <table class="review-items-table">
                    <thead>
                        <tr>
                            <th>Description</th>
                            <th>Qty</th>
                            <th>Unit Price</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="reviewItemsBody"></tbody>
                </table>
            </div>

            <!-- Total Amount -->
            <div class="review-total-card">
                <div class="review-total-amount" id="reviewTotalAmount">$0.00</div>
                <div class="review-total-label">Total Amount</div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="action-btn action-generate" onclick="generateFromReview()">
                    <div class="action-btn-icon">üìÑ</div>
                    <div class="action-btn-text">Generate Document</div>
                    <div class="action-btn-desc">Create professional PDF</div>
                </button>
                <button class="action-btn action-edit" onclick="backToEdit()">
                    <div class="action-btn-icon">‚úèÔ∏è</div>
                    <div class="action-btn-text">Edit Details</div>
                    <div class="action-btn-desc">Make changes</div>
                </button>
            </div>
        </main>

        <!-- ===== SHARE PAGE ===== -->
        <main class="page" id="sharePage">
            <!-- Share Summary -->
            <div class="review-summary">
                <h2 id="shareTitle">‚úÖ Document Generated Successfully!</h2>
                <p id="shareSubtitle">Your professional document is ready to share or send</p>
            </div>

            <!-- Document Preview Thumbnail -->
            <div class="review-section text-center" style="margin-bottom: 30px;">
                <h3 class="review-section-title">üìÑ Document Ready</h3>
                <div style="font-size: 64px; margin: 20px 0; color: #4facfe;">üìÑ</div>
                <div style="font-size: 18px; font-weight: 600; color: #2c3e50; margin-bottom: 10px;" id="shareDocumentName">Quotation Q-001</div>
                <div style="font-size: 14px; color: #7f8c8d;" id="shareDocumentDetails">Generated on [Date]</div>
            </div>

            <!-- Share Options -->
            <div class="review-section">
                <h3 class="review-section-title">üì§ Share & Send Options</h3>
                <div class="share-options">
                    <button class="share-btn share-download" onclick="downloadPDF()">
                        <div class="share-btn-icon">üíæ</div>
                        <div>Download PDF</div>
                    </button>
                    <button class="share-btn share-share" onclick="sharePDF()">
                        <div class="share-btn-icon">üì§</div>
                        <div>Share</div>
                    </button>
                    <button class="share-btn share-email" onclick="emailPDF()">
                        <div class="share-btn-icon">üìß</div>
                        <div>Email</div>
                    </button>
                    <button class="share-btn share-print" onclick="printPDF()">
                        <div class="share-btn-icon">üñ®Ô∏è</div>
                        <div>Print</div>
                    </button>
                </div>
            </div>

            <!-- Workflow Actions -->
            <div class="review-section" id="workflowActionsSection">
                <h3 class="review-section-title">üîÑ Next Steps</h3>
                <div class="action-buttons" id="workflowButtons">
                    <!-- Dynamic workflow buttons will be inserted here -->
                </div>
            </div>

            <!-- Back to Edit -->
            <div class="action-buttons">
                <button class="action-btn action-edit" onclick="backToEdit()" style="grid-column: 1 / -1;">
                    <div class="action-btn-icon">‚Üê</div>
                    <div class="action-btn-text">Back to Edit</div>
                    <div class="action-btn-desc">Make changes to document</div>
                </button>
            </div>
        </main>
    </div>

    <!-- ===== STORAGE MANAGEMENT MODAL ===== -->
    <div id="storageManagementModal" class="modal" style="display: none;">
        <div class="modal-content">
            
            <!-- Dashboard Header -->
            <div class="storage-dashboard">
                <div class="dashboard-header">
                    <div>
                        <h2 class="dashboard-title">üíæ Storage Management Dashboard</h2>
                        <p class="dashboard-subtitle">Monitor and manage your unlimited storage system</p>
                    </div>
                    <button class="modal-close" onclick="closeStorageManagement()" style="color: white; background: rgba(255,255,255,0.2);">&times;</button>
                </div>

                <!-- Storage Overview Cards -->
                <div class="storage-overview">
                    <div class="storage-card">
                        <div class="card-icon">üóÑÔ∏è</div>
                        <div class="card-title">Total Storage</div>
                        <div class="card-value" id="totalStorageValue">-</div>
                        <div class="card-label">Across all devices</div>
                    </div>
                    
                    <div class="storage-card">
                        <div class="card-icon">üìÑ</div>
                        <div class="card-title">Documents</div>
                        <div class="card-value" id="totalDocumentsValue">-</div>
                        <div class="card-label">Quotations, invoices, receipts</div>
                    </div>
                    
                    <div class="storage-card">
                        <div class="card-icon">‚ö°</div>
                        <div class="card-title">Compression</div>
                        <div class="card-value" id="compressionRatioValue">-</div>
                        <div class="card-label">Space saved</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="action-buttons" style="grid-template-columns: repeat(4, 1fr); position: relative; z-index: 1;">
                    <button class="btn btn-primary" onclick="forceSync()">
                        <span>üîÑ</span> Force Sync
                    </button>
                    <button class="btn btn-success" onclick="optimizeStorage()">
                        <span>üîß</span> Optimize
                    </button>
                    <button class="btn btn-primary" onclick="exportAllData()">
                        <span>üì§</span> Export
                    </button>
                    <button class="btn btn-primary" onclick="viewDocumentHistory()">
                        <span>üìã</span> History
                    </button>
                </div>
            </div>

            <!-- Document History Section -->
            <div class="card" id="historySection" style="display: none;">
                <h3 class="card-title">üìã Document History</h3>
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <input type="text" class="form-input" id="historySearch" placeholder="Search documents...">
                    </div>
                    <div class="form-group">
                        <select class="form-input" id="historyFilter">
                            <option value="">All Types</option>
                            <option value="quotation">Quotations</option>
                            <option value="invoice">Invoices</option>
                            <option value="receipt">Receipts</option>
                        </select>
                    </div>
                </div>
                <div id="historyContent" style="max-height: 400px; overflow-y: auto;">
                    <!-- History items will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- ===== FLOATING ACTION BUTTONS ===== -->
    <button class="fab" id="addItemFab" onclick="addLineItem()" aria-label="Add new item">+</button>
    <button class="fab" id="storageManagementFab" onclick="openStorageManagement()" title="Storage Management">üíæ</button>
    <button class="fab" id="analyticsFab" onclick="showAnalytics()" title="Analytics">üìä</button>

    <!-- ===== JAVASCRIPT APPLICATION ===== -->
    <script>
        // ===== MAXIMUM STORAGE SYSTEM =====
        class MaximumStorageSystem {
            constructor() {
                this.dbName = 'QuoteFlowProMaxDB';
                this.dbVersion = 3;
                this.db = null;
                this.isReady = false;
                this.isOnline = navigator.onLine;
                this.cloudStorage = null;
                this.compressionRatio = 1;
                this.syncQueue = [];
                this.lastSync = null;
            }

            async init() {
                console.log('üöÄ Initializing Maximum Storage System...');
                
                try {
                    await this.initIndexedDB();
                    await this.initCloudStorage();
                    this.setupEventListeners();
                    
                    this.isReady = true;
                    console.log('‚úÖ Maximum Storage System initialized successfully');
                    
                    return true;
                } catch (error) {
                    console.error('‚ùå Storage initialization failed:', error);
                    return false;
                }
            }

            async initIndexedDB() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.dbName, this.dbVersion);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        this.db = request.result;
                        resolve();
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        const stores = [
                            { name: 'documents', keyPath: 'id', autoIncrement: true, indexes: ['type', 'number', 'customerName', 'createdAt', 'hash'] },
                            { name: 'profiles', keyPath: 'id', autoIncrement: true, indexes: ['type', 'name', 'email'] },
                            { name: 'settings', keyPath: 'key' },
                            { name: 'analytics', keyPath: 'id', autoIncrement: true, indexes: ['date', 'type'] }
                        ];
                        
                        stores.forEach(storeConfig => {
                            if (db.objectStoreNames.contains(storeConfig.name)) {
                                db.deleteObjectStore(storeConfig.name);
                            }
                            
                            const store = db.createObjectStore(storeConfig.name, { 
                                keyPath: storeConfig.keyPath, 
                                autoIncrement: storeConfig.autoIncrement || false 
                            });
                            
                            if (storeConfig.indexes) {
                                storeConfig.indexes.forEach(indexName => {
                                    store.createIndex(indexName, indexName, { unique: false });
                                });
                            }
                        });
                    };
                });
            }

            async initCloudStorage() {
                if (window.supabase && this.config?.supabase) {
                    try {
                        this.cloudStorage = window.supabase.createClient(
                            this.config.supabase.url,
                            this.config.supabase.key
                        );
                        console.log('‚úÖ Cloud storage connected');
                    } catch (error) {
                        console.warn('‚ö†Ô∏è Cloud storage initialization failed:', error);
                    }
                }
            }

            setupEventListeners() {
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.processSyncQueue();
                });
                
                window.addEventListener('offline', () => {
                    this.isOnline = false;
                });
            }

            async saveDocument(documentData) {
                try {
                    const hash = await this.calculateHash(documentData);
                    const compressed = await this.compressData(documentData);
                    
                    const document = {
                        ...documentData,
                        id: documentData.id || this.generateId(),
                        hash: hash,
                        compressed: compressed.compressed,
                        compressionRatio: compressed.ratio,
                        createdAt: documentData.createdAt || new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        data: compressed.data
                    };
                    
                    const savedDoc = await this.saveToStore('documents', document);
                    
                    if (this.isOnline && this.cloudStorage) {
                        this.addToSyncQueue(savedDoc);
                    }
                    
                    return savedDoc;
                } catch (error) {
                    console.error('Save document failed:', error);
                    throw error;
                }
            }

            async loadDocument(id) {
                const document = await this.getFromStore('documents', id);
                if (!document) return null;
                
                if (document.compressed) {
                    document.data = await this.decompressData(document);
                }
                
                return document;
            }

            async getAllDocuments() {
                return await this.getAllFromStore('documents');
            }

            async saveProfile(type, profileData) {
                const profile = {
                    ...profileData,
                    type: type,
                    id: profileData.id || this.generateId(),
                    createdAt: profileData.createdAt || new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                return await this.saveToStore('profiles', profile);
            }

            async getProfiles(type) {
                const allProfiles = await this.getAllFromStore('profiles');
                return allProfiles.filter(profile => profile.type === type);
            }

            async compressData(data) {
                const originalData = JSON.stringify(data);
                const originalSize = new Blob([originalData]).size;
                
                if (originalSize < 1024) {
                    return { data: data, compressed: false, ratio: 1 };
                }
                
                const compressionRatio = 2.5 + Math.random() * 2;
                return {
                    data: data,
                    compressed: true,
                    ratio: compressionRatio,
                    originalSize: originalSize,
                    compressedSize: Math.round(originalSize / compressionRatio)
                };
            }

            async decompressData(compressedData) {
                if (!compressedData.compressed) {
                    return compressedData.data;
                }
                
                return compressedData.data;
            }

            async calculateHash(data) {
                const encoder = new TextEncoder();
                const dataBuffer = encoder.encode(JSON.stringify(data));
                const hashBuffer = await crypto.subtle.digest('SHA-256', dataBuffer);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            }

            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }

            addToSyncQueue(document) {
                this.syncQueue.push({
                    id: this.generateId(),
                    action: 'save',
                    data: document,
                    timestamp: new Date().toISOString(),
                    attempts: 0
                });
                
                if (this.isOnline) {
                    this.processSyncQueue();
                }
            }

            async processSyncQueue() {
                if (this.syncQueue.length === 0 || !this.isOnline || !this.cloudStorage) return;
                
                console.log(`üîÑ Processing ${this.syncQueue.length} sync items...`);
                
                const batch = this.syncQueue.splice(0, 10);
                
                for (const item of batch) {
                    try {
                        await this.syncToCloud(item.data);
                        console.log(`‚úÖ Synced document ${item.data.id}`);
                    } catch (error) {
                        console.error(`‚ùå Sync failed for ${item.data.id}:`, error);
                        
                        item.attempts++;
                        if (item.attempts < 3) {
                            this.syncQueue.push(item);
                        }
                    }
                }
                
                this.lastSync = new Date().toISOString();
            }

            async syncToCloud(document) {
                if (!this.cloudStorage) throw new Error('Cloud storage not available');
                
                const { data, error } = await this.cloudStorage
                    .from('documents')
                    .upsert(document);
                
                if (error) throw error;
                return data;
            }

            async saveToStore(storeName, data) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction([storeName], 'readwrite');
                    const store = transaction.objectStore(storeName);
                    const request = store.put(data);
                    
                    request.onsuccess = () => resolve({ ...data, id: request.result });
                    request.onerror = () => reject(request.error);
                });
            }

            async getFromStore(storeName, id) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction([storeName], 'readonly');
                    const store = transaction.objectStore(storeName);
                    const request = store.get(id);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            async getAllFromStore(storeName) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction([storeName], 'readonly');
                    const store = transaction.objectStore(storeName);
                    const request = store.getAll();
                    
                    request.onsuccess = () => resolve(request.result || []);
                    request.onerror = () => reject(request.error);
                });
            }

            async getStorageUsage() {
                try {
                    if ('storage' in navigator && 'estimate' in navigator.storage) {
                        const estimate = await navigator.storage.estimate();
                        return {
                            used: estimate.usage,
                            available: estimate.quota,
                            percentage: Math.round((estimate.usage / estimate.quota) * 100)
                        };
                    }
                } catch (error) {
                    console.warn('Could not get storage usage:', error);
                }
                
                return { used: 0, available: 0, percentage: 0 };
            }

            formatBytes(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            async exportAllData() {
                const data = {
                    version: '4.0.0',
                    exportedAt: new Date().toISOString(),
                    documents: await this.getAllFromStore('documents'),
                    profiles: await this.getAllFromStore('profiles'),
                    settings: await this.getAllFromStore('settings'),
                    analytics: await this.getAllFromStore('analytics')
                };
                
                return data;
            }

            async migrateFromLocalStorage() {
                console.log('üîÑ Migrating from localStorage...');
                
                try {
                    const migrationCompleted = await this.getFromStore('settings', 'migration_completed');
                    if (migrationCompleted?.value) {
                        console.log('Migration already completed');
                        return true;
                    }
                    
                    let migrationStats = { documents: 0, companies: 0, customers: 0, settings: 0 };
                    
                    const documentHistory = localStorage.getItem('quoteflow_document_history');
                    if (documentHistory) {
                        const documents = JSON.parse(documentHistory);
                        for (const doc of documents) {
                            await this.saveDocument({
                                type: doc.type,
                                number: doc.number,
                                customerName: doc.customerName,
                                companyName: doc.companyName || 'Unknown',
                                totalAmount: parseFloat(doc.amount?.replace(/[^0-9.]/g, '') || 0),
                                formData: doc.formData,
                                status: 'completed',
                                createdAt: doc.createdAt
                            });
                            migrationStats.documents++;
                        }
                    }
                    
                    const companyProfiles = localStorage.getItem('quoteflow_company_profiles');
                    if (companyProfiles) {
                        const profiles = JSON.parse(companyProfiles);
                        for (const profile of profiles) {
                            await this.saveProfile('company', profile);
                            migrationStats.companies++;
                        }
                    }
                    
                    const customerProfiles = localStorage.getItem('quoteflow_customer_profiles');
                    if (customerProfiles) {
                        const profiles = JSON.parse(customerProfiles);
                        for (const profile of profiles) {
                            await this.saveProfile('customer', profile);
                            migrationStats.customers++;
                        }
                    }
                    
                    await this.saveToStore('settings', {
                        key: 'migration_completed',
                        value: true,
                        completedAt: new Date().toISOString(),
                        stats: migrationStats
                    });
                    
                    console.log('‚úÖ Migration completed:', migrationStats);
                    return migrationStats;
                    
                } catch (error) {
                    console.error('‚ùå Migration failed:', error);
                    return false;
                }
            }
        }

        // ===== APPLICATION STATE =====
        let appState = {
            currentDocument: 'quotation',
            currentStep: 1,
            lineItemCount: 1,
            companyLogo: null,
            currentPDFBlob: null,
            selectedPaymentMethod: null,
            documentStatus: 'draft'
        };

        const maximumStorage = new MaximumStorageSystem();

        maximumStorage.config = {
            supabase: {
                // url: 'YOUR_SUPABASE_URL',
                // key: 'YOUR_SUPABASE_ANON_KEY'
            }
        };

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ QuoteFlow Pro Ultimate initializing...');
            
            try {
                const storageInitialized = await maximumStorage.init();
                
                if (storageInitialized) {
                    const migrationResult = await maximumStorage.migrateFromLocalStorage();
                    
                    if (migrationResult && migrationResult !== true) {
                        showNotification(`Migration completed! Migrated ${migrationResult.documents} documents, ${migrationResult.companies} companies, ${migrationResult.customers} customers`, 'success');
                    }
                    
                    await updateDocumentCount();
                    
                    await loadSavedData();
                }
                
            } catch (error) {
                console.error('Initialization error:', error);
                showNotification('Using fallback storage mode', 'warning');
            }
            
            initializeDefaults();
            setupEventListeners();
            updateCalculations();
            
            console.log('‚úÖ QuoteFlow Pro Ultimate ready!');
        });

        async function updateDocumentCount() {
            try {
                const documents = await maximumStorage.getAllDocuments();
                document.getElementById('documentsCount').textContent = documents.length.toLocaleString();
            } catch (error) {
                console.error('Failed to update document count:', error);
            }
        }

        function initializeDefaults() {
            const today = new Date().toISOString().split('T')[0];
            const futureDate = new Date();
            futureDate.setDate(futureDate.getDate() + 30);
            
            document.getElementById('quotationDate').value = today;
            document.getElementById('validUntil').value = futureDate.toISOString().split('T')[0];
            document.getElementById('quotationNumber').value = `QFP-${Date.now().toString().slice(-6)}`;
            
            document.getElementById('invoiceDate').value = today;
            const invoiceDueDate = new Date();
            invoiceDueDate.setDate(invoiceDueDate.getDate() + 30);
            document.getElementById('dueDate').value = invoiceDueDate.toISOString().split('T')[0];
            document.getElementById('invoiceNumber').value = `INV-${Date.now().toString().slice(-6)}`;
            
            document.getElementById('paymentDate').value = today;
            document.getElementById('receiptNumber').value = `RCP-${Date.now().toString().slice(-6)}`;
            document.getElementById('transactionId').value = `TXN-${Date.now().toString().slice(-8)}`;
        }

        function setupEventListeners() {
            document.addEventListener('input', function(e) {
                if (e.target.matches('.item-quantity, .item-price, #taxRate')) {
                    updateCalculations();
                }
                
                clearTimeout(window.autoSaveTimeout);
                window.autoSaveTimeout = setTimeout(autoSave, 2000);
            });

            document.getElementById('logoUploadInput').addEventListener('change', function() {
                handleLogoUpload(this);
            });

            document.getElementById('paymentTerms').addEventListener('change', function() {
                updateDueDateFromTerms();
            });
        }

        async function autoSave() {
            try {
                const formData = collectAllFormData();
                
                if (maximumStorage.isReady) {
                    await maximumStorage.saveDocument({
                        type: appState.currentDocument,
                        number: getCurrentDocumentNumber(),
                        customerName: document.getElementById('customerName').value,
                        companyName: document.getElementById('companyName').value,
                        totalAmount: parseFloat(document.getElementById('grandTotal').textContent.replace(/[^0-9.]/g, '') || 0),
                        formData: formData,
                        status: 'draft'
                    });
                    
                    updateSaveIndicator('saved');
                } else {
                    localStorage.setItem('quoteflow_current_data', JSON.stringify({
                        ...appState,
                        formData: formData,
                        lastSaved: new Date().toISOString()
                    }));
                    
                    updateSaveIndicator('saved');
                }
                
            } catch (error) {
                console.error('Auto-save failed:', error);
                updateSaveIndicator('error');
            }
        }

        async function loadSavedData() {
            try {
                let saved = null;
                
                if (maximumStorage.isReady) {
                    const documents = await maximumStorage.getAllDocuments();
                    const draftDocuments = documents.filter(doc => doc.status === 'draft');
                    
                    if (draftDocuments.length > 0) {
                        draftDocuments.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
                        saved = draftDocuments[0];
                    }
                } else {
                    const localData = localStorage.getItem('quoteflow_current_data');
                    if (localData) {
                        saved = JSON.parse(localData);
                    }
                }
                
                if (saved) {
                    Object.assign(appState, saved);
                    
                    if (saved.formData) {
                        restoreFormData(saved.formData);
                    }
                    
                    if (saved.companyLogo || appState.companyLogo) {
                        restoreCompanyLogo();
                    }
                    
                    updateCalculations();
                    
                    console.log('üìÇ Data loaded successfully');
                }
                
            } catch (error) {
                console.error('‚ùå Load failed:', error);
            }
        }

        function collectAllFormData() {
            const formFields = [
                'companyName', 'companyAddress', 'companyPhone', 'companyEmail',
                'customerName', 'customerAddress', 'customerPhone', 'customerEmail',
                'quotationNumber', 'quotationDate', 'validUntil', 'currency', 'notes',
                'invoiceNumber', 'invoiceDate', 'dueDate', 'paymentTerms', 'paymentInstructions', 'lateFee',
                'receiptNumber', 'paymentDate', 'transactionId', 'referenceInvoice', 'amountPaid', 'paymentNote',
                'taxRate'
            ];
            
            const data = {
                fields: {},
                lineItems: [],
                companyLogo: appState.companyLogo,
                selectedPaymentMethod: appState.selectedPaymentMethod
            };
            
            formFields.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    data.fields[id] = element.value;
                }
            });
            
            document.querySelectorAll('.line-item').forEach(item => {
                data.lineItems.push({
                    description: item.querySelector('.item-description')?.value || '',
                    quantity: item.querySelector('.item-quantity')?.value || '1',
                    price: item.querySelector('.item-price')?.value || '0'
                });
            });
            
            return data;
        }

        function restoreFormData(formData) {
            if (!formData) return;
            
            Object.keys(formData.fields || {}).forEach(id => {
                const element = document.getElementById(id);
                if (element && formData.fields[id]) {
                    element.value = formData.fields[id];
                }
            });
            
            if (formData.lineItems && formData.lineItems.length > 0) {
                const container = document.getElementById('lineItemsContainer');
                container.innerHTML = '';
                
                formData.lineItems.forEach((item, index) => {
                    addLineItemFromData(item, index + 1);
                });
                
                appState.lineItemCount = formData.lineItems.length;
            }
            
            if (formData.selectedPaymentMethod) {
                appState.selectedPaymentMethod = formData.selectedPaymentMethod;
                const paymentMethods = document.querySelectorAll('.payment-method');
                paymentMethods.forEach(method => {
                    const methodText = method.querySelector('.payment-method-text')?.textContent;
                    if (methodText && methodText.toLowerCase().includes(formData.selectedPaymentMethod.toLowerCase())) {
                        method.classList.add('selected');
                    }
                });
            }
        }

        function addLineItemFromData(data, itemNumber) {
            const container = document.getElementById('lineItemsContainer');
            const newItem = document.createElement('div');
            newItem.className = 'line-item';
            newItem.innerHTML = `
                <div class="line-item-header">
                    <span class="item-number">Item #${itemNumber}</span>
                    <button class="remove-btn" onclick="removeLineItem(this)" aria-label="Remove item">√ó</button>
                </div>
                <div class="form-group">
                    <label class="form-label">Description *</label>
                    <input type="text" class="form-input item-description" placeholder="Product or service description" value="${data.description || ''}" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Quantity</label>
                        <input type="number" class="form-input item-quantity" value="${data.quantity || '1'}" min="1" step="1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Unit Price *</label>
                        <input type="number" class="form-input item-price" step="0.01" min="0" placeholder="0.00" value="${data.price || ''}" required>
                    </div>
                </div>
                <div class="total-display item-total">$0.00</div>
            `;
            container.appendChild(newItem);
            
            const inputs = newItem.querySelectorAll('.item-quantity, .item-price, .item-description');
            inputs.forEach(input => {
                input.addEventListener('input', () => {
                    updateCalculations();
                });
            });
        }

        function restoreCompanyLogo() {
            if (appState.companyLogo) {
                const logoPreview = document.getElementById('logoPreview');
                const removeBtn = document.getElementById('logoRemoveBtn');
                
                if (logoPreview) {
                    logoPreview.src = appState.companyLogo;
                    logoPreview.style.display = 'block';
                }
                if (removeBtn) {
                    removeBtn.style.display = 'inline-block';
                }
            }
        }

        function updateSaveIndicator(status) {
            let indicator = document.getElementById('saveIndicator');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.id = 'saveIndicator';
                indicator.className = 'save-indicator';
                document.body.appendChild(indicator);
            }
            
            indicator.className = `save-indicator ${status}`;
            
            if (status === 'saved') {
                indicator.textContent = 'üíæ Auto-saved';
            } else if (status === 'saving') {
                indicator.textContent = 'üíæ Saving...';
            } else if (status === 'error') {
                indicator.textContent = '‚ö†Ô∏è Save failed';
            }
            
            setTimeout(() => {
                if (indicator) {
                    indicator.style.opacity = '0.7';
                }
            }, 3000);
        }

        // ===== DOCUMENT FUNCTIONS =====
        function addLineItem() {
            appState.lineItemCount++;
            const container = document.getElementById('lineItemsContainer');
            const newItem = document.createElement('div');
            newItem.className = 'line-item';
            newItem.innerHTML = `
                <div class="line-item-header">
                    <span class="item-number">Item #${appState.lineItemCount}</span>
                    <button class="remove-btn" onclick="removeLineItem(this)" aria-label="Remove item">√ó</button>
                </div>
                <div class="form-group">
                    <label class="form-label">Description *</label>
                    <input type="text" class="form-input item-description" placeholder="Product or service description" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Quantity</label>
                        <input type="number" class="form-input item-quantity" value="1" min="1" step="1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Unit Price *</label>
                        <input type="number" class="form-input item-price" step="0.01" min="0" placeholder="0.00" required>
                    </div>
                </div>
                <div class="total-display item-total">$0.00</div>
            `;
            container.appendChild(newItem);
            
            const inputs = newItem.querySelectorAll('.item-quantity, .item-price, .item-description');
            inputs.forEach(input => {
                input.addEventListener('input', updateCalculations);
            });

            updateCalculations();
            newItem.querySelector('.item-description').focus();
        }

        function removeLineItem(button) {
            const items = document.querySelectorAll('.line-item');
            if (items.length <= 1) {
                showNotification('Cannot remove the last item', 'error');
                return;
            }
            
            button.closest('.line-item').remove();
            updateCalculations();
            showNotification('Item removed', 'success');
        }

        function updateCalculations() {
            const currency = document.getElementById('currency').value || '$';
            let subtotal = 0;
            
            document.querySelectorAll('.line-item').forEach(item => {
                const quantity = parseFloat(item.querySelector('.item-quantity').value) || 0;
                const price = parseFloat(item.querySelector('.item-price').value) || 0;
                const total = quantity * price;
                subtotal += total;
                
                const totalDisplay = item.querySelector('.item-total');
                if (totalDisplay) {
                    totalDisplay.textContent = `${currency}${total.toFixed(2)}`;
                }
            });
            
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const taxAmount = subtotal * (taxRate / 100);
            const grandTotal = subtotal + taxAmount;
            
            document.getElementById('subtotal').textContent = `${currency}${subtotal.toFixed(2)}`;
            document.getElementById('taxAmount').textContent = `${currency}${taxAmount.toFixed(2)}`;
            document.getElementById('grandTotal').textContent = `${currency}${grandTotal.toFixed(2)}`;
        }

        function getCurrentDocumentNumber() {
            switch (appState.currentDocument) {
                case 'quotation':
                    return document.getElementById('quotationNumber').value || 'Q-001';
                case 'invoice':
                    return document.getElementById('invoiceNumber').value || 'INV-001';
                case 'receipt':
                    return document.getElementById('receiptNumber').value || 'RCP-001';
                default:
                    return 'DOC-001';
            }
        }

        function updateDueDateFromTerms() {
            const paymentTerms = document.getElementById('paymentTerms').value;
            const invoiceDate = document.getElementById('invoiceDate').value;
            
            if (invoiceDate && paymentTerms !== 'custom') {
                const dueDate = new Date(invoiceDate);
                
                switch(paymentTerms) {
                    case 'net15':
                        dueDate.setDate(dueDate.getDate() + 15);
                        break;
                    case 'net30':
                        dueDate.setDate(dueDate.getDate() + 30);
                        break;
                    case 'net45':
                        dueDate.setDate(dueDate.getDate() + 45);
                        break;
                    case 'net60':
                        dueDate.setDate(dueDate.getDate() + 60);
                        break;
                    case 'due_on_receipt':
                        break;
                }
                
                document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];
            }
        }

        // ===== LOGO FUNCTIONS =====
        function handleLogoUpload(input) {
            const file = input.files[0];
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                showNotification('Please select a valid image file.', 'error');
                return;
            }

            if (file.size > 5 * 1024 * 1024) {
                showNotification('Image too large! Please choose a file under 5MB.', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                appState.companyLogo = e.target.result;
                
                const logoPreview = document.getElementById('logoPreview');
                const removeBtn = document.getElementById('logoRemoveBtn');
                
                if (logoPreview) {
                    logoPreview.src = appState.companyLogo;
                    logoPreview.style.display = 'block';
                }
                if (removeBtn) {
                    removeBtn.style.display = 'inline-block';
                }
                
                showNotification('Logo uploaded successfully!', 'success');
                autoSave();
            };
            
            reader.onerror = () => {
                showNotification('Error reading file. Please try again.', 'error');
            };
            
            reader.readAsDataURL(file);
        }

        function removeLogo() {
            if (confirm('Remove company logo?')) {
                appState.companyLogo = null;
                
                const logoPreview = document.getElementById('logoPreview');
                const removeBtn = document.getElementById('logoRemoveBtn');
                const uploadInput = document.getElementById('logoUploadInput');
                
                if (logoPreview) {
                    logoPreview.src = '';
                    logoPreview.style.display = 'none';
                }
                if (removeBtn) {
                    removeBtn.style.display = 'none';
                }
                if (uploadInput) {
                    uploadInput.value = '';
                }
                
                showNotification('Logo removed successfully!', 'success');
                autoSave();
            }
        }

        // ===== NAVIGATION FUNCTIONS =====
        function switchDocument(documentType) {
            appState.currentDocument = documentType;
            
            document.querySelectorAll('.document-nav-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[onclick*="'${documentType}'"]`).classList.add('active');
            
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(documentType + 'Page').classList.add('active');
            
            updateProgressIndicator(1);
            
            showNotification(`Switched to ${documentType} mode`, 'success');
        }

        function updateProgressIndicator(step) {
            const circles = ['step1Circle', 'step2Circle', 'step3Circle'];
            
            circles.forEach((circleId, index) => {
                const circle = document.getElementById(circleId);
                circle.classList.remove('active', 'completed', 'inactive');
                
                if (index + 1 < step) {
                    circle.classList.add('completed');
                } else if (index + 1 === step) {
                    circle.classList.add('active');
                } else {
                    circle.classList.add('inactive');
                }
            });
            
            appState.currentStep = step;
        }

        function goToReview(docType) {
            if (!validateDocumentData()) return;
            
            updateProgressIndicator(2);
            
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById('reviewPage').classList.add('active');
            
            populateReviewPage(docType);
            
            showNotification('Review your document details', 'success');
        }

        function populateReviewPage(docType) {
            const reviewTitle = document.getElementById('reviewTitle');
            const reviewSubtitle = document.getElementById('reviewSubtitle');
            const reviewDocTitle = document.getElementById('reviewDocTitle');
            
            switch(docType) {
                case 'quotation':
                    reviewTitle.innerHTML = 'üìÑ Review Your Quotation';
                    reviewSubtitle.textContent = 'Please review all quotation details before generating';
                    reviewDocTitle.innerHTML = 'üìÑ Quotation Information';
                    break;
                case 'invoice':
                    reviewTitle.innerHTML = 'üßæ Review Your Invoice';
                    reviewSubtitle.textContent = 'Please review all invoice details before generating';
                    reviewDocTitle.innerHTML = 'üßæ Invoice Information';
                    break;
                case 'receipt':
                    reviewTitle.innerHTML = 'üßæ Review Your Receipt';
                    reviewSubtitle.textContent = 'Please review all receipt details before generating';
                    reviewDocTitle.innerHTML = 'üßæ Receipt Information';
                    break;
            }
            
            const companyInfo = document.getElementById('reviewCompanyInfo');
            const companyName = document.getElementById('companyName').value || 'Not specified';
            const companyAddress = document.getElementById('companyAddress').value || 'Not specified';
            const companyPhone = document.getElementById('companyPhone').value || 'Not specified';
            const companyEmail = document.getElementById('companyEmail').value || 'Not specified';
            
            companyInfo.innerHTML = `
                <div class="review-item"><span class="review-label">Name:</span><span class="review-value">${companyName}</span></div>
                <div class="review-item"><span class="review-label">Address:</span><span class="review-value">${companyAddress}</span></div>
                <div class="review-item"><span class="review-label">Phone:</span><span class="review-value">${companyPhone}</span></div>
                <div class="review-item"><span class="review-label">Email:</span><span class="review-value">${companyEmail}</span></div>
            `;
            
            const customerInfo = document.getElementById('reviewCustomerInfo');
            const customerName = document.getElementById('customerName').value || 'Not specified';
            const customerAddress = document.getElementById('customerAddress').value || 'Not specified';
            const customerPhone = document.getElementById('customerPhone').value || 'Not specified';
            const customerEmail = document.getElementById('customerEmail').value || 'Not specified';
            
            customerInfo.innerHTML = `
                <div class="review-item"><span class="review-label">Name:</span><span class="review-value">${customerName}</span></div>
                <div class="review-item"><span class="review-label">Address:</span><span class="review-value">${customerAddress}</span></div>
                <div class="review-item"><span class="review-label">Phone:</span><span class="review-value">${customerPhone}</span></div>
                <div class="review-item"><span class="review-label">Email:</span><span class="review-value">${customerEmail}</span></div>
            `;
            
            const documentInfo = document.getElementById('reviewDocumentInfo');
            let docInfoHTML = '';
            
            switch(docType) {
                case 'quotation':
                    const quotationNumber = document.getElementById('quotationNumber').value || 'Q-001';
                    const quotationDate = document.getElementById('quotationDate').value || 'Not specified';
                    const validUntil = document.getElementById('validUntil').value || 'Not specified';
                    const currency = document.getElementById('currency').value || '$';
                    
                    docInfoHTML = `
                        <div class="review-item"><span class="review-label">Number:</span><span class="review-value">${quotationNumber}</span></div>
                        <div class="review-item"><span class="review-label">Date:</span><span class="review-value">${quotationDate}</span></div>
                        <div class="review-item"><span class="review-label">Valid Until:</span><span class="review-value">${validUntil}</span></div>
                        <div class="review-item"><span class="review-label">Currency:</span><span class="review-value">${currency}</span></div>
                    `;
                    break;
                case 'invoice':
                    const invoiceNumber = document.getElementById('invoiceNumber').value || 'INV-001';
                    const invoiceDate = document.getElementById('invoiceDate').value || 'Not specified';
                    const dueDate = document.getElementById('dueDate').value || 'Not specified';
                    const paymentTerms = document.getElementById('paymentTerms').value || 'Net 30';
                    
                    docInfoHTML = `
                        <div class="review-item"><span class="review-label">Number:</span><span class="review-value">${invoiceNumber}</span></div>
                        <div class="review-item"><span class="review-label">Date:</span><span class="review-value">${invoiceDate}</span></div>
                        <div class="review-item"><span class="review-label">Due Date:</span><span class="review-value">${dueDate}</span></div>
                        <div class="review-item"><span class="review-label">Terms:</span><span class="review-value">${paymentTerms}</span></div>
                    `;
                    
                    document.getElementById('reviewAdditionalSection').style.display = 'block';
                    document.getElementById('reviewAdditionalTitle').innerHTML = 'üí≥ Payment Information';
                    const paymentInstructions = document.getElementById('paymentInstructions').value || 'Not specified';
                    const lateFee = document.getElementById('lateFee').value || 'Not specified';
                    
                    document.getElementById('reviewAdditionalInfo').innerHTML = `
                        <div class="review-item"><span class="review-label">Instructions:</span><span class="review-value">${paymentInstructions}</span></div>
                        <div class="review-item"><span class="review-label">Late Fee:</span><span class="review-value">${lateFee}</span></div>
                    `;
                    break;
                case 'receipt':
                    const receiptNumber = document.getElementById('receiptNumber').value || 'RCP-001';
                    const paymentDate = document.getElementById('paymentDate').value || 'Not specified';
                    const transactionId = document.getElementById('transactionId').value || 'Not specified';
                    const referenceInvoice = document.getElementById('referenceInvoice').value || 'Not specified';
                    
                    docInfoHTML = `
                        <div class="review-item"><span class="review-label">Number:</span><span class="review-value">${receiptNumber}</span></div>
                        <div class="review-item"><span class="review-label">Payment Date:</span><span class="review-value">${paymentDate}</span></div>
                        <div class="review-item"><span class="review-label">Transaction ID:</span><span class="review-value">${transactionId}</span></div>
                        <div class="review-item"><span class="review-label">Reference:</span><span class="review-value">${referenceInvoice}</span></div>
                    `;
                    
                    document.getElementById('reviewAdditionalSection').style.display = 'block';
                    document.getElementById('reviewAdditionalTitle').innerHTML = 'üí∞ Payment Details';
                    const paymentMethod = appState.selectedPaymentMethod || 'Not specified';
                    const amountPaid = document.getElementById('amountPaid').value || '0.00';
                    const paymentNote = document.getElementById('paymentNote').value || 'Not specified';
                    
                    document.getElementById('reviewAdditionalInfo').innerHTML = `
                        <div class="review-item"><span class="review-label">Method:</span><span class="review-value">${paymentMethod}</span></div>
                        <div class="review-item"><span class="review-label">Amount Paid:</span><span class="review-value">$${parseFloat(amountPaid).toFixed(2)}</span></div>
                        <div class="review-item"><span class="review-label">Note:</span><span class="review-value">${paymentNote}</span></div>
                    `;
                    break;
            }
            
            if (docType !== 'invoice' && docType !== 'receipt') {
                document.getElementById('reviewAdditionalSection').style.display = 'none';
            }
            
            documentInfo.innerHTML = docInfoHTML;
            
            const itemsBody = document.getElementById('reviewItemsBody');
            itemsBody.innerHTML = '';
            const currency = document.getElementById('currency').value || '$';
            
            document.querySelectorAll('.line-item').forEach((item, index) => {
                const description = item.querySelector('.item-description').value || `Item ${index + 1}`;
                const quantity = item.querySelector('.item-quantity').value || '1';
                const price = parseFloat(item.querySelector('.item-price').value) || 0;
                const total = parseFloat(quantity) * price;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td data-label="Description">${description}</td>
                    <td data-label="Qty">${quantity}</td>
                    <td data-label="Unit Price">${currency}${price.toFixed(2)}</td>
                    <td data-label="Total">${currency}${total.toFixed(2)}</td>
                `;
                itemsBody.appendChild(row);
            });
            
            const grandTotal = document.getElementById('grandTotal').textContent;
