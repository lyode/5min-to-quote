<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Quotation Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            transition: background 0.5s ease;
        }

        /* Theme Backgrounds */
        body.theme-neon-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        body.theme-neon-cyan { background: linear-gradient(135deg, #00f5ff 0%, #0066ff 100%); }
        body.theme-neon-pink { background: linear-gradient(135deg, #ff006e 0%, #8338ec 100%); }
        body.theme-neon-green { background: linear-gradient(135deg, #00ff88 0%, #00cc44 100%); }
        body.theme-neon-orange { background: linear-gradient(135deg, #ff6b00 0%, #ff3300 100%); }
        body.theme-neon-blue { background: linear-gradient(135deg, #0099ff 0%, #003366 100%); }
        body.theme-dark-neon { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); }

        /* Theme Selector */
        .theme-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            transform: translateX(calc(100% - 60px));
            transition: transform 0.3s ease;
        }

        .theme-selector:hover,
        .theme-selector.open {
            transform: translateX(0);
        }

        .theme-toggle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff006e, #8338ec);
            border: none;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            font-size: 20px;
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(45deg);
        }

        .theme-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 200px;
        }

        .theme-option {
            width: 100%;
            height: 40px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .theme-option::before {
            content: attr(data-name);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            font-size: 12px;
        }

        .theme-option:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .theme-neon-purple-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .theme-neon-cyan-btn { background: linear-gradient(135deg, #00f5ff 0%, #0066ff 100%); }
        .theme-neon-pink-btn { background: linear-gradient(135deg, #ff006e 0%, #8338ec 100%); }
        .theme-neon-green-btn { background: linear-gradient(135deg, #00ff88 0%, #00cc44 100%); }
        .theme-neon-orange-btn { background: linear-gradient(135deg, #ff6b00 0%, #ff3300 100%); }
        .theme-neon-blue-btn { background: linear-gradient(135deg, #0099ff 0%, #003366 100%); }
        .theme-dark-neon-btn { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); }

        /* Customer Records Panel */
        .customer-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            transform: translateX(calc(-100% + 60px));
            transition: transform 0.3s ease;
            max-width: 300px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .customer-panel:hover,
        .customer-panel.open {
            transform: translateX(0);
        }

        .customer-toggle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #3498db, #2980b9);
            border: none;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            font-size: 16px;
            color: white;
        }

        .customer-toggle:hover {
            transform: scale(1.1);
        }

        .customer-records {
            display: none;
        }

        .customer-records.show {
            display: block;
        }

        .customer-record {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid #3498db;
        }

        .customer-record:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .customer-record h4 {
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .customer-record p {
            color: #7f8c8d;
            font-size: 12px;
            margin-bottom: 3px;
        }

        .customer-actions {
            display: flex;
            gap: 5px;
            margin-top: 8px;
        }

        .customer-action-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 15px;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .load-btn {
            background: #27ae60;
            color: white;
        }

        .save-btn {
            background: #3498db;
            color: white;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
        }

        .customer-action-btn:hover {
            transform: scale(1.1);
        }

        .new-customer-form {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
        }

        .new-customer-form input {
            width: 100%;
            padding: 8px;
            margin-bottom: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 12px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* Mobile Navigation */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px;
            z-index: 1000;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.2);
        }

        .mobile-nav-buttons {
            display: flex;
            justify-content: space-around;
            gap: 10px;
        }

        .mobile-nav-btn {
            flex: 1;
            padding: 12px 8px;
            background: transparent;
            border: 2px solid #3498db;
            border-radius: 25px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .mobile-nav-btn.active {
            background: #3498db;
            transform: scale(1.05);
        }

        .mobile-nav-btn:hover {
            background: #3498db;
            transform: translateY(-2px);
        }

        /* Section Management */
        .form-section {
            transition: all 0.3s ease;
        }

        .form-section.hidden-mobile {
            display: none;
        }

        /* Mobile Step Indicator */
        .step-indicator {
            display: none;
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 15px 20px;
            margin: -30px -30px 20px -30px;
            text-align: center;
            font-weight: 600;
        }

        .step-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
        }

        .step-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255,255,255,0.4);
            transition: all 0.3s ease;
        }

        .step-dot.active {
            background: white;
            transform: scale(1.3);
        }

        .header {
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .content {
            padding: 30px;
        }

        .form-section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #3498db;
            position: relative;
            overflow: hidden;
        }

        .form-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3498db, #2ecc71, #f39c12, #e74c3c);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .form-section:focus-within::before {
            opacity: 1;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .form-section h3 {
            color: #2c3e50;
            font-size: 1.3em;
        }

        .edit-controls {
            display: flex;
            gap: 10px;
        }

        .edit-btn, .save-btn, .cancel-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .edit-btn {
            background: #3498db;
            color: white;
        }

        .save-btn {
            background: #27ae60;
            color: white;
        }

        .cancel-btn {
            background: #e74c3c;
            color: white;
        }

        .read-display {
            display: none;
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #ecf0f1;
        }

        .form-section.read-mode .read-display {
            display: block;
        }

        .form-section.read-mode .form-grid {
            display: none;
        }

        .read-item {
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ecf0f1;
        }

        .read-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .read-label {
            font-weight: 600;
            color: #34495e;
            font-size: 12px;
            margin-bottom: 4px;
        }

        .read-value {
            color: #2c3e50;
            font-size: 14px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            color: #34495e;
            margin-bottom: 5px;
        }

        input, textarea, select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3498db;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Logo Upload Styles */
        .logo-upload-section {
            background: #ffffff;
            border: 2px dashed #3498db;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin-bottom: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .logo-upload-section:hover {
            background: #f8f9fa;
            border-color: #2980b9;
            transform: translateY(-2px);
        }

        .logo-upload-section.has-logo {
            border-style: solid;
            border-color: #27ae60;
            background: #f8fff8;
        }

        .logo-preview {
            max-width: 200px;
            max-height: 100px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .logo-preview.visible {
            display: block;
        }

        .logo-upload-input {
            display: none;
        }

        .logo-upload-btn, .logo-remove-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .logo-upload-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .logo-remove-btn {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .logo-upload-text {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .line-items {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #ecf0f1;
        }

        .line-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 15px;
            align-items: end;
            margin-bottom: 15px;
            padding: 15px;
            background: #fafafa;
            border-radius: 8px;
            position: relative;
            transition: all 0.3s ease;
        }

        .line-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .line-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, #3498db, #2ecc71);
            border-radius: 0 4px 4px 0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            min-height: 44px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #229954);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(39, 174, 96, 0.3);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            padding: 8px 12px;
            font-size: 12px;
        }

        .btn-danger:hover {
            transform: scale(1.05);
        }

        .totals {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .final-total {
            border-top: 2px solid #ecf0f1;
            padding-top: 15px;
            font-size: 1.4em;
            font-weight: bold;
        }

        .quotation-preview {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 30px;
            margin-top: 30px;
            font-family: 'Times New Roman', serif;
        }

        .quotation-header {
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .quotation-logo {
            max-width: 150px;
            max-height: 75px;
            margin-bottom: 15px;
            display: none;
        }

        .quotation-logo.visible {
            display: block;
        }

        .quotation-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .quotation-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .quotation-table th,
        .quotation-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        .quotation-table th {
            background: #f8f9fa;
            font-weight: bold;
        }

        .quotation-table .text-right {
            text-align: right;
        }

        .hidden {
            display: none;
        }

        /* Quick Actions Panel */
        .quick-actions {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quick-action-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quick-action-btn:hover {
            transform: scale(1.1);
        }

        .add-item-btn {
            background: linear-gradient(45deg, #27ae60, #229954);
        }

        .save-all-btn {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .generate-btn {
            background: linear-gradient(45deg, #8e44ad, #9b59b6);
        }

        @media (max-width: 768px) {
            body {
                padding: 5px;
                padding-bottom: 100px;
            }

            .container {
                border-radius: 10px;
                margin-bottom: 0;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px 15px;
            }

            .form-section {
                margin-bottom: 20px;
                padding: 20px 15px;
                border-radius: 15px;
                border-left: none;
                border-top: 4px solid #3498db;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .line-item {
                grid-template-columns: 1fr;
                gap: 12px;
                padding: 20px 15px;
                border-radius: 15px;
                margin-bottom: 20px;
                background: white;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            }

            .mobile-nav {
                display: block;
            }

            .step-indicator {
                display: block;
            }

            .quick-actions {
                display: none;
            }

            .customer-panel {
                transform: translateX(calc(-100% + 50px));
                max-width: 250px;
            }

            .theme-selector {
                transform: translateX(calc(100% - 50px));
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .edit-controls {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .mobile-nav-btn {
                font-size: 10px;
                padding: 10px 6px;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 1.5em;
            }

            .quotation-table {
                font-size: 12px;
            }

            .quotation-table th,
            .quotation-table td {
                padding: 6px 2px;
            }
        }
    </style>
</head>
<body>
    <!-- Theme Selector -->
    <div class="theme-selector" id="themeSelector">
        <button class="theme-toggle" onclick="toggleThemeSelector()">🎨</button>
        <div class="theme-options">
            <button class="theme-option theme-neon-purple-btn" data-theme="theme-neon-purple" data-name="Neon Purple"></button>
            <button class="theme-option theme-neon-cyan-btn" data-theme="theme-neon-cyan" data-name="Neon Cyan"></button>
            <button class="theme-option theme-neon-pink-btn" data-theme="theme-neon-pink" data-name="Neon Pink"></button>
            <button class="theme-option theme-neon-green-btn" data-theme="theme-neon-green" data-name="Neon Green"></button>
            <button class="theme-option theme-neon-orange-btn" data-theme="theme-neon-orange" data-name="Neon Orange"></button>
            <button class="theme-option theme-neon-blue-btn" data-theme="theme-neon-blue" data-name="Neon Blue"></button>
            <button class="theme-option theme-dark-neon-btn" data-theme="theme-dark-neon" data-name="Dark Neon"></button>
        </div>
    </div>

    <!-- Customer Records Panel -->
    <div class="customer-panel" id="customerPanel">
        <button class="customer-toggle" onclick="toggleCustomerPanel()">👥</button>
        <div class="customer-records" id="customerRecords">
            <h4 style="margin-bottom: 15px; color: #2c3e50;">Customer Records</h4>
            
            <!-- New Customer Form -->
            <div class="new-customer-form">
                <h5 style="margin-bottom: 10px; color: #34495e;">Save Current Customer</h5>
                <input type="text" id="newCustomerName" placeholder="Customer Name">
                <button class="customer-action-btn save-btn" onclick="saveCurrentCustomer()">Save Customer</button>
            </div>

            <!-- Saved Customers -->
            <div id="savedCustomers"></div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="quick-action-btn add-item-btn" onclick="addLineItem()" title="Add Item">+</button>
        <button class="quick-action-btn save-all-btn" onclick="saveAllSections()" title="Save All">💾</button>
        <button class="quick-action-btn generate-btn" onclick="generateQuotation()" title="Generate">📄</button>
    </div>

    <div class="container">
        <div class="header">
            <h1>Enhanced Quotation Generator</h1>
            <p>Create professional quotations with customer management</p>
        </div>

        <div class="content">
            <!-- Mobile Step Indicator -->
            <div class="step-indicator">
                <div id="stepTitle">Company Details</div>
                <div class="step-dots">
                    <div class="step-dot active"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                </div>
            </div>

            <!-- Company Details -->
            <div class="form-section" data-step="0" id="companySection">
                <div class="section-header">
                    <h3 class="section-title">Your Company Details</h3>
                    <div class="edit-controls">
                        <button class="edit-btn" onclick="toggleEditMode('companySection')">Edit</button>
                        <button class="save-btn" onclick="saveSection('companySection')" style="display: none;">Save</button>
                        <button class="cancel-btn" onclick="cancelEdit('companySection')" style="display: none;">Cancel</button>
                    </div>
                </div>
                
                <!-- Company Logo Upload -->
                <div class="logo-upload-section" id="logoUploadSection" onclick="triggerLogoUpload()">
                    <img id="logoPreview" class="logo-preview" alt="Company Logo">
                    <div id="logoUploadContent">
                        <div style="font-size: 48px; color: #3498db; margin-bottom: 10px;">🏢</div>
                        <div style="font-weight: 600; color: #2c3e50; margin-bottom: 5px;">Upload Company Logo</div>
                        <div class="logo-upload-text">Click to select logo image (PNG, JPG, SVG)</div>
                        <button type="button" class="logo-upload-btn">Choose Logo</button>
                        <button type="button" class="logo-remove-btn" id="logoRemoveBtn" style="display: none;" onclick="removeLogo(event)">Remove Logo</button>
                    </div>
                    <input type="file" id="logoUploadInput" class="logo-upload-input" accept="image/*" onchange="handleLogoUpload(event)">
                </div>
                
                <div class="read-display">
                    <div class="read-item" id="logoReadItem" style="display: none;">
                        <div class="read-label">Company Logo:</div>
                        <div class="read-value">
                            <img id="logoReadPreview" style="max-width: 100px; max-height: 50px; border-radius: 4px;" alt="Company Logo">
                        </div>
                    </div>
                    <div class="read-item">
                        <div class="read-label">Company Name:</div>
                        <div class="read-value" id="read-companyName">Not set</div>
                    </div>
                    <div class="read-item">
                        <div class="read-label">Address:</div>
                        <div class="read-value" id="read-companyAddress">Not set</div>
                    </div>
                    <div class="read-item">
                        <div class="read-label">Phone:</div>
                        <div class="read-value" id="read-companyPhone">Not set</div>
                    </div>
                    <div class="read-item">
                        <div class="read-label">Email:</div>
                        <div class="read-value" id="read-companyEmail">Not set</div>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="companyName">Company Name</label>
                        <input type="text" id="companyName" placeholder="Your Company Name">
                    </div>
                    <div class="form-group">
                        <label for="companyAddress">Address</label>
                        <textarea id="companyAddress" placeholder="Your company address"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="companyPhone">Phone</label>
                        <input type="text" id="companyPhone" placeholder="Phone number">
                    </div>
                    <div class="form-group">
                        <label for="companyEmail">Email</label>
                        <input type="email" id="companyEmail" placeholder="Email address">
                    </div>
                </div>
            </div>

            <!-- Customer Details -->
            <div class="form-section" data-step="1" id="customerSection">
                <div class="section-header">
                    <h3 class="section-title">Customer Details</h3>
                    <div class="edit-controls">
                        <button class="edit-btn" onclick="toggleEditMode('customerSection')">Edit</button>
                        <button class="save-btn" onclick="saveSection('customerSection')" style="display: none;">Save</button>
                        <button class="cancel-btn" onclick="cancelEdit('customerSection')" style="display: none;">Cancel</button>
                    </div>
                </div>

                <div class="read-display">
                    <div class="read-item">
                        <div class="read-label">Customer Name:</div>
                        <div class="read-value" id="read-customerName">Not set</div>
                    </div>
                    <div class="read-item">
                        <div class="read-label">Address:</div>
                        <div class="read-value" id="read-customerAddress">Not set</div>
                    </div>
                    <div class="read-item">
                        <div class="read-label">Phone:</div>
                        <div class="read-value" id="read-customerPhone">Not set</div>
                    </div>
                    <div class="read-item">
                        <div class="read-label">Email:</div>
                        <div class="read-value" id="read-customerEmail">Not set</div>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="customerName">Customer Name</label>
                        <input type="text" id="customerName" placeholder="Customer or company name">
                    </div>
                    <div class="form-group">
                        <label for="customerAddress">Customer Address</label>
                        <textarea id="customerAddress" placeholder="Customer address"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="customerPhone">Phone</label>
                        <input type="text" id="customerPhone" placeholder="Customer phone">
                    </div>
                    <div class="form-group">
                        <label for="customerEmail">Email</label>
                        <input type="email" id="customerEmail" placeholder="Customer email">
                    </div>
                </div>
            </div>

            <!-- Quotation Details -->
            <div class="form-section" data-step="2" id="quotationSection">
                <div class="section-header">
                    <h3 class="section-title">Quotation Information</h3>
                    <div class="edit-controls">
                        <button class="edit-btn" onclick="toggleEditMode('quotationSection')">Edit</button>
                        <button class="save-btn" onclick="saveSection('quotationSection')" style="display: none;">Save</button>
                        <button class="cancel-btn" onclick="cancelEdit('quotationSection')" style="display: none;">Cancel</button>
                    </div>
                </div>

                <div class="read-display">
                    <div class="read-item">
                        <div class="read-label">Quotation Number:</div>
                        <div class="read-value" id="read-quotationNumber">Not set</div>
                    </div>
                    <div class="read-item">
                        <div class="read-label">Date:</div>
                        <div class="read-value" id="read-quotationDate">Not set</div>
                    </div>
                    <div class="read-item">
                        <div class="read-label">Valid Until:</div>
                        <div class="read-value" id="read-validUntil">Not set</div>
                    </div>
                    <div class="read-item">
                        <div class="read-label">Currency:</div>
                        <div class="read-value" id="read-currency">Not set</div>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="quotationNumber">Quotation Number</label>
                        <input type="text" id="quotationNumber" placeholder="Q-001">
                    </div>
                    <div class="form-group">
                        <label for="quotationDate">Date</label>
                        <input type="date" id="quotationDate">
                    </div>
                    <div class="form-group">
                        <label for="validUntil">Valid Until</label>
                        <input type="date" id="validUntil">
                    </div>
                    <div class="form-group">
                        <label for="currency">Currency</label>
                        <select id="currency">
                            <option value="$">USD ($)</option>
                            <option value="€">EUR (€)</option>
                            <option value="£">GBP (£)</option>
                            <option value="¥">JPY (¥)</option>
                            <option value="RM">MYR (RM)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Line Items -->
            <div class="form-section" data-step="3" id="itemsSection">
                <div class="section-header">
                    <h3 class="section-title">Products/Services</h3>
                    <div class="edit-controls">
                        <button class="edit-btn" onclick="toggleEditMode('itemsSection')">Edit</button>
                        <button class="save-btn" onclick="saveSection('itemsSection')" style="display: none;">Save</button>
                        <button class="cancel-btn" onclick="cancelEdit('itemsSection')" style="display: none;">Cancel</button>
                    </div>
                </div>
                <div class="line-items">
                    <div id="lineItemsContainer">
                        <div class="line-item">
                            <div class="form-group">
                                <label>Description</label>
                                <input type="text" class="item-description" placeholder="Product or service description">
                            </div>
                            <div class="form-group">
                                <label>Quantity</label>
                                <input type="number" class="item-quantity" value="1" min="1">
                            </div>
                            <div class="form-group">
                                <label>Unit Price</label>
                                <input type="number" class="item-price" step="0.01" min="0" placeholder="0.00">
                            </div>
                            <div class="form-group">
                                <label>Total</label>
                                <input type="text" class="item-total" readonly>
                            </div>
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <button type="button" class="btn btn-danger remove-item">×</button>
                            </div>
                        </div>
                    </div>
                    <button type="button" id="addLineItem" class="btn btn-primary">Add Item</button>
                </div>

                <div class="totals">
                    <div class="total-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">$0.00</span>
                    </div>
                    <div class="total-row">
                        <span>Tax (%):</span>
                        <span>
                            <input type="number" id="taxRate" value="0" min="0" max="100" step="0.1" style="width: 80px; background: transparent; border: 1px solid #ecf0f1; color: white;">%
                        </span>
                    </div>
                    <div class="total-row">
                        <span>Tax Amount:</span>
                        <span id="taxAmount">$0.00</span>
                    </div>
                    <div class="total-row final-total">
                        <span>Total:</span>
                        <span id="grandTotal">$0.00</span>
                    </div>
                </div>
            </div>

            <!-- Additional Notes -->
            <div class="form-section" data-step="4" id="notesSection">
                <div class="section-header">
                    <h3 class="section-title">Additional Notes</h3>
                    <div class="edit-controls">
                        <button class="edit-btn" onclick="toggleEditMode('notesSection')">Edit</button>
                        <button class="save-btn" onclick="saveSection('notesSection')" style="display: none;">Save</button>
                        <button class="cancel-btn" onclick="cancelEdit('notesSection')" style="display: none;">Cancel</button>
                    </div>
                </div>

                <div class="read-display">
                    <div class="read-item">
                        <div class="read-label">Terms & Conditions / Notes:</div>
                        <div class="read-value" id="read-notes">Not set</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="notes">Terms & Conditions / Notes</label>
                    <textarea id="notes" placeholder="Payment terms, delivery information, or any additional notes"></textarea>
                </div>
            </div>

            <!-- Generate Quotation -->
            <div style="text-align: center; margin-top: 30px;">
                <button type="button" id="generateQuotation" class="btn btn-success">Generate Quotation</button>
            </div>

            <!-- Quotation Preview -->
            <div id="quotationPreview" class="quotation-preview hidden">
                <div class="quotation-header">
                    <img id="quotationLogo" class="quotation-logo" alt="Company Logo">
                    <h1>QUOTATION</h1>
                    <p id="previewQuotationNumber"></p>
                </div>
                
                <div class="quotation-details">
                    <div>
                        <h4>From:</h4>
                        <div id="previewCompanyDetails"></div>
                    </div>
                    <div>
                        <h4>To:</h4>
                        <div id="previewCustomerDetails"></div>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <strong>Date:</strong> <span id="previewDate"></span><br>
                    <strong>Valid Until:</strong> <span id="previewValidUntil"></span>
                </div>

                <table class="quotation-table">
                    <thead>
                        <tr>
                            <th>Description</th>
                            <th>Qty</th>
                            <th>Unit Price</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="previewLineItems">
                    </tbody>
                </table>

                <div style="text-align: right; margin-top: 20px;">
                    <div><strong>Subtotal:</strong> <span id="previewSubtotal"></span></div>
                    <div><strong>Tax:</strong> <span id="previewTax"></span></div>
                    <div style="font-size: 1.2em; margin-top: 10px;"><strong>Total:</strong> <span id="previewTotal"></span></div>
                </div>

                <div id="previewNotes" style="margin-top: 30px;"></div>

                <div style="text-align: center; margin-top: 30px; border-top: 1px solid #ddd; padding-top: 20px;">
                    <button type="button" onclick="window.print()" class="btn btn-primary">Print/Save as PDF</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Navigation -->
    <div class="mobile-nav">
        <div class="mobile-nav-buttons">
            <button class="mobile-nav-btn active" data-step="0">Company</button>
            <button class="mobile-nav-btn" data-step="1">Customer</button>
            <button class="mobile-nav-btn" data-step="2">Details</button>
            <button class="mobile-nav-btn" data-step="3">Items</button>
            <button class="mobile-nav-btn" data-step="4">Notes</button>
        </div>
    </div>

    <script>
        // In-memory storage for session data
        let savedCustomers = [];
        let companyLogo = null;
        let sectionBackups = {};
        let currentTheme = 'theme-neon-purple';

        // Mobile interface management
        let currentStep = 0;
        const totalSteps = 5;
        const stepTitles = ['Company Details', 'Customer Details', 'Quotation Info', 'Products/Services', 'Additional Notes'];

        // Theme management
        function toggleThemeSelector() {
            const selector = document.getElementById('themeSelector');
            selector.classList.toggle('open');
        }

        // Theme switching
        document.querySelectorAll('.theme-option').forEach(option => {
            option.addEventListener('click', function() {
                const theme = this.dataset.theme;
                document.body.className = theme;
                currentTheme = theme;
                
                // Visual feedback
                this.style.transform = 'scale(0.9)';
                setTimeout(() => {
                    this.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                    }, 150);
                }, 100);
            });
        });

        // Customer management
        function toggleCustomerPanel() {
            const panel = document.getElementById('customerPanel');
            const records = document.getElementById('customerRecords');
            
            if (records.classList.contains('show')) {
                records.classList.remove('show');
                panel.classList.remove('open');
            } else {
                records.classList.add('show');
                panel.classList.add('open');
                updateCustomerList();
            }
        }

        function saveCurrentCustomer() {
            const name = document.getElementById('newCustomerName').value.trim();
            if (!name) {
                alert('Please enter a customer name');
                return;
            }

            const customerData = {
                id: Date.now(),
                name: name,
                address: document.getElementById('customerAddress').value,
                phone: document.getElementById('customerPhone').value,
                email: document.getElementById('customerEmail').value
            };

            // Check if customer already exists
            const existingIndex = savedCustomers.findIndex(c => c.name.toLowerCase() === name.toLowerCase());
            if (existingIndex >= 0) {
                if (confirm('Customer with this name already exists. Update existing record?')) {
                    savedCustomers[existingIndex] = customerData;
                }
            } else {
                savedCustomers.push(customerData);
            }

            document.getElementById('newCustomerName').value = '';
            updateCustomerList();
            
            // Visual feedback
            const saveBtn = document.querySelector('.new-customer-form .save-btn');
            saveBtn.style.background = '#27ae60';
            saveBtn.textContent = 'Saved!';
            setTimeout(() => {
                saveBtn.style.background = '#3498db';
                saveBtn.textContent = 'Save Customer';
            }, 1500);
        }

        function loadCustomer(customerId) {
            const customer = savedCustomers.find(c => c.id === customerId);
            if (customer) {
                document.getElementById('customerName').value = customer.name;
                document.getElementById('customerAddress').value = customer.address;
                document.getElementById('customerPhone').value = customer.phone;
                document.getElementById('customerEmail').value = customer.email;
                
                // Update read displays
                updateReadDisplays('customerSection');
                
                // Visual feedback
                const customerSection = document.getElementById('customerSection');
                customerSection.style.borderLeftColor = '#27ae60';
                setTimeout(() => {
                    customerSection.style.borderLeftColor = '#3498db';
                }, 2000);
            }
        }

        function deleteCustomer(customerId) {
            if (confirm('Are you sure you want to delete this customer record?')) {
                savedCustomers = savedCustomers.filter(c => c.id !== customerId);
                updateCustomerList();
            }
        }

        function updateCustomerList() {
            const container = document.getElementById('savedCustomers');
            container.innerHTML = '';

            savedCustomers.forEach(customer => {
                const customerDiv = document.createElement('div');
                customerDiv.className = 'customer-record';
                customerDiv.innerHTML = `
                    <h4>${customer.name}</h4>
                    <p>${customer.address}</p>
                    <p>${customer.phone}</p>
                    <p>${customer.email}</p>
                    <div class="customer-actions">
                        <button class="customer-action-btn load-btn" onclick="loadCustomer(${customer.id})">Load</button>
                        <button class="customer-action-btn delete-btn" onclick="deleteCustomer(${customer.id})">Delete</button>
                    </div>
                `;
                container.appendChild(customerDiv);
            });
        }

        // Edit functionality
        function toggleEditMode(sectionId) {
            const section = document.getElementById(sectionId);
            const editBtn = section.querySelector('.edit-btn');
            const saveBtn = section.querySelector('.save-btn');
            const cancelBtn = section.querySelector('.cancel-btn');

            // Backup current values
            backupSectionData(sectionId);

            // Switch to edit mode
            section.classList.remove('read-mode');
            section.classList.add('edit-mode');
            editBtn.style.display = 'none';
            saveBtn.style.display = 'inline-block';
            cancelBtn.style.display = 'inline-block';

            // Visual feedback
            section.style.transform = 'scale(1.02)';
            setTimeout(() => {
                section.style.transform = 'scale(1)';
            }, 200);
        }

        function saveSection(sectionId) {
            const section = document.getElementById(sectionId);
            const editBtn = section.querySelector('.edit-btn');
            const saveBtn = section.querySelector('.save-btn');
            const cancelBtn = section.querySelector('.cancel-btn');

            // Update read-only displays
            updateReadDisplays(sectionId);

            // Switch to read mode
            section.classList.remove('edit-mode');
            section.classList.add('read-mode');
            editBtn.style.display = 'inline-block';
            saveBtn.style.display = 'none';
            cancelBtn.style.display = 'none';

            // Clear backup
            delete sectionBackups[sectionId];

            // Visual feedback
            section.style.transform = 'scale(0.98)';
            setTimeout(() => {
                section.style.transform = 'scale(1)';
            }, 200);

            // Update calculations if needed
            if (sectionId === 'itemsSection') {
                updateGrandTotal();
            }
        }

        function cancelEdit(sectionId) {
            const section = document.getElementById(sectionId);
            const editBtn = section.querySelector('.edit-btn');
            const saveBtn = section.querySelector('.save-btn');
            const cancelBtn = section.querySelector('.cancel-btn');

            // Restore backed up values
            restoreSectionData(sectionId);

            // Switch to read mode
            section.classList.remove('edit-mode');
            section.classList.add('read-mode');
            editBtn.style.display = 'inline-block';
            saveBtn.style.display = 'none';
            cancelBtn.style.display = 'none';

            // Visual feedback
            section.style.transform = 'scale(1.02)';
            setTimeout(() => {
                section.style.transform = 'scale(1)';
            }, 200);
        }

        function backupSectionData(sectionId) {
            const section = document.getElementById(sectionId);
            const inputs = section.querySelectorAll('input, textarea, select');
            sectionBackups[sectionId] = {};
            
            inputs.forEach(input => {
                sectionBackups[sectionId][input.id || input.className] = input.value;
            });
        }

        function restoreSectionData(sectionId) {
            if (!sectionBackups[sectionId]) return;
            
            const section = document.getElementById(sectionId);
            const inputs = section.querySelectorAll('input, textarea, select');
            
            inputs.forEach(input => {
                const key = input.id || input.className;
                if (sectionBackups[sectionId][key] !== undefined) {
                    input.value = sectionBackups[sectionId][key];
                }
            });

            // Update calculations if needed
            if (sectionId === 'itemsSection') {
                updateGrandTotal();
            }
        }

        function updateReadDisplays(sectionId) {
            if (sectionId === 'companySection') {
                document.getElementById('read-companyName').textContent = 
                    document.getElementById('companyName').value || 'Not set';
                document.getElementById('read-companyAddress').textContent = 
                    document.getElementById('companyAddress').value || 'Not set';
                document.getElementById('read-companyPhone').textContent = 
                    document.getElementById('companyPhone').value || 'Not set';
                document.getElementById('read-companyEmail').textContent = 
                    document.getElementById('companyEmail').value || 'Not set';
            } else if (sectionId === 'customerSection') {
                document.getElementById('read-customerName').textContent = 
                    document.getElementById('customerName').value || 'Not set';
                document.getElementById('read-customerAddress').textContent = 
                    document.getElementById('customerAddress').value || 'Not set';
                document.getElementById('read-customerPhone').textContent = 
                    document.getElementById('customerPhone').value || 'Not set';
                document.getElementById('read-customerEmail').textContent = 
                    document.getElementById('customerEmail').value || 'Not set';
            } else if (sectionId === 'quotationSection') {
                document.getElementById('read-quotationNumber').textContent = 
                    document.getElementById('quotationNumber').value || 'Not set';
                document.getElementById('read-quotationDate').textContent = 
                    document.getElementById('quotationDate').value || 'Not set';
                document.getElementById('read-validUntil').textContent = 
                    document.getElementById('validUntil').value || 'Not set';
                document.getElementById('read-currency').textContent = 
                    document.getElementById('currency').selectedOptions[0].text || 'Not set';
            } else if (sectionId === 'notesSection') {
                document.getElementById('read-notes').textContent = 
                    document.getElementById('notes').value || 'Not set';
            }
        }

        function saveAllSections() {
            const sections = ['companySection', 'customerSection', 'quotationSection', 'itemsSection', 'notesSection'];
            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section.classList.contains('edit-mode')) {
                    saveSection(sectionId);
                }
            });

            // Visual feedback
            const saveBtn = document.querySelector('.save-all-btn');
            const originalBg = saveBtn.style.background;
            saveBtn.style.background = 'linear-gradient(45deg, #27ae60, #229954)';
            saveBtn.innerHTML = '✓';
            setTimeout(() => {
                saveBtn.style.background = originalBg;
                saveBtn.innerHTML = '💾';
            }, 1500);
        }

        // Initialize mobile interface
        function initMobileInterface() {
            if (window.innerWidth <= 768) {
                showMobileStep(0);
                updateMobileNavigation();
            } else {
                showAllSteps();
            }
        }

        function showMobileStep(step) {
            const sections = document.querySelectorAll('.form-section');
            sections.forEach((section, index) => {
                if (index === step) {
                    section.classList.remove('hidden-mobile');
                    section.style.animation = 'slideInUp 0.6s ease';
                } else {
                    section.classList.add('hidden-mobile');
                }
            });

            // Update step indicator
            const stepTitle = document.getElementById('stepTitle');
            if (stepTitle) {
                stepTitle.textContent = stepTitles[step];
            }

            // Update step dots
            const stepDots = document.querySelectorAll('.step-dot');
            stepDots.forEach((dot, index) => {
                if (index === step) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });

            currentStep = step;
        }

        function showAllSteps() {
            const sections = document.querySelectorAll('.form-section');
            sections.forEach(section => {
                section.classList.remove('hidden-mobile');
            });
        }

        function updateMobileNavigation() {
            const navButtons = document.querySelectorAll('.mobile-nav-btn');
            navButtons.forEach((btn, index) => {
                if (index === currentStep) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // Mobile navigation event listeners
        document.querySelectorAll('.mobile-nav-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const step = parseInt(this.dataset.step);
                showMobileStep(step);
                updateMobileNavigation();
                
                // Smooth scroll to top on mobile
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });

        // Touch gestures for mobile
        let touchStartX = 0;
        let touchEndX = 0;

        function handleGesture() {
            if (window.innerWidth > 768) return;
            
            const threshold = 50;
            const difference = touchEndX - touchStartX;

            if (Math.abs(difference) > threshold) {
                if (difference > 0 && currentStep > 0) {
                    showMobileStep(currentStep - 1);
                    updateMobileNavigation();
                } else if (difference < 0 && currentStep < totalSteps - 1) {
                    showMobileStep(currentStep + 1);
                    updateMobileNavigation();
                }
            }
        }

        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleGesture();
        });

        // Window resize handler
        window.addEventListener('resize', function() {
            initMobileInterface();
        });

        // Logo management
        function triggerLogoUpload() {
            document.getElementById('logoUploadInput').click();
        }

        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                if (!file.type.startsWith('image/')) {
                    alert('Please select a valid image file (PNG, JPG, SVG, etc.)');
                    return;
                }

                if (file.size > 5 * 1024 * 1024) {
                    alert('Logo file size must be less than 5MB');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    companyLogo = e.target.result;
                    displayLogo(companyLogo);
                };
                reader.readAsDataURL(file);
            }
        }

        function displayLogo(logoData) {
            const logoPreview = document.getElementById('logoPreview');
            const logoUploadSection = document.getElementById('logoUploadSection');
            const logoUploadContent = document.getElementById('logoUploadContent');
            const logoRemoveBtn = document.getElementById('logoRemoveBtn');

            logoPreview.src = logoData;
            logoPreview.classList.add('visible');
            logoUploadSection.classList.add('has-logo');
            logoUploadContent.style.marginTop = '0';
            logoRemoveBtn.style.display = 'inline-block';

            const logoReadItem = document.getElementById('logoReadItem');
            const logoReadPreview = document.getElementById('logoReadPreview');
            logoReadPreview.src = logoData;
            logoReadItem.style.display = 'block';

            const quotationLogo = document.getElementById('quotationLogo');
            quotationLogo.src = logoData;
            quotationLogo.classList.add('visible');
        }

        function removeLogo(event) {
            event.stopPropagation();
            
            companyLogo = null;
            
            const logoPreview = document.getElementById('logoPreview');
            const logoUploadSection = document.getElementById('logoUploadSection');
            const logoUploadContent = document.getElementById('logoUploadContent');
            const logoRemoveBtn = document.getElementById('logoRemoveBtn');
            const logoUploadInput = document.getElementById('logoUploadInput');

            logoPreview.classList.remove('visible');
            logoUploadSection.classList.remove('has-logo');
            logoUploadContent.style.marginTop = '';
            logoRemoveBtn.style.display = 'none';
            logoUploadInput.value = '';

            document.getElementById('logoReadItem').style.display = 'none';
            document.getElementById('quotationLogo').classList.remove('visible');
        }

        // Line item management
        let lineItemCount = 1;

        function addLineItem() {
            lineItemCount++;
            const container = document.getElementById('lineItemsContainer');
            const newItem = document.createElement('div');
            newItem.className = 'line-item';
            newItem.innerHTML = `
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" class="item-description" placeholder="Product or service description">
                </div>
                <div class="form-group">
                    <label>Quantity</label>
                    <input type="number" class="item-quantity" value="1" min="1">
                </div>
                <div class="form-group">
                    <label>Unit Price</label>
                    <input type="number" class="item-price" step="0.01" min="0" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Total</label>
                    <input type="text" class="item-total" readonly>
                </div>
                <div class="form-group">
                    <label>&nbsp;</label>
                    <button type="button" class="btn btn-danger remove-item">×</button>
                </div>
            `;
            container.appendChild(newItem);
            addLineItemEventListeners(newItem);

            if (window.innerWidth <= 768) {
                newItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function addLineItemEventListeners(item) {
            const quantity = item.querySelector('.item-quantity');
            const price = item.querySelector('.item-price');
            const total = item.querySelector('.item-total');
            const removeBtn = item.querySelector('.remove-item');

            function updateTotal() {
                const qty = parseFloat(quantity.value) || 0;
                const unitPrice = parseFloat(price.value) || 0;
                const itemTotal = qty * unitPrice;
                total.value = formatCurrency(itemTotal);
                updateGrandTotal();
            }

            quantity.addEventListener('input', updateTotal);
            price.addEventListener('input', updateTotal);

            removeBtn.addEventListener('click', function() {
                if (document.querySelectorAll('.line-item').length > 1) {
                    item.remove();
                    updateGrandTotal();
                }
            });
        }

        function formatCurrency(amount) {
            const currency = document.getElementById('currency').value;
            return currency + amount.toFixed(2);
        }

        function updateGrandTotal() {
            const lineItems = document.querySelectorAll('.line-item');
            let subtotal = 0;

            lineItems.forEach(item => {
                const qty = parseFloat(item.querySelector('.item-quantity').value) || 0;
                const price = parseFloat(item.querySelector('.item-price').value) || 0;
                subtotal += qty * price;
            });

            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const taxAmount = subtotal * (taxRate / 100);
            const grandTotal = subtotal + taxAmount;

            document.getElementById('subtotal').textContent = formatCurrency(subtotal);
            document.getElementById('taxAmount').textContent = formatCurrency(taxAmount);
            document.getElementById('grandTotal').textContent = formatCurrency(grandTotal);
        }

        function generateQuotation() {
            document.getElementById('previewQuotationNumber').textContent = 
                'Quotation #' + document.getElementById('quotationNumber').value;

            const companyDetails = `
                <strong>${document.getElementById('companyName').value}</strong><br>
                ${document.getElementById('companyAddress').value.replace(/\n/g, '<br>')}<br>
                Phone: ${document.getElementById('companyPhone').value}<br>
                Email: ${document.getElementById('companyEmail').value}
            `;
            document.getElementById('previewCompanyDetails').innerHTML = companyDetails;

            const customerDetails = `
                <strong>${document.getElementById('customerName').value}</strong><br>
                ${document.getElementById('customerAddress').value.replace(/\n/g, '<br>')}<br>
                Phone: ${document.getElementById('customerPhone').value}<br>
                Email: ${document.getElementById('customerEmail').value}
            `;
            document.getElementById('previewCustomerDetails').innerHTML = customerDetails;

            document.getElementById('previewDate').textContent = document.getElementById('quotationDate').value;
            document.getElementById('previewValidUntil').textContent = document.getElementById('validUntil').value;

            const lineItemsContainer = document.getElementById('previewLineItems');
            lineItemsContainer.innerHTML = '';
            
            const lineItems = document.querySelectorAll('.line-item');
            lineItems.forEach(item => {
                const description = item.querySelector('.item-description').value;
                const quantity = item.querySelector('.item-quantity').value;
                const price = parseFloat(item.querySelector('.item-price').value) || 0;
                const total = quantity * price;

                if (description) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${description}</td>
                        <td class="text-right">${quantity}</td>
                        <td class="text-right">${formatCurrency(price)}</td>
                        <td class="text-right">${formatCurrency(total)}</td>
                    `;
                    lineItemsContainer.appendChild(row);
                }
            });

            document.getElementById('previewSubtotal').textContent = document.getElementById('subtotal').textContent;
            document.getElementById('previewTax').textContent = document.getElementById('taxAmount').textContent;
            document.getElementById('previewTotal').textContent = document.getElementById('grandTotal').textContent;

            const notes = document.getElementById('notes').value;
            if (notes) {
                document.getElementById('previewNotes').innerHTML = `
                    <h4>Terms & Conditions / Notes:</h4>
                    <p>${notes.replace(/\n/g, '<br>')}</p>
                `;
            } else {
                document.getElementById('previewNotes').innerHTML = '';
            }

            if (companyLogo) {
                const quotationLogo = document.getElementById('quotationLogo');
                quotationLogo.src = companyLogo;
                quotationLogo.classList.add('visible');
            }

            document.getElementById('quotationPreview').classList.remove('hidden');
            document.getElementById('quotationPreview').scrollIntoView({ behavior: 'smooth' });
        }

        // Event listeners
        document.getElementById('addLineItem').addEventListener('click', addLineItem);
        document.getElementById('generateQuotation').addEventListener('click', generateQuotation);
        document.getElementById('taxRate').addEventListener('input', updateGrandTotal);
        document.getElementById('currency').addEventListener('change', updateGrandTotal);

        // Close theme selector when clicking outside
        document.addEventListener('click', function(e) {
            const themeSelector = document.getElementById('themeSelector');
            const customerPanel = document.getElementById('customerPanel');
            
            if (!themeSelector.contains(e.target)) {
                themeSelector.classList.remove('open');
            }
            
            if (!customerPanel.contains(e.target)) {
                customerPanel.classList.remove('open');
                document.getElementById('customerRecords').classList.remove('show');
            }
        });

        // Initialize
        function init() {
            // Set today's date
            document.getElementById('quotationDate').value = new Date().toISOString().split('T')[0];
            
            // Set valid until date (30 days from today)
            const validUntilDate = new Date();
            validUntilDate.setDate(validUntilDate.getDate() + 30);
            document.getElementById('validUntil').value = validUntilDate.toISOString().split('T')[0];

            // Auto-generate quotation number
            document.getElementById('quotationNumber').value = 'Q-' + Date.now().toString().slice(-6);

            // Add event listeners to initial line item
            addLineItemEventListeners(document.querySelector('.line-item'));

            // Initialize calculations
            updateGrandTotal();

            // Initialize mobile interface
            initMobileInterface();

            // Initialize all sections in edit mode
            const sections = ['companySection', 'customerSection', 'quotationSection', 'notesSection'];
            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                section.classList.add('edit-mode');
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>
