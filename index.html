<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuoteFlow Pro - Complete Business Document Generator</title>
    <meta name="description" content="Professional business document generator for quotations, invoices, and receipts with PDF export">
    <meta name="keywords" content="quotation, invoice, receipt, business app, PDF generator">
    
    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #2c3e50;
            line-height: 1.6;
            padding-bottom: 80px;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ===== HEADER SECTION ===== */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 40px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        /* ===== NAVIGATION ===== */
        .document-nav {
            display: flex;
            background: white;
            border-radius: 20px;
            padding: 8px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .document-nav-btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: transparent;
            color: #7f8c8d;
            position: relative;
            overflow: hidden;
        }

        .document-nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }

        .document-nav-btn:hover::before {
            left: 100%;
        }

        .document-nav-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .document-nav-btn.invoice.active {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.3);
        }

        .document-nav-btn.receipt.active {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            box-shadow: 0 8px 25px rgba(168, 237, 234, 0.3);
        }

        /* ===== PAGE SYSTEM ===== */
        .page {
            display: none;
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== CARD SYSTEM ===== */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
        }

        .card-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 50px;
            height: 3px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        /* ===== FORM SYSTEM ===== */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
            transition: color 0.3s ease;
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e0e6ed;
            border-radius: 12px;
            font-size: 16px;
            background: rgba(255,255,255,0.9);
            color: #2c3e50;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .form-input:focus + .form-label {
            color: #667eea;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        /* ===== BUTTON SYSTEM ===== */
        .btn {
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(79, 172, 254, 0.4);
        }

        .btn-receipt {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(168, 237, 234, 0.3);
        }

        .btn-receipt:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(168, 237, 234, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(255, 154, 158, 0.3);
        }

        /* ===== STATUS BADGE ===== */
        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 15px;
        }

        .status-quote {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .status-invoice {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .status-receipt {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: white;
        }

        /* ===== LOGO UPLOAD SYSTEM ===== */
        .logo-upload {
            border: 3px dashed #667eea;
            border-radius: 16px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            margin-bottom: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .logo-upload::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.3s ease;
            opacity: 0;
        }

        .logo-upload:hover::before {
            opacity: 1;
            animation: shimmer 1.5s ease-in-out;
        }

        .logo-upload:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.2);
            border-color: #764ba2;
        }

        .logo-preview {
            max-width: 150px;
            max-height: 80px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .logo-preview:hover {
            transform: scale(1.05);
        }

        .logo-icon {
            font-size: 48px;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-text {
            font-size: 16px;
            color: #7f8c8d;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .logo-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .logo-actions .btn {
            margin: 0;
            padding: 12px 20px;
            font-size: 14px;
        }

        /* ===== DOCUMENT STYLES ===== */
        .line-items {
            background: rgba(255,255,255,0.7);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .line-item {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(255,255,255,0.3);
            position: relative;
            transition: all 0.3s ease;
        }

        .line-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 0 4px 4px 0;
        }

        .line-item:hover {
            transform: translateX(5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.12);
        }

        .line-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .item-number {
            font-size: 12px;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 8px 16px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .remove-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(255, 154, 158, 0.4);
        }

        .total-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 15px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 18px;
            margin-top: 15px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .totals-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            margin: 25px 0;
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
            position: relative;
            overflow: hidden;
        }

        .totals-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 4s infinite;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 16px;
            position: relative;
            z-index: 1;
        }

        .total-row:last-child {
            border-top: 2px solid rgba(255,255,255,0.3);
            padding-top: 15px;
            font-size: 22px;
            font-weight: 700;
            margin-top: 15px;
        }

        .tax-input {
            width: 80px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            text-align: center;
            border-radius: 8px;
            padding: 8px;
            font-size: 16px;
            backdrop-filter: blur(10px);
        }

        .tax-input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        /* ===== PAYMENT INFO STYLES ===== */
        .payment-status {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid #e0e6ed;
        }

        .payment-method-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .payment-method {
            padding: 15px;
            border: 2px solid #e0e6ed;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .payment-method:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .payment-method.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .payment-method-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .payment-method-text {
            font-size: 12px;
            font-weight: 600;
            color: #2c3e50;
        }

        /* ===== PREVIEW STYLES ===== */
        .preview {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .document-preview-header {
            border-bottom: 4px solid #667eea;
            padding-bottom: 25px;
            margin-bottom: 30px;
            position: relative;
        }

        .document-preview-header.invoice {
            border-bottom-color: #4facfe;
        }

        .document-preview-header.receipt {
            border-bottom-color: #a8edea;
        }

        .document-preview-header::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 100px;
            height: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        .document-preview-header.invoice::after {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .document-preview-header.receipt::after {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }

        .document-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .detail-column {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 16px;
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .detail-column:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .detail-title {
            font-size: 14px;
            font-weight: 700;
            color: #2c3e50;
            margin: 0 0 15px 0;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .detail-box {
            font-size: 15px;
            line-height: 1.8;
            color: #34495e;
        }

        .detail-box strong {
            color: #2c3e50;
            font-weight: 600;
        }

        .document-info-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 20px 25px;
            border-radius: 16px;
            margin-bottom: 30px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .document-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .info-label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 15px;
        }

        .info-value {
            font-weight: 500;
            color: #34495e;
            font-size: 15px;
        }

        .document-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-radius: 16px;
            overflow: hidden;
            background: white;
        }

        .document-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 15px;
            font-weight: 600;
            font-size: 14px;
            letter-spacing: 0.5px;
            border: none;
            text-transform: uppercase;
        }

        .document-table td {
            padding: 18px 15px;
            border-bottom: 1px solid #f8f9fa;
            font-size: 15px;
            color: #2c3e50;
            transition: all 0.3s ease;
        }

        .document-table tbody tr:last-child td {
            border-bottom: none;
        }

        .document-table tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        .document-table tbody tr:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
            transform: scale(1.01);
        }

        .document-totals-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 16px;
            border: 2px solid #e0e6ed;
            position: relative;
        }

        .document-totals-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px 16px 0 0;
        }

        .totals-rows {
            max-width: 350px;
            margin-left: auto;
        }

        .total-row-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            font-size: 16px;
        }

        .total-label {
            font-weight: 600;
            color: #2c3e50;
        }

        .total-value {
            font-weight: 600;
            color: #34495e;
            text-align: right;
            min-width: 120px;
            font-family: 'Courier New', monospace;
        }

        .grand-total-row {
            border-top: 3px solid #667eea;
            margin-top: 15px;
            padding-top: 15px;
            font-size: 20px;
        }

        .grand-total-value {
            color: #667eea;
            font-weight: 700;
            font-size: 20px;
        }

        .document-notes-section {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 16px;
            border-left: 5px solid #667eea;
        }

        .notes-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .notes-content {
            font-size: 15px;
            line-height: 1.8;
            color: #34495e;
        }

        /* ===== FLOATING ACTION BUTTON ===== */
        .fab {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
            z-index: 999;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.6);
        }

        .fab:active {
            transform: scale(0.95);
        }

        /* ===== NOTIFICATION SYSTEM ===== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            animation: slideInRight 0.3s ease;
            max-width: 300px;
            word-wrap: break-word;
        }

        .notification.success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ===== WORKFLOW BUTTONS ===== */
        .workflow-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .workflow-btn {
            flex: 1;
            min-width: 200px;
            padding: 18px 25px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .workflow-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 28px;
            }

            .header p {
                font-size: 14px;
            }

            .form-row, .form-row-3 {
                grid-template-columns: 1fr;
            }

            .document-details-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .document-info-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .document-table {
                font-size: 13px;
            }

            .document-table th,
            .document-table td {
                padding: 12px 8px;
            }

            .totals-rows {
                max-width: 100%;
            }

            .fab {
                bottom: 20px;
                right: 20px;
                width: 56px;
                height: 56px;
                font-size: 24px;
            }

            .payment-method-grid {
                grid-template-columns: 1fr;
            }

            .workflow-actions {
                flex-direction: column;
            }

            .workflow-btn {
                min-width: auto;
            }

            .document-nav-btn {
                font-size: 14px;
                padding: 15px 10px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 30px 20px;
            }

            .card {
                padding: 20px;
            }

            .document-table,
            .document-table thead,
            .document-table tbody,
            .document-table th,
            .document-table td,
            .document-table tr {
                display: block;
            }

            .document-table thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }

            .document-table tr {
                border: 1px solid #e0e6ed;
                margin-bottom: 15px;
                padding: 15px;
                border-radius: 12px;
                background: white;
                box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            }

            .document-table td {
                border: none;
                position: relative;
                padding-left: 50%;
                text-align: right;
                padding-bottom: 10px;
            }

            .document-table td:before {
                content: attr(data-label) ": ";
                position: absolute;
                left: 6px;
                width: 45%;
                text-align: left;
                font-weight: bold;
                color: #2c3e50;
            }
        }

        /* ===== UTILITY CLASSES ===== */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .hidden { display: none !important; }
        .visible { display: block !important; }

        /* ===== LOADING ANIMATIONS ===== */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== PRINT STYLES ===== */
        @media print {
            .fab, .document-nav, .workflow-actions {
                display: none !important;
            }
            
            .container {
                max-width: none;
                padding: 0;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #ccc;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- ===== MAIN HEADER ===== -->
        <header class="header">
            <h1>📄 QuoteFlow Pro</h1>
            <p>Complete Business Document Generator - Quotes, Invoices & Receipts</p>
        </header>

        <!-- ===== DOCUMENT NAVIGATION ===== -->
        <nav class="document-nav" role="navigation">
            <button class="document-nav-btn active" onclick="switchDocument('quotation')" aria-label="Quotations">
                📄 Quotation
            </button>
            <button class="document-nav-btn invoice" onclick="switchDocument('invoice')" aria-label="Invoices">
                🧾 Invoice
            </button>
            <button class="document-nav-btn receipt" onclick="switchDocument('receipt')" aria-label="Receipts">
                🧾 Receipt
            </button>
        </nav>

        <!-- ===== QUOTATION PAGE ===== -->
        <main class="page active" id="quotationPage">
            <!-- Status and Workflow Actions -->
            <div class="workflow-actions">
                <button type="button" class="btn btn-success workflow-btn" onclick="generateAndShowPDF('quotation')" style="font-size: 16px;">
                    📄 Generate Quotation
                </button>
                <button type="button" class="btn btn-success workflow-btn" id="convertToInvoiceBtn" onclick="convertToInvoice()" style="font-size: 16px;" disabled>
                    🧾 Convert to Invoice
                </button>
            </div>

            <!-- Company Information Card -->
            <section class="card">
                <h2 class="card-title">
                    🏢 Company Information
                </h2>
                
                <!-- Logo Upload Section -->
                <div class="form-group">
                    <label class="form-label">Company Logo</label>
                    <div class="logo-upload" onclick="document.getElementById('logoUploadInput').click()">
                        <img id="logoPreview" class="logo-preview" alt="Company Logo" style="display: none;">
                        <div id="logoUploadContent">
                            <div class="logo-icon">🏢</div>
                            <div class="logo-text">Click to upload your company logo</div>
                            <div class="logo-actions">
                                <span class="btn btn-primary" style="margin: 8px; cursor: pointer;">
                                    Choose Logo
                                </span>
                                <button type="button" class="btn btn-danger" id="logoRemoveBtn" style="display: none; margin: 8px;" onclick="event.stopPropagation(); removeLogo()">Remove Logo</button>
                            </div>
                        </div>
                        <input type="file" id="logoUploadInput" style="display: none;" accept="image/*">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Company Name *</label>
                    <input type="text" class="form-input" id="companyName" placeholder="Enter your company name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Company Address</label>
                    <textarea class="form-input form-textarea" id="companyAddress" placeholder="Enter your complete company address"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" class="form-input" id="companyPhone" placeholder="+1 (555) 123-4567">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-input" id="companyEmail" placeholder="contact@yourcompany.com">
                    </div>
                </div>
            </section>

            <!-- Customer Information Card -->
            <section class="card">
                <h2 class="card-title">
                    👤 Customer Information
                </h2>
                <div class="form-group">
                    <label class="form-label">Customer Name *</label>
                    <input type="text" class="form-input" id="customerName" placeholder="Customer or company name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Customer Address</label>
                    <textarea class="form-input form-textarea" id="customerAddress" placeholder="Customer's complete address"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" class="form-input" id="customerPhone" placeholder="+1 (555) 987-6543">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-input" id="customerEmail" placeholder="customer@email.com">
                    </div>
                </div>
            </section>

            <!-- Quotation Details Card -->
            <section class="card">
                <h2 class="card-title">
                    📄 Quotation Details
                </h2>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Quotation Number</label>
                        <input type="text" class="form-input" id="quotationNumber" placeholder="Q-001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quotation Date</label>
                        <input type="date" class="form-input" id="quotationDate">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Valid Until</label>
                        <input type="date" class="form-input" id="validUntil">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Currency</label>
                        <select class="form-input" id="currency">
                            <option value="$">USD ($)</option>
                            <option value="€">EUR (€)</option>
                            <option value="£">GBP (£)</option>
                            <option value="¥">JPY (¥)</option>
                            <option value="RM">MYR (RM)</option>
                            <option value="₹">INR (₹)</option>
                        </select>
                    </div>
                </div>
            </section>

            <!-- Products & Services Card -->
            <section class="card">
                <h2 class="card-title">
                    📦 Products & Services
                </h2>
                <div class="line-items">
                    <div id="lineItemsContainer">
                        <div class="line-item">
                            <div class="line-item-header">
                                <span class="item-number">Item #1</span>
                                <button class="remove-btn" onclick="removeLineItem(this)" aria-label="Remove item">×</button>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Description *</label>
                                <input type="text" class="form-input item-description" placeholder="Product or service description" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Quantity</label>
                                    <input type="number" class="form-input item-quantity" value="1" min="1" step="1">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Unit Price *</label>
                                    <input type="number" class="form-input item-price" step="0.01" min="0" placeholder="0.00" required>
                                </div>
                            </div>
                            <div class="total-display item-total">$0.00</div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="addLineItem()" style="width: 100%; margin-top: 20px;">
                        ➕ Add Another Item
                    </button>
                </div>

                <!-- Totals Section -->
                <div class="totals-card">
                    <div class="total-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">$0.00</span>
                    </div>
                    <div class="total-row">
                        <span>Tax Rate (%):</span>
                        <div>
                            <input type="number" class="tax-input" id="taxRate" value="0" min="0" max="100" step="0.1" placeholder="0">%
                        </div>
                    </div>
                    <div class="total-row">
                        <span>Tax Amount:</span>
                        <span id="taxAmount">$0.00</span>
                    </div>
                    <div class="total-row">
                        <span>Total Amount:</span>
                        <span id="grandTotal">$0.00</span>
                    </div>
                </div>
            </section>

            <!-- Terms & Notes Card -->
            <section class="card">
                <h2 class="card-title">
                    📝 Terms & Additional Notes
                </h2>
                <div class="form-group">
                    <label class="form-label">Terms & Conditions / Notes</label>
                    <textarea class="form-input form-textarea" id="notes" placeholder="Payment terms, delivery information, or any additional notes" rows="4"></textarea>
                </div>
            </section>
        </main>

        <!-- ===== INVOICE PAGE ===== -->
        <main class="page" id="invoicePage">
            <!-- Status and Workflow Actions -->
            <div class="workflow-actions">
                <button type="button" class="btn btn-success workflow-btn" onclick="generateAndShowPDF('invoice')" style="font-size: 16px;">
                    🧾 Generate Invoice
                </button>
                <button type="button" class="btn btn-receipt workflow-btn" id="generateReceiptBtn" onclick="generateReceipt()" style="font-size: 16px;" disabled>
                    🧾 Generate Receipt
                </button>
            </div>

            <!-- Invoice Details Card -->
            <section class="card">
                <h2 class="card-title">
                    🧾 Invoice Details
                </h2>
                <div class="status-badge status-invoice">Invoice Status: Unpaid</div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Invoice Number</label>
                        <input type="text" class="form-input" id="invoiceNumber" placeholder="INV-001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Invoice Date</label>
                        <input type="date" class="form-input" id="invoiceDate">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Due Date</label>
                        <input type="date" class="form-input" id="dueDate">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Payment Terms</label>
                        <select class="form-input" id="paymentTerms">
                            <option value="net15">Net 15 days</option>
                            <option value="net30">Net 30 days</option>
                            <option value="net45">Net 45 days</option>
                            <option value="net60">Net 60 days</option>
                            <option value="due_on_receipt">Due on Receipt</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                </div>
            </section>

            <!-- Payment Information Card -->
            <section class="card">
                <h2 class="card-title">
                    💳 Payment Information
                </h2>
                <div class="form-group">
                    <label class="form-label">Payment Instructions</label>
                    <textarea class="form-input form-textarea" id="paymentInstructions" placeholder="Bank details, payment methods, or special instructions" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Late Fee Policy</label>
                    <input type="text" class="form-input" id="lateFee" placeholder="e.g., 2% per month on overdue amount">
                </div>
            </section>
        </main>

        <!-- ===== RECEIPT PAGE ===== -->
        <main class="page" id="receiptPage">
            <!-- Status and Workflow Actions -->
            <div class="workflow-actions">
                <button type="button" class="btn btn-receipt workflow-btn" onclick="generateAndShowPDF('receipt')" style="font-size: 16px;">
                    🧾 Generate Receipt
                </button>
            </div>

            <!-- Receipt Details Card -->
            <section class="card">
                <h2 class="card-title">
                    🧾 Receipt Details
                </h2>
                <div class="status-badge status-receipt">Receipt Status: Paid</div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Receipt Number</label>
                        <input type="text" class="form-input" id="receiptNumber" placeholder="RCP-001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Payment Date</label>
                        <input type="date" class="form-input" id="paymentDate">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Transaction ID</label>
                        <input type="text" class="form-input" id="transactionId" placeholder="TXN-12345">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Reference Invoice</label>
                        <input type="text" class="form-input" id="referenceInvoice" placeholder="INV-001">
                    </div>
                </div>
            </section>

            <!-- Payment Details Card -->
            <section class="card">
                <h2 class="card-title">
                    💰 Payment Details
                </h2>
                <div class="form-group">
                    <label class="form-label">Payment Method</label>
                    <div class="payment-method-grid">
                        <div class="payment-method" onclick="selectPaymentMethod(this, 'cash')">
                            <div class="payment-method-icon">💵</div>
                            <div class="payment-method-text">Cash</div>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod(this, 'card')">
                            <div class="payment-method-icon">💳</div>
                            <div class="payment-method-text">Credit/Debit Card</div>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod(this, 'bank')">
                            <div class="payment-method-icon">🏦</div>
                            <div class="payment-method-text">Bank Transfer</div>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod(this, 'check')">
                            <div class="payment-method-icon">📄</div>
                            <div class="payment-method-text">Check</div>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod(this, 'digital')">
                            <div class="payment-method-icon">📱</div>
                            <div class="payment-method-text">Digital Wallet</div>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod(this, 'other')">
                            <div class="payment-method-icon">💰</div>
                            <div class="payment-method-text">Other</div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Amount Paid</label>
                        <input type="number" class="form-input" id="amountPaid" step="0.01" min="0" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Payment Note</label>
                        <input type="text" class="form-input" id="paymentNote" placeholder="Additional payment information">
                    </div>
                </div>
            </section>
        </main>

        <!-- ===== PDF SHARE VIEW ===== -->
        <section id="pdfShareView" class="preview" style="display: none;">
            <div class="document-preview-header" id="shareHeader">
                <h1 style="text-align: center; font-size: 36px; font-weight: 800; color: #2c3e50; margin: 0 0 8px 0; letter-spacing: 2px;">📄 Document Ready!</h1>
                <p id="shareDocumentNumber" style="text-align: center; color: #7f8c8d; margin: 0 0 25px 0; font-size: 18px;"></p>
            </div>
            
            <div style="text-align: center; margin: 40px 0;">
                <div style="font-size: 64px; margin-bottom: 20px;" id="shareIcon">✅</div>
                <div style="font-size: 20px; font-weight: 600; color: #4facfe; margin-bottom: 10px;" id="shareTitle">
                    Your professional document is ready!
                </div>
                <div style="font-size: 16px; color: #7f8c8d; margin-bottom: 25px;" id="shareSubtitle">
                    Choose how you want to share or save your document
                </div>
            </div>

            <!-- Share Options Grid -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
                <button type="button" class="btn btn-primary" onclick="downloadPDF()" style="font-size: 14px;">
                    💾 Download PDF
                </button>
                <button type="button" class="btn btn-success" onclick="sharePDF()" style="font-size: 14px;">
                    📤 Share PDF
                </button>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
                <button type="button" class="btn" onclick="emailPDF()" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); color: white; font-size: 14px;">
                    📧 Email Document
                </button>
                <button type="button" class="btn" onclick="printPDF()" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: white; font-size: 14px;">
                    🖨️ Print Document
                </button>
            </div>

            <!-- Preview Toggle -->
            <button type="button" class="btn" id="previewToggleBtn" onclick="togglePreview()" style="width: 100%; background: #f8f9fa; color: #2c3e50; border: 2px solid #e0e6ed; margin-bottom: 15px;">
                👁️ View Document Preview
            </button>

            <!-- Hidden Document Preview -->
            <div id="documentPreview" style="display: none; margin-top: 25px; padding: 30px; border: 3px solid #667eea; border-radius: 16px; background: white;">
                <!-- Header Section -->
                <div class="document-preview-header" id="previewHeader">
                    <img id="documentLogo" class="logo-preview" alt="Company Logo" style="display: none; margin: 0 auto 25px auto; max-width: 180px; max-height: 90px;">
                    <h1 style="text-align: center; font-size: 36px; font-weight: 800; color: #2c3e50; margin: 0 0 10px 0; letter-spacing: 3px;" id="previewDocumentTitle">QUOTATION</h1>
                    <p id="previewDocumentNumber" style="text-align: center; color: #7f8c8d; margin: 0 0 30px 0; font-size: 18px;"></p>
                </div>
                
                <!-- Details Section -->
                <div class="document-details-grid">
                    <div class="detail-column">
                        <h4 class="detail-title">FROM:</h4>
                        <div class="detail-box" id="previewCompanyDetails"></div>
                    </div>
                    <div class="detail-column">
                        <h4 class="detail-title">TO:</h4>
                        <div class="detail-box" id="previewCustomerDetails"></div>
                    </div>
                </div>

                <!-- Document Info Section -->
                <div class="document-info-section">
                    <div class="document-info-grid" id="previewInfoGrid">
                        <div class="info-item">
                            <span class="info-label" id="previewDateLabel">Date:</span>
                            <span class="info-value" id="previewDate"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label" id="previewValidLabel">Valid Until:</span>
                            <span class="info-value" id="previewValidUntil"></span>
                        </div>
                    </div>
                </div>

                <!-- Items Table -->
                <table class="document-table">
                    <thead>
                        <tr>
                            <th style="text-align: left; width: 50%;">DESCRIPTION</th>
                            <th style="text-align: center; width: 15%;">QTY</th>
                            <th style="text-align: right; width: 20%;">UNIT PRICE</th>
                            <th style="text-align: right; width: 15%;">TOTAL</th>
                        </tr>
                    </thead>
                    <tbody id="previewLineItems"></tbody>
                </table>

                <!-- Totals Section -->
                <div class="document-totals-section">
                    <div class="totals-rows">
                        <div class="total-row-item">
                            <span class="total-label">Subtotal:</span>
                            <span class="total-value" id="previewSubtotal"></span>
                        </div>
                        <div class="total-row-item">
                            <span class="total-label">Tax:</span>
                            <span class="total-value" id="previewTax"></span>
                        </div>
                        <div class="total-row-item grand-total-row">
                            <span class="total-label">TOTAL:</span>
                            <span class="total-value grand-total-value" id="previewTotal"></span>
                        </div>
                    </div>
                </div>

                <!-- Notes Section -->
                <div id="previewNotes"></div>

                <!-- Payment Info Section (for receipts) -->
                <div id="previewPaymentInfo" style="display: none;"></div>
            </div>
            
            <!-- Back Button -->
            <button type="button" class="btn" onclick="backToDocument()" style="width: 100%; margin-top: 25px; background: #bdc3c7; color: white;">
                ← Back to Edit Document
            </button>
        </section>
    </div>

    <!-- ===== FLOATING ACTION BUTTON ===== -->
    <button class="fab" onclick="addLineItem()" id="fabBtn" aria-label="Add new item">+</button>

    <!-- ===== JAVASCRIPT APPLICATION ===== -->
    <script>
        // ===== APPLICATION STATE MANAGEMENT =====
        let appState = {
            currentDocument: 'quotation',
            lineItemCount: 1,
            companyLogo: null,
            currentPDFBlob: null,
            selectedPaymentMethod: null,
            documentStatus: 'draft', // draft, quote_sent, invoice_sent, paid
            version: '3.0.0'
        };

        // ===== GLOBAL FUNCTIONS =====
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function switchDocument(documentType) {
            appState.currentDocument = documentType;
            
            // Update navigation
            document.querySelectorAll('.document-nav-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[onclick*="'${documentType}'"]`).classList.add('active');
            
            // Update pages
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(documentType + 'Page').classList.add('active');
            
            // Update fab function based on document type
            updateFAB();
            
            showNotification(`Switched to ${documentType} mode`, 'success');
        }

        function updateFAB() {
            const fab = document.getElementById('fabBtn');
            fab.onclick = addLineItem; // All document types can add line items
        }

        // ===== DOCUMENT FUNCTIONS =====
        function addLineItem() {
            appState.lineItemCount++;
            const container = document.getElementById('lineItemsContainer');
            const newItem = document.createElement('div');
            newItem.className = 'line-item';
            newItem.innerHTML = `
                <div class="line-item-header">
                    <span class="item-number">Item #${appState.lineItemCount}</span>
                    <button class="remove-btn" onclick="removeLineItem(this)" aria-label="Remove item">×</button>
                </div>
                <div class="form-group">
                    <label class="form-label">Description *</label>
                    <input type="text" class="form-input item-description" placeholder="Product or service description" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Quantity</label>
                        <input type="number" class="form-input item-quantity" value="1" min="1" step="1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Unit Price *</label>
                        <input type="number" class="form-input item-price" step="0.01" min="0" placeholder="0.00" required>
                    </div>
                </div>
                <div class="total-display item-total">$0.00</div>
            `;
            container.appendChild(newItem);
            
            // Add event listeners
            const inputs = newItem.querySelectorAll('.item-quantity, .item-price');
            inputs.forEach(input => {
                input.addEventListener('input', updateCalculations);
            });

            updateCalculations();
            newItem.querySelector('.item-description').focus();
        }

        function removeLineItem(button) {
            const items = document.querySelectorAll('.line-item');
            if (items.length <= 1) {
                showNotification('Cannot remove the last item', 'error');
                return;
            }
            
            button.closest('.line-item').remove();
            updateCalculations();
            showNotification('Item removed', 'success');
        }

        function updateCalculations() {
            const currency = document.getElementById('currency').value || '$';
            let subtotal = 0;
            
            document.querySelectorAll('.line-item').forEach(item => {
                const quantity = parseFloat(item.querySelector('.item-quantity').value) || 0;
                const price = parseFloat(item.querySelector('.item-price').value) || 0;
                const total = quantity * price;
                subtotal += total;
                
                const totalDisplay = item.querySelector('.item-total');
                if (totalDisplay) {
                    totalDisplay.textContent = `${currency}${total.toFixed(2)}`;
                }
            });
            
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const taxAmount = subtotal * (taxRate / 100);
            const grandTotal = subtotal + taxAmount;
            
            document.getElementById('subtotal').textContent = `${currency}${subtotal.toFixed(2)}`;
            document.getElementById('taxAmount').textContent = `${currency}${taxAmount.toFixed(2)}`;
            document.getElementById('grandTotal').textContent = `${currency}${grandTotal.toFixed(2)}`;
        }

        function validateDocumentData() {
            const companyName = document.getElementById('companyName').value.trim();
            const customerName = document.getElementById('customerName').value.trim();
            
            if (!companyName) {
                showNotification('Please enter company name', 'error');
                document.getElementById('companyName').focus();
                return false;
            }
            
            if (!customerName) {
                showNotification('Please enter customer name', 'error');
                document.getElementById('customerName').focus();
                return false;
            }
            
            const hasValidItems = Array.from(document.querySelectorAll('.line-item')).some(item => {
                const description = item.querySelector('.item-description').value.trim();
                const price = parseFloat(item.querySelector('.item-price').value) || 0;
                return description && price > 0;
            });
            
            if (!hasValidItems) {
                showNotification('Please add at least one item with description and price', 'error');
                return false;
            }
            
            return true;
        }

        function generateDocumentData(docType) {
            // Show logo if available
            if (appState.companyLogo) {
                const documentLogo = document.getElementById('documentLogo');
                documentLogo.src = appState.companyLogo;
                documentLogo.style.display = 'block';
            }
            
            // Update document title and number based on type
            const titleEl = document.getElementById('previewDocumentTitle');
            const numberEl = document.getElementById('previewDocumentNumber');
            const headerEl = document.getElementById('previewHeader');
            
            let docNumber, docTitle;
            
            switch(docType) {
                case 'quotation':
                    docNumber = document.getElementById('quotationNumber').value || 'Q-001';
                    docTitle = 'QUOTATION';
                    headerEl.className = 'document-preview-header';
                    break;
                case 'invoice':
                    docNumber = document.getElementById('invoiceNumber').value || 'INV-001';
                    docTitle = 'INVOICE';
                    headerEl.className = 'document-preview-header invoice';
                    break;
                case 'receipt':
                    docNumber = document.getElementById('receiptNumber').value || 'RCP-001';
                    docTitle = 'RECEIPT';
                    headerEl.className = 'document-preview-header receipt';
                    break;
            }
            
            titleEl.textContent = docTitle;
            numberEl.textContent = `${docTitle.toLowerCase().charAt(0).toUpperCase() + docTitle.toLowerCase().slice(1)} #: ${docNumber}`;
            
            // Format company details
            const companyName = document.getElementById('companyName').value || 'Company Name';
            const companyAddress = document.getElementById('companyAddress').value;
            const companyPhone = document.getElementById('companyPhone').value;
            const companyEmail = document.getElementById('companyEmail').value;
            
            let companyDetails = `<strong>${companyName}</strong>`;
            if (companyAddress) companyDetails += `<br>${companyAddress}`;
            if (companyPhone) companyDetails += `<br>Phone: ${companyPhone}`;
            if (companyEmail) companyDetails += `<br>Email: ${companyEmail}`;
            
            document.getElementById('previewCompanyDetails').innerHTML = companyDetails;
            
            // Format customer details
            const customerName = document.getElementById('customerName').value || 'Customer Name';
            const customerAddress = document.getElementById('customerAddress').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const customerEmail = document.getElementById('customerEmail').value;
            
            let customerDetails = `<strong>${customerName}</strong>`;
            if (customerAddress) customerDetails += `<br>${customerAddress}`;
            if (customerPhone) customerDetails += `<br>Phone: ${customerPhone}`;
            if (customerEmail) customerDetails += `<br>Email: ${customerEmail}`;
            
            document.getElementById('previewCustomerDetails').innerHTML = customerDetails;
            
            // Update info grid based on document type
            const infoGrid = document.getElementById('previewInfoGrid');
            const dateLabel = document.getElementById('previewDateLabel');
            const validLabel = document.getElementById('previewValidLabel');
            const dateValue = document.getElementById('previewDate');
            const validValue = document.getElementById('previewValidUntil');
            
            switch(docType) {
                case 'quotation':
                    dateLabel.textContent = 'Quote Date:';
                    validLabel.textContent = 'Valid Until:';
                    const quoteDate = document.getElementById('quotationDate').value;
                    const validUntil = document.getElementById('validUntil').value;
                    dateValue.textContent = quoteDate ? new Date(quoteDate).toLocaleDateString() : 'Not specified';
                    validValue.textContent = validUntil ? new Date(validUntil).toLocaleDateString() : 'Not specified';
                    break;
                case 'invoice':
                    dateLabel.textContent = 'Invoice Date:';
                    validLabel.textContent = 'Due Date:';
                    const invoiceDate = document.getElementById('invoiceDate').value;
                    const dueDate = document.getElementById('dueDate').value;
                    dateValue.textContent = invoiceDate ? new Date(invoiceDate).toLocaleDateString() : 'Not specified';
                    validValue.textContent = dueDate ? new Date(dueDate).toLocaleDateString() : 'Not specified';
                    break;
                case 'receipt':
                    dateLabel.textContent = 'Payment Date:';
                    validLabel.textContent = 'Transaction ID:';
                    const paymentDate = document.getElementById('paymentDate').value;
                    const transactionId = document.getElementById('transactionId').value;
                    dateValue.textContent = paymentDate ? new Date(paymentDate).toLocaleDateString() : 'Not specified';
                    validValue.textContent = transactionId || 'Not specified';
                    break;
            }
            
            // Generate line items table
            const lineItemsBody = document.getElementById('previewLineItems');
            lineItemsBody.innerHTML = '';
            const currency = document.getElementById('currency').value;
            
            document.querySelectorAll('.line-item').forEach((item, index) => {
                const description = item.querySelector('.item-description').value || `Item ${index + 1}`;
                const quantity = item.querySelector('.item-quantity').value || '1';
                const price = parseFloat(item.querySelector('.item-price').value) || 0;
                const total = parseFloat(quantity) * price;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="text-align: left; font-weight: 500;" data-label="Description">${description}</td>
                    <td style="text-align: center;" data-label="Qty">${quantity}</td>
                    <td style="text-align: right; font-family: monospace;" data-label="Unit Price">${currency}${price.toFixed(2)}</td>
                    <td style="text-align: right; font-weight: 600; font-family: monospace;" data-label="Total">${currency}${total.toFixed(2)}</td>
                `;
                lineItemsBody.appendChild(row);
            });
            
            // Update totals
            document.getElementById('previewSubtotal').textContent = document.getElementById('subtotal').textContent;
            document.getElementById('previewTax').textContent = document.getElementById('taxAmount').textContent;
            document.getElementById('previewTotal').textContent = document.getElementById('grandTotal').textContent;
            
            // Handle notes
            const notes = document.getElementById('notes').value;
            if (notes && notes.trim()) {
                document.getElementById('previewNotes').innerHTML = `
                    <div class="document-notes-section">
                        <div class="notes-title">Terms & Conditions</div>
                        <div class="notes-content">${notes.replace(/\n/g, '<br>')}</div>
                    </div>
                `;
            } else {
                document.getElementById('previewNotes').innerHTML = '';
            }
            
            // Handle payment info for receipts
            const paymentInfo = document.getElementById('previewPaymentInfo');
            if (docType === 'receipt') {
                const paymentMethod = appState.selectedPaymentMethod || 'Not specified';
                const amountPaid = document.getElementById('amountPaid').value || '0.00';
                const paymentNote = document.getElementById('paymentNote').value;
                
                let paymentHtml = `
                    <div class="document-notes-section">
                        <div class="notes-title">Payment Information</div>
                        <div class="notes-content">
                            <strong>Payment Method:</strong> ${paymentMethod}<br>
                            <strong>Amount Paid:</strong> ${currency}${parseFloat(amountPaid).toFixed(2)}
                `;
                
                if (paymentNote) {
                    paymentHtml += `<br><strong>Note:</strong> ${paymentNote}`;
                }
                
                paymentHtml += `</div></div>`;
                paymentInfo.innerHTML = paymentHtml;
                paymentInfo.style.display = 'block';
            } else {
                paymentInfo.style.display = 'none';
            }
        }

        function generatePDF(docType) {
            // Check if jsPDF is loaded
            if (typeof window.jspdf === 'undefined') {
                showNotification('PDF library not loaded. Please refresh the page and try again.', 'error');
                return false;
            }

            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF();
                
                // Get form data
                const companyName = document.getElementById('companyName').value || 'Company Name';
                const customerName = document.getElementById('customerName').value || 'Customer Name';
                const currency = document.getElementById('currency').value;
                
                let docNumber, docTitle, dateField, additionalField;
                
                switch(docType) {
                    case 'quotation':
                        docNumber = document.getElementById('quotationNumber').value || 'Q-001';
                        docTitle = 'QUOTATION';
                        dateField = document.getElementById('quotationDate').value;
                        additionalField = document.getElementById('validUntil').value;
                        break;
                    case 'invoice':
                        docNumber = document.getElementById('invoiceNumber').value || 'INV-001';
                        docTitle = 'INVOICE';
                        dateField = document.getElementById('invoiceDate').value;
                        additionalField = document.getElementById('dueDate').value;
                        break;
                    case 'receipt':
                        docNumber = document.getElementById('receiptNumber').value || 'RCP-001';
                        docTitle = 'RECEIPT';
                        dateField = document.getElementById('paymentDate').value;
                        additionalField = document.getElementById('transactionId').value;
                        break;
                }
                
                let yPosition = 20;
                
                // Add logo if available
                if (appState.companyLogo) {
                    try {
                        pdf.addImage(appState.companyLogo, 'JPEG', 15, yPosition, 40, 20);
                        yPosition += 25;
                    } catch (e) {
                        console.log('Could not add logo to PDF:', e);
                    }
                }
                
                // Title
                pdf.setFontSize(24);
                pdf.setFont('helvetica', 'bold');
                pdf.text(docTitle, 105, yPosition, { align: 'center' });
                yPosition += 15;
                
                // Document number
                pdf.setFontSize(12);
                pdf.setFont('helvetica', 'normal');
                pdf.text(`${docTitle.toLowerCase().charAt(0).toUpperCase() + docTitle.toLowerCase().slice(1)} #: ${docNumber}`, 105, yPosition, { align: 'center' });
                yPosition += 20;
                
                // Company details (left side)
                pdf.setFontSize(10);
                pdf.setFont('helvetica', 'bold');
                pdf.text('FROM:', 20, yPosition);
                pdf.setFont('helvetica', 'normal');
                yPosition += 6;
                
                pdf.text(companyName, 20, yPosition);
                yPosition += 5;
                
                if (document.getElementById('companyAddress').value) {
                    const addressLines = document.getElementById('companyAddress').value.split('\n');
                    addressLines.forEach(line => {
                        pdf.text(line, 20, yPosition);
                        yPosition += 5;
                    });
                }
                
                if (document.getElementById('companyPhone').value) {
                    pdf.text(`Phone: ${document.getElementById('companyPhone').value}`, 20, yPosition);
                    yPosition += 5;
                }
                
                if (document.getElementById('companyEmail').value) {
                    pdf.text(`Email: ${document.getElementById('companyEmail').value}`, 20, yPosition);
                }
                
                // Customer details (right side)
                let customerY = yPosition - 30; // Reset to align with company details
                pdf.setFont('helvetica', 'bold');
                pdf.text('TO:', 120, customerY);
                pdf.setFont('helvetica', 'normal');
                customerY += 6;
                
                pdf.text(customerName, 120, customerY);
                customerY += 5;
                
                if (document.getElementById('customerAddress').value) {
                    const customerAddressLines = document.getElementById('customerAddress').value.split('\n');
                    customerAddressLines.forEach(line => {
                        pdf.text(line, 120, customerY);
                        customerY += 5;
                    });
                }
                
                if (document.getElementById('customerPhone').value) {
                    pdf.text(`Phone: ${document.getElementById('customerPhone').value}`, 120, customerY);
                    customerY += 5;
                }
                
                if (document.getElementById('customerEmail').value) {
                    pdf.text(`Email: ${document.getElementById('customerEmail').value}`, 120, customerY);
                }
                
                yPosition += 25;
                
                // Date information
                pdf.setFontSize(10);
                if (dateField) {
                    const dateLabel = docType === 'quotation' ? 'Date' : 
                                   docType === 'invoice' ? 'Invoice Date' : 'Payment Date';
                    pdf.text(`${dateLabel}: ${new Date(dateField).toLocaleDateString()}`, 20, yPosition);
                }
                if (additionalField) {
                    const additionalLabel = docType === 'quotation' ? 'Valid Until' : 
                                          docType === 'invoice' ? 'Due Date' : 'Transaction ID';
                    const additionalValue = docType === 'receipt' ? additionalField : new Date(additionalField).toLocaleDateString();
                    pdf.text(`${additionalLabel}: ${additionalValue}`, 120, yPosition);
                }
                yPosition += 15;
                
                // Line items table
                pdf.setFontSize(10);
                pdf.setFont('helvetica', 'bold');
                
                // Table headers
                pdf.text('DESCRIPTION', 20, yPosition);
                pdf.text('QTY', 120, yPosition, { align: 'center' });
                pdf.text('UNIT PRICE', 145, yPosition, { align: 'right' });
                pdf.text('TOTAL', 180, yPosition, { align: 'right' });
                
                // Header line
                pdf.line(20, yPosition + 2, 180, yPosition + 2);
                yPosition += 10;
                
                pdf.setFont('helvetica', 'normal');
                
                let subtotal = 0;
                document.querySelectorAll('.line-item').forEach((item, index) => {
                    const description = item.querySelector('.item-description').value || `Item ${index + 1}`;
                    const quantity = item.querySelector('.item-quantity').value || '1';
                    const price = parseFloat(item.querySelector('.item-price').value) || 0;
                    const total = parseFloat(quantity) * price;
                    subtotal += total;
                    
                    // Wrap long descriptions
                    const splitDescription = pdf.splitTextToSize(description, 90);
                    const descriptionHeight = splitDescription.length * 5;
                    
                    pdf.text(splitDescription, 20, yPosition);
                    pdf.text(quantity, 120, yPosition, { align: 'center' });
                    pdf.text(`${currency}${price.toFixed(2)}`, 145, yPosition, { align: 'right' });
                    pdf.text(`${currency}${total.toFixed(2)}`, 180, yPosition, { align: 'right' });
                    
                    yPosition += Math.max(descriptionHeight, 8);
                });
                
                // Totals section
                yPosition += 10;
                pdf.line(120, yPosition, 180, yPosition);
                yPosition += 8;
                
                const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
                const taxAmount = subtotal * (taxRate / 100);
                const grandTotal = subtotal + taxAmount;
                
                pdf.text('Subtotal:', 145, yPosition, { align: 'right' });
                pdf.text(`${currency}${subtotal.toFixed(2)}`, 180, yPosition, { align: 'right' });
                yPosition += 6;
                
                if (taxRate > 0) {
                    pdf.text(`Tax (${taxRate}%):`, 145, yPosition, { align: 'right' });
                    pdf.text(`${currency}${taxAmount.toFixed(2)}`, 180, yPosition, { align: 'right' });
                    yPosition += 6;
                }
                
                pdf.setFont('helvetica', 'bold');
                pdf.text('TOTAL:', 145, yPosition, { align: 'right' });
                pdf.text(`${currency}${grandTotal.toFixed(2)}`, 180, yPosition, { align: 'right' });
                
                // Add payment info for receipts
                if (docType === 'receipt') {
                    yPosition += 15;
                    pdf.setFontSize(10);
                    pdf.setFont('helvetica', 'bold');
                    pdf.text('Payment Information:', 20, yPosition);
                    yPosition += 8;
                    
                    pdf.setFont('helvetica', 'normal');
                    if (appState.selectedPaymentMethod) {
                        pdf.text(`Payment Method: ${appState.selectedPaymentMethod}`, 20, yPosition);
                        yPosition += 5;
                    }
                    
                    const amountPaid = document.getElementById('amountPaid').value;
                    if (amountPaid) {
                        pdf.text(`Amount Paid: ${currency}${parseFloat(amountPaid).toFixed(2)}`, 20, yPosition);
                        yPosition += 5;
                    }
                    
                    const paymentNote = document.getElementById('paymentNote').value;
                    if (paymentNote) {
                        pdf.text(`Note: ${paymentNote}`, 20, yPosition);
                        yPosition += 5;
                    }
                }
                
                // Notes section
                const notes = document.getElementById('notes').value;
                if (notes && notes.trim()) {
                    yPosition += 20;
                    pdf.setFontSize(10);
                    pdf.setFont('helvetica', 'bold');
                    pdf.text('Terms & Conditions:', 20, yPosition);
                    yPosition += 8;
                    
                    pdf.setFont('helvetica', 'normal');
                    const notesLines = pdf.splitTextToSize(notes, 160);
                    notesLines.forEach(line => {
                        pdf.text(line, 20, yPosition);
                        yPosition += 5;
                    });
                }
                
                // Store PDF for sharing
                appState.currentPDFBlob = pdf.output('blob');
                appState.pdfFileName = `${docNumber}_${customerName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                
                return true;
            } catch (error) {
                console.error('PDF generation error:', error);
                showNotification('Error generating PDF. Please try again.', 'error');
                return false;
            }
        }

        function generateAndShowPDF(docType) {
            if (!validateDocumentData()) return;
            
            generateDocumentData(docType);
            
            if (generatePDF(docType)) {
                // Update share view based on document type
                const shareHeader = document.getElementById('shareHeader');
                const shareIcon = document.getElementById('shareIcon');
                const shareTitle = document.getElementById('shareTitle');
                const shareSubtitle = document.getElementById('shareSubtitle');
                const shareNumber = document.getElementById('shareDocumentNumber');
                
                let documentNumber;
                switch(docType) {
                    case 'quotation':
                        documentNumber = document.getElementById('quotationNumber').value || 'Q-001';
                        shareHeader.className = 'document-preview-header';
                        shareIcon.textContent = '📄';
                        shareTitle.textContent = 'Your professional quotation is ready!';
                        shareSubtitle.textContent = 'Choose how you want to share or save your quotation';
                        break;
                    case 'invoice':
                        documentNumber = document.getElementById('invoiceNumber').value || 'INV-001';
                        shareHeader.className = 'document-preview-header invoice';
                        shareIcon.textContent = '🧾';
                        shareTitle.textContent = 'Your professional invoice is ready!';
                        shareSubtitle.textContent = 'Choose how you want to share or save your invoice';
                        break;
                    case 'receipt':
                        documentNumber = document.getElementById('receiptNumber').value || 'RCP-001';
                        shareHeader.className = 'document-preview-header receipt';
                        shareIcon.textContent = '🧾';
                        shareTitle.textContent = 'Your professional receipt is ready!';
                        shareSubtitle.textContent = 'Choose how you want to share or save your receipt';
                        break;
                }
                
                shareNumber.textContent = documentNumber;
                
                document.getElementById('pdfShareView').style.display = 'block';
                document.getElementById('pdfShareView').scrollIntoView({ behavior: 'smooth' });
                
                showNotification(`${docType.charAt(0).toUpperCase() + docType.slice(1)} generated successfully!`, 'success');
                
                // Enable workflow buttons
                updateWorkflowButtons(docType);
            }
        }

        function updateWorkflowButtons(docType) {
            if (docType === 'quotation') {
                document.getElementById('convertToInvoiceBtn').disabled = false;
                appState.documentStatus = 'quote_sent';
            } else if (docType === 'invoice') {
                document.getElementById('generateReceiptBtn').disabled = false;
                appState.documentStatus = 'invoice_sent';
            } else if (docType === 'receipt') {
                appState.documentStatus = 'paid';
            }
        }

        function convertToInvoice() {
            // Copy quotation data to invoice
            const quoteNumber = document.getElementById('quotationNumber').value;
            const quoteDate = document.getElementById('quotationDate').value;
            
            // Generate invoice number based on quote number
            const invoiceNumber = quoteNumber.replace('Q-', 'INV-') || 'INV-001';
            document.getElementById('invoiceNumber').value = invoiceNumber;
            
            // Set invoice date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('invoiceDate').value = today;
            
            // Calculate due date based on payment terms
            const paymentTerms = document.getElementById('paymentTerms').value;
            const dueDate = new Date();
            switch(paymentTerms) {
                case 'net15':
                    dueDate.setDate(dueDate.getDate() + 15);
                    break;
                case 'net30':
                    dueDate.setDate(dueDate.getDate() + 30);
                    break;
                case 'net45':
                    dueDate.setDate(dueDate.getDate() + 45);
                    break;
                case 'net60':
                    dueDate.setDate(dueDate.getDate() + 60);
                    break;
                default:
                    dueDate.setDate(dueDate.getDate() + 30);
            }
            document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];
            
            // Switch to invoice page
            switchDocument('invoice');
            showNotification('Quotation converted to invoice!', 'success');
        }

        function generateReceipt() {
            // Copy invoice data to receipt
            const invoiceNumber = document.getElementById('invoiceNumber').value;
            
            // Generate receipt number based on invoice number
            const receiptNumber = invoiceNumber.replace('INV-', 'RCP-') || 'RCP-001';
            document.getElementById('receiptNumber').value = receiptNumber;
            document.getElementById('referenceInvoice').value = invoiceNumber;
            
            // Set payment date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('paymentDate').value = today;
            
            // Set amount paid to grand total
            const grandTotal = document.getElementById('grandTotal').textContent.replace(/[^0-9.]/g, '');
            document.getElementById('amountPaid').value = grandTotal;
            
            // Generate transaction ID
            const transactionId = 'TXN-' + Date.now().toString().slice(-8);
            document.getElementById('transactionId').value = transactionId;
            
            // Switch to receipt page
            switchDocument('receipt');
            showNotification('Receipt generated from invoice!', 'success');
        }

        function selectPaymentMethod(element, method) {
            document.querySelectorAll('.payment-method').forEach(pm => pm.classList.remove('selected'));
            element.classList.add('selected');
            appState.selectedPaymentMethod = method.charAt(0).toUpperCase() + method.slice(1).replace('_', ' ');
        }

        function downloadPDF() {
            if (!appState.currentPDFBlob) {
                showNotification('No PDF available. Please generate document first.', 'error');
                return;
            }
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(appState.currentPDFBlob);
            link.download = appState.pdfFileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('PDF downloaded successfully!', 'success');
        }

        function sharePDF() {
            if (!appState.currentPDFBlob) {
                showNotification('No PDF available. Please generate document first.', 'error');
                return;
            }
            
            if (navigator.share) {
                const file = new File([appState.currentPDFBlob], appState.pdfFileName, {
                    type: 'application/pdf'
                });
                
                navigator.share({
                    title: 'Business Document PDF',
                    text: `Document: ${appState.pdfFileName}`,
                    files: [file]
                }).catch(err => {
                    console.log('Share failed:', err);
                    downloadPDF(); // Fallback to download
                });
            } else {
                downloadPDF(); // Fallback to download
            }
        }

        function emailPDF() {
            const docType = appState.currentDocument;
            const docNumber = docType === 'quotation' ? 
                            (document.getElementById('quotationNumber').value || 'Q-001') :
                            docType === 'invoice' ?
                            (document.getElementById('invoiceNumber').value || 'INV-001') :
                            (document.getElementById('receiptNumber').value || 'RCP-001');
            
            const subject = encodeURIComponent(`${docType.charAt(0).toUpperCase() + docType.slice(1)} ${docNumber}`);
            const body = encodeURIComponent(`Please find attached the ${docType} for ${document.getElementById('customerName').value || 'your review'}.`);
            window.open(`mailto:?subject=${subject}&body=${body}`, '_blank');
        }

        function printPDF() {
            if (appState.currentPDFBlob) {
                const pdfUrl = URL.createObjectURL(appState.currentPDFBlob);
                const printWindow = window.open(pdfUrl, '_blank');
                if (printWindow) {
                    printWindow.onload = () => {
                        printWindow.print();
                    };
                }
            }
        }

        function togglePreview() {
            const preview = document.getElementById('documentPreview');
            const button = document.getElementById('previewToggleBtn');
            
            if (preview.style.display === 'none') {
                preview.style.display = 'block';
                button.textContent = '👁️ Hide Document Preview';
            } else {
                preview.style.display = 'none';
                button.textContent = '👁️ View Document Preview';
            }
        }

        function backToDocument() {
            document.getElementById('pdfShareView').style.display = 'none';
            document.querySelector('.container').scrollIntoView({ behavior: 'smooth' });
        }

        // ===== LOGO FUNCTIONS =====
        function handleLogoUpload(input) {
            const file = input.files[0];
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                showNotification('Please select a valid image file.', 'error');
                return;
            }

            if (file.size > 5 * 1024 * 1024) { // 5MB limit
                showNotification('Image too large! Please choose a file under 5MB.', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                appState.companyLogo = e.target.result;
                
                const logoPreview = document.getElementById('logoPreview');
                const removeBtn = document.getElementById('logoRemoveBtn');
                
                if (logoPreview) {
                    logoPreview.src = appState.companyLogo;
                    logoPreview.style.display = 'block';
                }
                if (removeBtn) {
                    removeBtn.style.display = 'inline-block';
                }
                
                showNotification('Logo uploaded successfully!', 'success');
            };
            
            reader.onerror = () => {
                showNotification('Error reading file. Please try again.', 'error');
            };
            
            reader.readAsDataURL(file);
        }

        function removeLogo() {
            if (confirm('Remove company logo?')) {
                appState.companyLogo = null;
                
                const logoPreview = document.getElementById('logoPreview');
                const removeBtn = document.getElementById('logoRemoveBtn');
                const uploadInput = document.getElementById('logoUploadInput');
                
                if (logoPreview) {
                    logoPreview.src = '';
                    logoPreview.style.display = 'none';
                }
                if (removeBtn) {
                    removeBtn.style.display = 'none';
                }
                if (uploadInput) {
                    uploadInput.value = '';
                }
                
                showNotification('Logo removed successfully!', 'success');
            }
        }

        // ===== EVENT LISTENERS AND INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 QuoteFlow Pro v3.0.0 Initializing...');
            
            // Set default values for quotation
            const today = new Date().toISOString().split('T')[0];
            const futureDate = new Date();
            futureDate.setDate(futureDate.getDate() + 30);
            
            document.getElementById('quotationDate').value = today;
            document.getElementById('validUntil').value = futureDate.toISOString().split('T')[0];
            document.getElementById('quotationNumber').value = `QFP-${Date.now().toString().slice(-6)}`;
            
            // Set default values for invoice
            document.getElementById('invoiceDate').value = today;
            const invoiceDueDate = new Date();
            invoiceDueDate.setDate(invoiceDueDate.getDate() + 30);
            document.getElementById('dueDate').value = invoiceDueDate.toISOString().split('T')[0];
            document.getElementById('invoiceNumber').value = `INV-${Date.now().toString().slice(-6)}`;
            
            // Set default values for receipt
            document.getElementById('paymentDate').value = today;
            document.getElementById('receiptNumber').value = `RCP-${Date.now().toString().slice(-6)}`;
            document.getElementById('transactionId').value = `TXN-${Date.now().toString().slice(-8)}`;
            
            // Initialize calculations
            updateCalculations();
            
            // Set up auto-calculation listeners
            document.addEventListener('input', function(e) {
                if (e.target.matches('.item-quantity, .item-price, #taxRate')) {
                    updateCalculations();
                }
            });

            // Set up logo upload listener
            document.getElementById('logoUploadInput').addEventListener('change', function() {
                handleLogoUpload(this);
            });

            // Set up payment terms listener
            document.getElementById('paymentTerms').addEventListener('change', function() {
                if (this.value !== 'custom') {
                    const invoiceDate = document.getElementById('invoiceDate').value;
                    if (invoiceDate) {
                        const dueDate = new Date(invoiceDate);
                        switch(this.value) {
                            case 'net15':
                                dueDate.setDate(dueDate.getDate() + 15);
                                break;
                            case 'net30':
                                dueDate.setDate(dueDate.getDate() + 30);
                                break;
                            case 'net45':
                                dueDate.setDate(dueDate.getDate() + 45);
                                break;
                            case 'net60':
                                dueDate.setDate(dueDate.getDate() + 60);
                                break;
                            case 'due_on_receipt':
                                // Due date same as invoice date
                                break;
                        }
                        document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];
                    }
                }
            });

            console.log('✅ QuoteFlow Pro initialized successfully!');
        });
    </script>
</body>
</html>
