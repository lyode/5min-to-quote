<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>QuoteFlow Pro - Business & Health Manager</title>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-card: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
            --border-hover: #cbd5e1;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            --overlay: rgba(15, 23, 42, 0.5);
            
            /* Brand Colors */
            --primary-50: #eff6ff;
            --primary-100: #dbeafe;
            --primary-500: #3b82f6;
            --primary-600: #2563eb;
            --primary-700: #1d4ed8;
            --primary-900: #1e3a8a;
            
            /* Semantic Colors */
            --success-50: #f0fdf4;
            --success-500: #22c55e;
            --success-600: #16a34a;
            
            --warning-50: #fffbeb;
            --warning-500: #f59e0b;
            --warning-600: #d97706;
            
            --danger-50: #fef2f2;
            --danger-500: #ef4444;
            --danger-600: #dc2626;
            
            --medicine-50: #faf5ff;
            --medicine-500: #a855f7;
            --medicine-600: #9333ea;
            --medicine-700: #7c3aed;
        }

        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-color: #334155;
            --border-hover: #475569;
            --overlay: rgba(0, 0, 0, 0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 16px;
            height: 100vh;
            overflow-x: hidden;
            padding-bottom: 90px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Enhanced Header */
        .mobile-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .mobile-header {
            background: rgba(15, 23, 42, 0.95);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 24px;
            min-height: 72px;
        }

        .app-branding {
            flex: 1;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .app-branding:active {
            transform: scale(0.98);
        }

        .app-title {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-600), var(--medicine-600));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 2px;
            letter-spacing: -0.025em;
        }

        .app-slogan {
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .header-btn {
            width: 48px;
            height: 48px;
            border-radius: 16px;
            border: none;
            background: var(--primary-50);
            color: var(--primary-600);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 20px;
            position: relative;
            overflow: hidden;
        }

        .header-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--primary-600);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .header-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .header-btn:active {
            transform: scale(0.95);
        }

        .header-btn:active::before {
            opacity: 0.1;
        }

        [data-theme="dark"] .header-btn {
            background: var(--primary-900);
            color: var(--primary-400);
        }

        /* Enhanced Pages */
        .page {
            display: none;
            margin-top: 72px;
            padding: 24px;
            min-height: calc(100vh - 160px);
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        /* Enhanced Cards */
        .card {
            background: var(--bg-card);
            border-radius: 24px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 24px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
        }

        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .card-header {
            padding: 24px 24px 20px;
            background: linear-gradient(135deg, var(--primary-50), var(--medicine-50));
            border-bottom: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .card-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-500), var(--medicine-500));
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 16px;
            letter-spacing: -0.025em;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            color: white;
            border-radius: 12px;
            font-size: 18px;
            box-shadow: var(--shadow-sm);
        }

        .card-content {
            padding: 24px;
        }

        /* Enhanced Form Elements */
        .form-group {
            margin-bottom: 24px;
            position: relative;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            transition: color 0.2s ease;
        }

        .form-input {
            width: 100%;
            padding: 18px 20px;
            border: 2px solid var(--border-color);
            border-radius: 16px;
            font-size: 16px;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 4px var(--primary-50);
            transform: translateY(-2px);
        }

        .form-input:focus + .form-label {
            color: var(--primary-600);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%233b82f6' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 20px center;
            background-size: 20px;
            padding-right: 60px;
            appearance: none;
            cursor: pointer;
        }

        /* Enhanced Action Buttons */
        .action-btn {
            width: 100%;
            padding: 20px 24px;
            border: none;
            border-radius: 20px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin: 20px 0;
            min-height: 64px;
            position: relative;
            overflow: hidden;
            letter-spacing: -0.025em;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .action-btn:hover::before {
            opacity: 1;
        }

        .action-btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-500), var(--success-600));
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .btn-medicine {
            background: linear-gradient(135deg, var(--medicine-500), var(--medicine-600));
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-medicine:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-500), var(--danger-600));
            color: white;
            box-shadow: var(--shadow-md);
        }

        /* Enhanced Line Items */
        .line-items {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 24px;
            border: 1px solid var(--border-color);
            position: relative;
        }

        .line-item {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            position: relative;
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease;
        }

        .line-item:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .line-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 6px;
            background: linear-gradient(135deg, var(--primary-500), var(--medicine-500));
            border-radius: 0 6px 6px 0;
        }

        .line-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .item-number {
            font-size: 13px;
            font-weight: 700;
            color: var(--primary-600);
            background: var(--primary-50);
            padding: 8px 16px;
            border-radius: 20px;
            letter-spacing: 0.025em;
        }

        .remove-item {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: var(--danger-500);
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
        }

        .remove-item:hover {
            background: var(--danger-600);
            transform: scale(1.05);
        }

        .remove-item:active {
            transform: scale(0.95);
        }

        .item-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .total-display {
            background: linear-gradient(135deg, var(--primary-50), var(--medicine-50));
            border: 2px solid var(--primary-500);
            color: var(--primary-700);
            font-weight: 800;
            text-align: center;
            border-radius: 16px;
            padding: 20px;
            font-size: 20px;
            margin-top: 16px;
            letter-spacing: -0.025em;
        }

        /* Enhanced Totals Card */
        .totals-card {
            background: linear-gradient(135deg, var(--primary-600), var(--medicine-600));
            color: white;
            border-radius: 24px;
            padding: 32px;
            margin: 24px 0;
            box-shadow: var(--shadow-xl);
            position: relative;
            overflow: hidden;
        }

        .totals-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 500;
            position: relative;
        }

        .total-row:last-child {
            margin-bottom: 0;
            border-top: 2px solid rgba(255,255,255,0.2);
            padding-top: 20px;
            font-size: 24px;
            font-weight: 800;
            letter-spacing: -0.025em;
        }

        .tax-input {
            width: 90px;
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.2);
            color: white;
            text-align: center;
            border-radius: 12px;
            padding: 12px;
            font-size: 16px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .tax-input:focus {
            outline: none;
            background: rgba(255,255,255,0.25);
            border-color: rgba(255,255,255,0.4);
        }

        .tax-input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        /* Enhanced Medicine Cards */
        .medicine-card {
            background: var(--bg-card);
            border-radius: 24px;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .medicine-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .medicine-header {
            background: linear-gradient(135deg, var(--medicine-50), var(--primary-50));
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: relative;
        }

        .medicine-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--medicine-500), var(--primary-500));
        }

        .medicine-info {
            flex: 1;
        }

        .medicine-name {
            font-size: 20px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 6px;
            letter-spacing: -0.025em;
        }

        .medicine-dosage {
            font-size: 16px;
            color: var(--medicine-600);
            margin-bottom: 4px;
            font-weight: 600;
        }

        .medicine-instructions {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .medicine-actions {
            display: flex;
            gap: 12px;
        }

        .medicine-btn {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
        }

        .medicine-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .medicine-btn:active {
            transform: scale(0.95);
        }

        .duplicate-medicine { 
            background: linear-gradient(135deg, #06b6d4, #0891b2); 
            color: white; 
        }
        
        .edit-medicine { 
            background: linear-gradient(135deg, var(--warning-500), var(--warning-600)); 
            color: white; 
        }
        
        .delete-medicine { 
            background: linear-gradient(135deg, var(--danger-500), var(--danger-600)); 
            color: white; 
        }

        .medicine-schedule {
            padding: 24px;
        }

        .schedule-item {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }

        .schedule-item:hover {
            border-color: var(--border-hover);
            transform: translateX(4px);
        }

        .schedule-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .schedule-time {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 18px;
            letter-spacing: -0.025em;
        }

        .schedule-status {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--border-color);
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
        }

        .status-indicator.taken { 
            background: linear-gradient(135deg, var(--success-500), var(--success-600)); 
        }
        
        .status-indicator.missed { 
            background: linear-gradient(135deg, var(--danger-500), var(--danger-600)); 
        }
        
        .status-indicator.pending { 
            background: linear-gradient(135deg, var(--warning-500), var(--warning-600)); 
        }

        .take-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            min-width: 80px;
            transition: all 0.2s ease;
            letter-spacing: 0.025em;
        }

        .take-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .take-btn.taken { 
            background: linear-gradient(135deg, var(--success-500), var(--success-600)); 
            color: white; 
        }
        
        .take-btn.pending { 
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600)); 
            color: white; 
        }
        
        .take-btn.missed { 
            background: linear-gradient(135deg, var(--danger-500), var(--danger-600)); 
            color: white; 
        }

        /* Enhanced Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 28px;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 24px 20px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-number {
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 8px;
            letter-spacing: -0.025em;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-taken .stat-number { color: var(--success-600); }
        .stat-taken::before { background: linear-gradient(90deg, var(--success-500), var(--success-600)); }

        .stat-pending .stat-number { color: var(--warning-600); }
        .stat-pending::before { background: linear-gradient(90deg, var(--warning-500), var(--warning-600)); }

        .stat-missed .stat-number { color: var(--danger-600); }
        .stat-missed::before { background: linear-gradient(90deg, var(--danger-500), var(--danger-600)); }

        /* Enhanced Time Selection */
        .time-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .time-input {
            padding: 20px 16px;
            border: 2px solid var(--border-color);
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            background: var(--bg-primary);
            color: var(--text-primary);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .time-input::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--medicine-500), var(--medicine-600));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .time-input:hover {
            border-color: var(--medicine-500);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .time-input.active {
            background: linear-gradient(135deg, var(--medicine-500), var(--medicine-600));
            color: white;
            border-color: var(--medicine-600);
            transform: scale(1.05);
        }

        .time-input.active::before {
            opacity: 1;
        }

        /* Enhanced Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border-color);
            z-index: 1000;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .bottom-nav {
            background: rgba(15, 23, 42, 0.95);
        }

        .nav-container {
            display: flex;
            height: 90px;
            padding: 0 20px;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            background: none;
            color: var(--text-muted);
            border-radius: 20px;
            margin: 8px 4px;
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--primary-50), var(--medicine-50));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .nav-item.active {
            color: var(--primary-600);
            transform: translateY(-4px);
        }

        .nav-item.active::before {
            opacity: 1;
        }

        .nav-item:hover {
            color: var(--primary-500);
        }

        .nav-icon {
            font-size: 28px;
            transition: transform 0.2s ease;
            position: relative;
            z-index: 1;
        }

        .nav-item.active .nav-icon {
            transform: scale(1.1);
        }

        .nav-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            position: relative;
            z-index: 1;
        }

        /* Enhanced FAB */
        .fab {
            position: fixed;
            bottom: 110px;
            right: 24px;
            width: 72px;
            height: 72px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-500), var(--medicine-500));
            color: white;
            border: none;
            font-size: 32px;
            cursor: pointer;
            box-shadow: var(--shadow-xl);
            z-index: 999;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:hover {
            transform: translateY(-6px) scale(1.05);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .fab:active {
            transform: scale(0.95);
        }

        /* Enhanced Drawer */
        .drawer {
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100vh;
            background: var(--bg-card);
            z-index: 1500;
            transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
        }

        .drawer.open {
            right: 0;
        }

        .drawer-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 72px;
            background: linear-gradient(135deg, var(--primary-50), var(--medicine-50));
        }

        .drawer-title {
            font-size: 24px;
            font-weight: 800;
            color: var(--text-primary);
            letter-spacing: -0.025em;
        }

        .close-drawer {
            width: 48px;
            height: 48px;
            border-radius: 16px;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.2s ease;
        }

        .close-drawer:hover {
            background: var(--border-color);
            transform: scale(1.05);
        }

        .drawer-content {
            padding: 24px;
        }

        /* Enhanced Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-card);
            z-index: 1600;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
        }

        .modal.active {
            transform: translateY(0);
        }

        .modal-content {
            padding: 24px;
        }

        /* Enhanced Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--overlay);
            z-index: 1400;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Enhanced Status Message */
        .status-message {
            position: fixed;
            top: 90px;
            left: 24px;
            right: 24px;
            padding: 20px 24px;
            border-radius: 16px;
            font-weight: 600;
            z-index: 2000;
            transform: translateY(-120px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .status-message.show {
            transform: translateY(0);
            opacity: 1;
        }

        .status-message.success {
            background: linear-gradient(135deg, var(--success-500), var(--success-600));
            color: white;
        }

        .status-message.success::before {
            content: '‚úì';
            font-size: 20px;
            font-weight: bold;
        }

        .status-message.error {
            background: linear-gradient(135deg, var(--danger-500), var(--danger-600));
            color: white;
        }

        .status-message.error::before {
            content: '‚ö†';
            font-size: 20px;
            font-weight: bold;
        }

        .status-message.warning {
            background: linear-gradient(135deg, var(--warning-500), var(--warning-600));
            color: white;
        }

        .status-message.warning::before {
            content: '‚ö†';
            font-size: 20px;
            font-weight: bold;
        }

        /* Page Headers */
        .page-header {
            text-align: center;
            margin-bottom: 32px;
            padding: 20px 0;
        }

        .page-title {
            font-size: 32px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary-600), var(--medicine-600));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            letter-spacing: -0.025em;
        }

        .page-subtitle {
            font-size: 16px;
            color: var(--text-muted);
            font-weight: 500;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 24px;
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .empty-description {
            font-size: 16px;
            line-height: 1.5;
        }

        /* Progress Indicators */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin: 16px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-500), var(--medicine-500));
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* Utilities */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }

        .mt-0 { margin-top: 0; }
        .mt-4 { margin-top: 16px; }
        .mt-8 { margin-top: 32px; }
        
        .mb-0 { margin-bottom: 0; }
        .mb-4 { margin-bottom: 16px; }
        .mb-8 { margin-bottom: 32px; }

        /* Dark Theme Toggle */
        .theme-toggle {
            width: 48px;
            height: 48px;
            border-radius: 16px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .header-content {
                padding: 12px 16px;
            }
            
            .page {
                padding: 16px;
            }
            
            .card-content {
                padding: 20px;
            }
            
            .item-row {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .time-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Accessibility Improvements */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Focus States for Accessibility */
        button:focus-visible,
        input:focus-visible,
        select:focus-visible,
        textarea:focus-visible {
            outline: 2px solid var(--primary-500);
            outline-offset: 2px;
        }
    </style>
</head>
<body data-theme="light">
    <!-- Enhanced Header -->
    <div class="mobile-header">
        <div class="header-content">
            <div class="app-branding" onclick="showAppInfo()">
                <div class="app-title">QuoteFlow Pro</div>
                <div class="app-slogan">Business & Health Manager</div>
            </div>
            <div class="header-actions">
                <button class="header-btn theme-toggle" onclick="toggleTheme()" title="Toggle Theme">üåô</button>
                <button class="header-btn" onclick="toggleSettings()" title="Settings">‚öôÔ∏è</button>
            </div>
        </div>
    </div>

    <!-- Enhanced Quotation Page -->
    <div class="page active" id="quotationPage">
        <div class="page-header">
            <div class="page-title">üíº Quotation Builder</div>
            <div class="page-subtitle">Create professional quotes in minutes</div>
        </div>

        <!-- Company Details -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <div class="card-icon">üè¢</div>
                    <span>Your Company</span>
                </div>
            </div>
            <div class="card-content">
                <div class="form-group">
                    <label class="form-label">Company Name *</label>
                    <input type="text" class="form-input" id="companyName" placeholder="Acme Corporation Ltd." required>
                </div>
                <div class="form-group">
                    <label class="form-label">Business Address</label>
                    <textarea class="form-input form-textarea" id="companyAddress" placeholder="123 Business Street&#10;Suite 100&#10;City, State 12345" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Contact Phone</label>
                    <input type="tel" class="form-input" id="companyPhone" placeholder="+1 (555) 123-4567">
                </div>
                <div class="form-group">
                    <label class="form-label">Business Email</label>
                    <input type="email" class="form-input" id="companyEmail" placeholder="contact@company.com">
                </div>
            </div>
        </div>

        <!-- Customer Details -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <div class="card-icon">üë§</div>
                    <span>Customer Information</span>
                </div>
            </div>
            <div class="card-content">
                <div class="form-group">
                    <label class="form-label">Customer Name *</label>
                    <input type="text" class="form-input" id="customerName" placeholder="John Smith / ABC Company" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Customer Address</label>
                    <textarea class="form-input form-textarea" id="customerAddress" placeholder="456 Customer Lane&#10;City, State 54321" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Contact Phone</label>
                    <input type="tel" class="form-input" id="customerPhone" placeholder="+1 (555) 987-6543">
                </div>
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-input" id="customerEmail" placeholder="customer@email.com">
                </div>
            </div>
        </div>

        <!-- Quotation Information -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <div class="card-icon">üìã</div>
                    <span>Quote Details</span>
                </div>
            </div>
            <div class="card-content">
                <div class="form-group">
                    <label class="form-label">Quote Number</label>
                    <input type="text" class="form-input" id="quotationNumber" placeholder="QT-2025-001">
                </div>
                <div class="form-group">
                    <label class="form-label">Quote Date</label>
                    <input type="date" class="form-input" id="quotationDate">
                </div>
                <div class="form-group">
                    <label class="form-label">Valid Until</label>
                    <input type="date" class="form-input" id="validUntil">
                </div>
                <div class="form-group">
                    <label class="form-label">Currency</label>
                    <select class="form-input form-select" id="currency">
                        <option value="$">üá∫üá∏ USD ($)</option>
                        <option value="‚Ç¨">üá™üá∫ EUR (‚Ç¨)</option>
                        <option value="¬£">üá¨üáß GBP (¬£)</option>
                        <option value="¬•">üáØüáµ JPY (¬•)</option>
                        <option value="RM">üá≤üáæ MYR (RM)</option>
                        <option value="‚Çπ">üáÆüá≥ INR (‚Çπ)</option>
                        <option value="CAD">üá®üá¶ CAD</option>
                        <option value="AUD">üá¶üá∫ AUD</option>
                        <option value="CHF">üá®üá≠ CHF</option>
                        <option value="CNY">üá®üá≥ CNY (¬•)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Enhanced Line Items -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <div class="card-icon">üì¶</div>
                    <span>Products & Services</span>
                </div>
            </div>
            <div class="card-content">
                <div class="line-items">
                    <div id="lineItemsContainer">
                        <div class="line-item">
                            <div class="line-item-header">
                                <span class="item-number">Item #1</span>
                                <button class="remove-item" onclick="removeLineItem(this)" title="Remove Item">√ó</button>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Product/Service Description</label>
                                <input type="text" class="form-input item-description" placeholder="Professional consulting services">
                            </div>
                            <div class="item-row">
                                <div class="form-group">
                                    <label class="form-label">Quantity</label>
                                    <input type="number" class="form-input item-quantity" value="1" min="0.01" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Unit Price</label>
                                    <input type="number" class="form-input item-price" step="0.01" min="0" placeholder="100.00">
                                </div>
                            </div>
                            <div class="total-display item-total">$0.00</div>
                        </div>
                    </div>
                    <button type="button" class="action-btn btn-primary" onclick="addLineItem()">
                        <span>‚ûï</span> Add New Item
                    </button>
                </div>

                <!-- Enhanced Totals -->
                <div class="totals-card">
                    <div class="total-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">$0.00</span>
                    </div>
                    <div class="total-row">
                        <label for="taxRate">Tax Rate (%):</label>
                        <div>
                            <input type="number" class="tax-input" id="taxRate" value="0" min="0" max="100" step="0.1" placeholder="0">%
                        </div>
                    </div>
                    <div class="total-row">
                        <span>Tax Amount:</span>
                        <span id="taxAmount">$0.00</span>
                    </div>
                    <div class="total-row">
                        <span>Grand Total:</span>
                        <span id="grandTotal">$0.00</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Notes -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <div class="card-icon">üìù</div>
                    <span>Terms & Additional Notes</span>
                </div>
            </div>
            <div class="card-content">
                <div class="form-group">
                    <label class="form-label">Terms & Conditions / Additional Notes</label>
                    <textarea class="form-input form-textarea" id="notes" placeholder="‚Ä¢ Payment due within 30 days&#10;‚Ä¢ Prices valid for 30 days&#10;‚Ä¢ 50% deposit required to start work&#10;‚Ä¢ Travel expenses not included" rows="5"></textarea>
                </div>
            </div>
        </div>

        <!-- Enhanced Action Buttons -->
        <div style="display: grid; gap: 16px;">
            <button type="button" class="action-btn btn-success" onclick="generateQuotation()">
                <span>üìÑ</span> Generate Quotation
            </button>
            <button type="button" class="action-btn btn-primary" onclick="previewQuotation()">
                <span>üëÅÔ∏è</span> Preview Quote
            </button>
        </div>
    </div>

    <!-- Enhanced Medicine Page -->
    <div class="page" id="medicinePage">
        <div class="page-header">
            <div class="page-title">üíä Medicine Tracker</div>
            <div class="page-subtitle">Never miss your medication again</div>
        </div>
        
        <!-- Enhanced Stats -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <div class="card-icon" style="background: var(--medicine-500);">üìä</div>
                    <span>Today's Progress</span>
                </div>
            </div>
            <div class="card-content">
                <div class="stats-grid">
                    <div class="stat-card stat-taken">
                        <div class="stat-number" id="todayTaken">0</div>
                        <div class="stat-label">Taken</div>
                    </div>
                    <div class="stat-card stat-pending">
                        <div class="stat-number" id="todayPending">0</div>
                        <div class="stat-label">Pending</div>
                    </div>
                    <div class="stat-card stat-missed">
                        <div class="stat-number" id="todayMissed">0</div>
                        <div class="stat-label">Missed</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="medicineProgress" style="width: 0%"></div>
                </div>
                <div class="text-center" style="margin-top: 12px; font-size: 14px; color: var(--text-muted);">
                    <span id="progressText">0% completed today</span>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
            <button type="button" class="action-btn btn-medicine" onclick="showAddMedicineModal()">
                <span>üíä</span> Add Medicine
            </button>
            <button type="button" class="action-btn btn-primary" onclick="markAllTaken()">
                <span>‚úÖ</span> Mark All Taken
            </button>
        </div>

        <!-- Medicine List -->
        <div id="medicineList"></div>
    </div>

    <!-- Enhanced FAB -->
    <button class="fab" onclick="fabAction()" id="fabBtn" title="Quick Add">+</button>

    <!-- Enhanced Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-container">
            <button class="nav-item active" onclick="switchPage('quotation')" title="Quotations">
                <div class="nav-icon">üìã</div>
                <div class="nav-label">Quotes</div>
            </button>
            <button class="nav-item" onclick="switchPage('medicine')" title="Medicine Tracker">
                <div class="nav-icon">üíä</div>
                <div class="nav-label">Medicine</div>
            </button>
        </div>
    </div>

    <!-- Enhanced Settings Drawer -->
    <div class="drawer" id="settingsDrawer">
        <div class="drawer-header">
            <div class="drawer-title">‚öôÔ∏è Settings</div>
            <button class="close-drawer" onclick="toggleSettings()" title="Close Settings">√ó</button>
        </div>
        <div class="drawer-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">üíæ</div>
                        <span>Data Management</span>
                    </div>
                </div>
                <div class="card-content">
                    <button class="action-btn btn-primary" onclick="exportData()">
                        <span>üì§</span> Export All Data
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                    <button class="action-btn btn-primary" onclick="document.getElementById('importFile').click()">
                        <span>üì•</span> Import Data
                    </button>
                    <button class="action-btn btn-danger" onclick="clearAllData()">
                        <span>üóëÔ∏è</span> Clear All Data
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">üé®</div>
                        <span>Appearance</span>
                    </div>
                </div>
                <div class="card-content">
                    <button class="action-btn btn-primary" onclick="toggleTheme()">
                        <span id="themeIcon">üåô</span> <span id="themeText">Switch to Dark Mode</span>
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">‚ÑπÔ∏è</div>
                        <span>About</span>
                    </div>
                </div>
                <div class="card-content">
                    <div style="text-align: center; padding: 16px;">
                        <div style="font-size: 48px; margin-bottom: 16px;">üíºüíä</div>
                        <div style="font-size: 20px; font-weight: 700; margin-bottom: 8px;">QuoteFlow Pro</div>
                        <div style="font-size: 14px; color: var(--text-muted); margin-bottom: 16px;">Version 2.0.0</div>
                        <div style="font-size: 14px; line-height: 1.6; color: var(--text-secondary);">
                            Your all-in-one solution for business quotations and personal health management.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Add Medicine Modal -->
    <div class="modal" id="addMedicineModal">
        <div class="drawer-header">
            <div class="drawer-title">Add New Medicine</div>
            <button class="close-drawer" onclick="closeAddMedicineModal()" title="Close">√ó</button>
        </div>
        <div class="modal-content">
            <div class="form-group">
                <label class="form-label">Medicine Name *</label>
                <input type="text" class="form-input" id="medicineName" placeholder="e.g., Aspirin, Vitamin D3" required>
            </div>
            <div class="form-group">
                <label class="form-label">Dosage & Strength</label>
                <input type="text" class="form-input" id="medicineDosage" placeholder="e.g., 500mg, 1 tablet, 2 capsules">
            </div>
            <div class="form-group">
                <label class="form-label">Instructions</label>
                <input type="text" class="form-input" id="medicineInstructions" placeholder="e.g., With food, On empty stomach, As needed">
            </div>
            <div class="form-group">
                <label class="form-label">Daily Schedule (tap to select times)</label>
                <div class="time-grid" id="timeSlots">
                    <button type="button" class="time-input" onclick="toggleTimeSlot(this, '06:00')">06:00 AM</button>
                    <button type="button" class="time-input" onclick="toggleTimeSlot(this, '08:00')">08:00 AM</button>
                    <button type="button" class="time-input" onclick="toggleTimeSlot(this, '12:00')">12:00 PM</button>
                    <button type="button" class="time-input" onclick="toggleTimeSlot(this, '18:00')">06:00 PM</button>
                    <button type="button" class="time-input" onclick="toggleTimeSlot(this, '22:00')">10:00 PM</button>
                    <button type="button" class="time-input" onclick="addCustomTime()">+ Add Time</button>
                </div>
            </div>
            <button type="button" class="action-btn btn-medicine" onclick="saveMedicine()">
                <span>üíæ</span> Save Medicine
            </button>
        </div>
    </div>

    <!-- Status Message -->
    <div class="status-message" id="statusMessage"></div>

    <!-- Overlay -->
    <div class="overlay" id="overlay" onclick="closeModals()"></div>

    <script>
        // Enhanced App State Management
        class AppStateManager {
            constructor() {
                this.state = {
                    medicines: [],
                    medicineLog: [],
                    selectedTimes: [],
                    lineItemCount: 1,
                    currentPage: 'quotation',
                    theme: 'light',
                    settings: {
                        autoSave: true,
                        notifications: true,
                        currency: '$'
                    }
                };
                this.listeners = [];
            }

            setState(newState) {
                this.state = { ...this.state, ...newState };
                this.notifyListeners();
                this.saveToStorage();
            }

            getState() {
                return { ...this.state };
            }

            subscribe(callback) {
                this.listeners.push(callback);
                return () => {
                    this.listeners = this.listeners.filter(listener => listener !== callback);
                };
            }

            notifyListeners() {
                this.listeners.forEach(callback => callback(this.state));
            }

            saveToStorage() {
                if (this.state.settings.autoSave) {
                    this.saveData();
                }
            }

            // Enhanced Storage Functions
            saveData() {
                try {
                    const data = {
                        // Form data
                        companyName: document.getElementById('companyName')?.value || '',
                        companyAddress: document.getElementById('companyAddress')?.value || '',
                        companyPhone: document.getElementById('companyPhone')?.value || '',
                        companyEmail: document.getElementById('companyEmail')?.value || '',
                        customerName: document.getElementById('customerName')?.value || '',
                        customerAddress: document.getElementById('customerAddress')?.value || '',
                        customerPhone: document.getElementById('customerPhone')?.value || '',
                        customerEmail: document.getElementById('customerEmail')?.value || '',
                        quotationNumber: document.getElementById('quotationNumber')?.value || '',
                        quotationDate: document.getElementById('quotationDate')?.value || '',
                        validUntil: document.getElementById('validUntil')?.value || '',
                        currency: document.getElementById('currency')?.value || '$',
                        notes: document.getElementById('notes')?.value || '',
                        taxRate: document.getElementById('taxRate')?.value || '0',

                        // Line items
                        lineItems: this.getLineItems(),

                        // App state
                        ...this.state,
                        lastSaved: new Date().toISOString()
                    };

                    localStorage.setItem('quoteflow_pro_data', JSON.stringify(data));
                    console.log('Data saved successfully');
                } catch (error) {
                    console.error('Save failed:', error);
                    this.showStatus('Failed to save data', 'error');
                }
            }

            loadData() {
                try {
                    const saved = localStorage.getItem('quoteflow_pro_data');
                    if (!saved) return;

                    const data = JSON.parse(saved);

                    // Load form data
                    const formFields = [
                        'companyName', 'companyAddress', 'companyPhone', 'companyEmail',
                        'customerName', 'customerAddress', 'customerPhone', 'customerEmail',
                        'quotationNumber', 'quotationDate', 'validUntil', 'currency', 'notes', 'taxRate'
                    ];

                    formFields.forEach(field => {
                        const element = document.getElementById(field);
                        if (element && data[field] !== undefined) {
                            element.value = data[field];
                        }
                    });

                    // Load line items
                    if (data.lineItems && data.lineItems.length > 0) {
                        this.loadLineItems(data.lineItems);
                    }

                    // Load app state
                    this.state = {
                        ...this.state,
                        medicines: data.medicines || [],
                        medicineLog: data.medicineLog || [],
                        currentPage: data.currentPage || 'quotation',
                        theme: data.theme || 'light',
                        settings: { ...this.state.settings, ...(data.settings || {}) }
                    };

                    // Apply theme
                    this.applyTheme(this.state.theme);

                    this.updateCalculations();
                    this.updateMedicineDisplay();
                    
                    console.log('Data loaded successfully');
                } catch (error) {
                    console.error('Load failed:', error);
                    this.showStatus('Failed to load data', 'error');
                }
            }

            getLineItems() {
                const items = [];
                document.querySelectorAll('.line-item').forEach(item => {
                    items.push({
                        description: item.querySelector('.item-description')?.value || '',
                        quantity: item.querySelector('.item-quantity')?.value || '1',
                        price: item.querySelector('.item-price')?.value || '0'
                    });
                });
                return items;
            }

            loadLineItems(items) {
                const container = document.getElementById('lineItemsContainer');
                container.innerHTML = '';
                
                items.forEach((item, index) => {
                    this.addLineItemWithData(item, index + 1);
                });
                this.state.lineItemCount = items.length;
            }

            addLineItemWithData(data, itemNumber) {
                const container = document.getElementById('lineItemsContainer');
                const newItem = document.createElement('div');
                newItem.className = 'line-item';
                newItem.innerHTML = `
                    <div class="line-item-header">
                        <span class="item-number">Item #${itemNumber}</span>
                        <button class="remove-item" onclick="appState.removeLineItem(this)" title="Remove Item">√ó</button>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Product/Service Description</label>
                        <input type="text" class="form-input item-description" placeholder="Professional consulting services" value="${data.description}">
                    </div>
                    <div class="item-row">
                        <div class="form-group">
                            <label class="form-label">Quantity</label>
                            <input type="number" class="form-input item-quantity" value="${data.quantity}" min="0.01" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Unit Price</label>
                            <input type="number" class="form-input item-price" step="0.01" min="0" placeholder="100.00" value="${data.price}">
                        </div>
                    </div>
                    <div class="total-display item-total">$0.00</div>
                `;
                
                container.appendChild(newItem);
                
                // Add event listeners
                const quantityInput = newItem.querySelector('.item-quantity');
                const priceInput = newItem.querySelector('.item-price');
                
                [quantityInput, priceInput].forEach(input => {
                    input.addEventListener('input', () => this.updateLineItemTotal(newItem));
                });
                
                this.updateLineItemTotal(newItem);
            }

            updateLineItemTotal(lineItem) {
                const quantity = parseFloat(lineItem.querySelector('.item-quantity').value) || 0;
                const price = parseFloat(lineItem.querySelector('.item-price').value) || 0;
                const total = quantity * price;
                const currency = document.getElementById('currency')?.value || '$';
                
                lineItem.querySelector('.item-total').textContent = `${currency}${total.toFixed(2)}`;
                this.updateCalculations();
            }

            updateCalculations() {
                const currency = document.getElementById('currency')?.value || '$';
                let subtotal = 0;
                
                document.querySelectorAll('.line-item').forEach(item => {
                    const quantity = parseFloat(item.querySelector('.item-quantity')?.value) || 0;
                    const price = parseFloat(item.querySelector('.item-price')?.value) || 0;
                    subtotal += quantity * price;
                });
                
                const taxRate = parseFloat(document.getElementById('taxRate')?.value) || 0;
                const taxAmount = subtotal * (taxRate / 100);
                const grandTotal = subtotal + taxAmount;
                
                const subtotalEl = document.getElementById('subtotal');
                const taxAmountEl = document.getElementById('taxAmount');
                const grandTotalEl = document.getElementById('grandTotal');
                
                if (subtotalEl) subtotalEl.textContent = `${currency}${subtotal.toFixed(2)}`;
                if (taxAmountEl) taxAmountEl.textContent = `${currency}${taxAmount.toFixed(2)}`;
                if (grandTotalEl) grandTotalEl.textContent = `${currency}${grandTotal.toFixed(2)}`;
            }

            // Enhanced Medicine Functions
            updateMedicineDisplay() {
                this.updateMedicineList();
                this.updateTodaysOverview();
                this.updateMedicineProgress();
            }

            updateMedicineList() {
                const container = document.getElementById('medicineList');
                if (!container) return;

                container.innerHTML = '';
                
                if (this.state.medicines.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üíä</div>
                            <div class="empty-title">No medicines added yet</div>
                            <div class="empty-description">Add your first medicine to start tracking your medication schedule</div>
                        </div>
                    `;
                    return;
                }
                
                const today = new Date().toDateString();
                
                this.state.medicines.forEach(medicine => {
                    const medicineCard = document.createElement('div');
                    medicineCard.className = 'medicine-card';
                    
                    const todaysSchedule = this.state.medicineLog.filter(log => 
                        log.medicineId === medicine.id && log.date === today
                    );
                    
                    let scheduleHTML = '';
                    if (todaysSchedule.length === 0) {
                        scheduleHTML = `
                            <div class="empty-state" style="padding: 20px;">
                                <div style="font-size: 24px; margin-bottom: 8px;">üìÖ</div>
                                <div style="font-size: 14px;">No schedule for today</div>
                            </div>
                        `;
                    } else {
                        todaysSchedule.forEach(log => {
                            const statusClass = log.status;
                            const timeFormat = this.formatTime(log.scheduledTime);
                            
                            scheduleHTML += `
                                <div class="schedule-item">
                                    <div class="schedule-header">
                                        <div class="schedule-time">${timeFormat}</div>
                                        <div class="schedule-status">
                                            <div class="status-indicator ${statusClass}"></div>
                                            ${this.getStatusButton(log)}
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                    }
                    
                    medicineCard.innerHTML = `
                        <div class="medicine-header">
                            <div class="medicine-info">
                                <div class="medicine-name">${medicine.name}</div>
                                <div class="medicine-dosage">${medicine.dosage}</div>
                                <div class="medicine-instructions">${medicine.instructions}</div>
                            </div>
                            <div class="medicine-actions">
                                <button class="medicine-btn duplicate-medicine" onclick="appState.duplicateMedicine(${medicine.id})" title="Duplicate">üìã</button>
                                <button class="medicine-btn edit-medicine" onclick="appState.editMedicine(${medicine.id})" title="Edit">‚úèÔ∏è</button>
                                <button class="medicine-btn delete-medicine" onclick="appState.deleteMedicine(${medicine.id})" title="Delete">üóëÔ∏è</button>
                            </div>
                        </div>
                        <div class="medicine-schedule">
                            ${scheduleHTML}
                        </div>
                    `;
                    
                    container.appendChild(medicineCard);
                });
            }

            formatTime(time24) {
                const [hours, minutes] = time24.split(':');
                const hour12 = hours % 12 || 12;
                const ampm = hours >= 12 ? 'PM' : 'AM';
                return `${hour12}:${minutes} ${ampm}`;
            }

            getStatusButton(log) {
                switch (log.status) {
                    case 'pending':
                        return `<button class="take-btn pending" onclick="appState.markMedicineTaken(${log.id})">Take Now</button>`;
                    case 'taken':
                        return `<span style="font-size: 12px; color: var(--success-600); font-weight: 600;">‚úì ${log.actualTime || 'Taken'}</span>`;
                    case 'missed':
                        return `<button class="take-btn missed" onclick="appState.markMedicineTaken(${log.id})">Mark Taken</button>`;
                    default:
                        return '';
                }
            }

            updateTodaysOverview() {
                const today = new Date().toDateString();
                const todaysLog = this.state.medicineLog.filter(log => log.date === today);
                
                const taken = todaysLog.filter(log => log.status === 'taken').length;
                const pending = todaysLog.filter(log => log.status === 'pending').length;
                const missed = todaysLog.filter(log => log.status === 'missed').length;
                
                const takenEl = document.getElementById('todayTaken');
                const pendingEl = document.getElementById('todayPending');
                const missedEl = document.getElementById('todayMissed');
                
                if (takenEl) takenEl.textContent = taken;
                if (pendingEl) pendingEl.textContent = pending;
                if (missedEl) missedEl.textContent = missed;
            }

            updateMedicineProgress() {
                const today = new Date().toDateString();
                const todaysLog = this.state.medicineLog.filter(log => log.date === today);
                
                if (todaysLog.length === 0) {
                    const progressEl = document.getElementById('medicineProgress');
                    const progressTextEl = document.getElementById('progressText');
                    
                    if (progressEl) progressEl.style.width = '0%';
                    if (progressTextEl) progressTextEl.textContent = 'No medications scheduled for today';
                    return;
                }
                
                const taken = todaysLog.filter(log => log.status === 'taken').length;
                const total = todaysLog.length;
                const percentage = Math.round((taken / total) * 100);
                
                const progressEl = document.getElementById('medicineProgress');
                const progressTextEl = document.getElementById('progressText');
                
                if (progressEl) progressEl.style.width = `${percentage}%`;
                if (progressTextEl) progressTextEl.textContent = `${percentage}% completed today (${taken}/${total})`;
            }

            // Enhanced Theme Management
            applyTheme(theme) {
                document.body.setAttribute('data-theme', theme);
                const themeIcon = document.getElementById('themeIcon');
                const themeText = document.getElementById('themeText');
                const headerThemeBtn = document.querySelector('.theme-toggle');
                
                if (theme === 'dark') {
                    if (themeIcon) themeIcon.textContent = '‚òÄÔ∏è';
                    if (themeText) themeText.textContent = 'Switch to Light Mode';
                    if (headerThemeBtn) headerThemeBtn.textContent = '‚òÄÔ∏è';
                } else {
                    if (themeIcon) themeIcon.textContent = 'üåô';
                    if (themeText) themeText.textContent = 'Switch to Dark Mode';
                    if (headerThemeBtn) headerThemeBtn.textContent = 'üåô';
                }
            }

            toggleTheme() {
                const newTheme = this.state.theme === 'light' ? 'dark' : 'light';
                this.setState({ theme: newTheme });
                this.applyTheme(newTheme);
                this.showStatus(`Switched to ${newTheme} mode`, 'success');
            }

            // Enhanced Status Messages
            showStatus(message, type = 'success', duration = 3000) {
                const status = document.getElementById('statusMessage');
                if (!status) return;

                status.textContent = message;
                status.className = `status-message show ${type}`;
                
                setTimeout(() => {
                    status.classList.remove('show');
                }, duration);
            }

            // Line Item Management
            addLineItem() {
                this.state.lineItemCount++;
                this.addLineItemWithData({ description: '', quantity: '1', price: '0' }, this.state.lineItemCount);
                this.showStatus('New item added', 'success');
            }

            removeLineItem(button) {
                const lineItem = button.closest('.line-item');
                lineItem.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    lineItem.remove();
                    this.updateCalculations();
                    this.saveData();
                    this.showStatus('Item removed', 'warning');
                }, 300);
            }

            // Medicine Management
            saveMedicine() {
                const name = document.getElementById('medicineName')?.value.trim();
                const dosage = document.getElementById('medicineDosage')?.value.trim();
                const instructions = document.getElementById('medicineInstructions')?.value.trim() || 'As directed';
                
                if (!name || !dosage || this.state.selectedTimes.length === 0) {
                    this.showStatus('Please fill all required fields and select at least one time', 'error');
                    return;
                }
                
                const medicine = {
                    id: Date.now(),
                    name,
                    dosage,
                    instructions,
                    times: [...this.state.selectedTimes],
                    createdAt: new Date().toISOString()
                };
                
                const newMedicines = [...this.state.medicines, medicine];
                this.setState({ medicines: newMedicines });
                
                this.createTodaysSchedule(medicine);
                this.updateMedicineDisplay();
                
                this.closeAddMedicineModal();
                this.showStatus(`"${name}" added successfully!`, 'success');
            }

            createTodaysSchedule(medicine) {
                const today = new Date().toDateString();
                const newLogEntries = medicine.times.map(time => ({
                    id: Date.now() + Math.random(),
                    medicineId: medicine.id,
                    medicineName: medicine.name,
                    dosage: medicine.dosage,
                    scheduledTime: time,
                    date: today,
                    status: 'pending',
                    actualTime: null
                }));
                
                const updatedLog = [...this.state.medicineLog, ...newLogEntries];
                this.setState({ medicineLog: updatedLog });
            }

            markMedicineTaken(logId) {
                const logEntry = this.state.medicineLog.find(log => log.id === logId);
                if (!logEntry) return;

                const updatedLog = this.state.medicineLog.map(log => {
                    if (log.id === logId) {
                        return {
                            ...log,
                            status: 'taken',
                            actualTime: new Date().toLocaleTimeString('en-US', {
                                hour: '2-digit',
                                minute: '2-digit'
                            })
                        };
                    }
                    return log;
                });

                this.setState({ medicineLog: updatedLog });
                this.updateMedicineDisplay();
                this.showStatus(`${logEntry.medicineName} marked as taken!`, 'success');
            }

            markAllTaken() {
                const today = new Date().toDateString();
                const pendingCount = this.state.medicineLog.filter(log => 
                    log.date === today && log.status === 'pending'
                ).length;

                if (pendingCount === 0) {
                    this.showStatus('No pending medications to mark', 'warning');
                    return;
                }

                const currentTime = new Date().toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const updatedLog = this.state.medicineLog.map(log => {
                    if (log.date === today && log.status === 'pending') {
                        return {
                            ...log,
                            status: 'taken',
                            actualTime: currentTime
                        };
                    }
                    return log;
                });

                this.setState({ medicineLog: updatedLog });
                this.updateMedicineDisplay();
                this.showStatus(`Marked ${pendingCount} medications as taken!`, 'success');
            }

            deleteMedicine(medicineId) {
                const medicine = this.state.medicines.find(m => m.id === medicineId);
                if (!medicine) return;

                if (confirm(`Delete "${medicine.name}"? This will remove all associated logs.`)) {
                    const newMedicines = this.state.medicines.filter(m => m.id !== medicineId);
                    const newLog = this.state.medicineLog.filter(log => log.medicineId !== medicineId);
                    
                    this.setState({ 
                        medicines: newMedicines,
                        medicineLog: newLog
                    });
                    
                    this.updateMedicineDisplay();
                    this.showStatus(`"${medicine.name}" deleted successfully!`, 'warning');
                }
            }

            duplicateMedicine(medicineId) {
                const medicine = this.state.medicines.find(m => m.id === medicineId);
                if (!medicine) return;

                const duplicatedMedicine = {
                    ...medicine,
                    id: Date.now(),
                    name: `${medicine.name} (Copy)`,
                    createdAt: new Date().toISOString()
                };

                const newMedicines = [...this.state.medicines, duplicatedMedicine];
                this.setState({ medicines: newMedicines });
                
                this.createTodaysSchedule(duplicatedMedicine);
                this.updateMedicineDisplay();
                this.showStatus(`"${medicine.name}" duplicated successfully!`, 'success');
            }

            editMedicine(medicineId) {
                const medicine = this.state.medicines.find(m => m.id === medicineId);
                if (!medicine) return;

                // Populate the modal with existing data
                document.getElementById('medicineName').value = medicine.name;
                document.getElementById('medicineDosage').value = medicine.dosage;
                document.getElementById('medicineInstructions').value = medicine.instructions;

                // Reset and set time slots
                this.state.selectedTimes = [...medicine.times];
                document.querySelectorAll('#timeSlots .time-input').forEach(btn => {
                    btn.classList.remove('active');
                    const time = btn.textContent.includes(':') ? btn.textContent.split(' ')[0] : btn.onclick.toString().match(/'(\d{2}:\d{2})'/)?.[1];
                    if (time && medicine.times.includes(time)) {
                        btn.classList.add('active');
                    }
                });

                // Store the ID for updating instead of creating
                this.editingMedicineId = medicineId;
                
                this.showAddMedicineModal();
            }

            // Page Management
            switchPage(page) {
                this.setState({ currentPage: page });
                
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById(page + 'Page')?.classList.add('active');
                
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                document.querySelector(`[onclick*="'${page}'"]`)?.classList.add('active');
                
                this.updateFAB();
                
                if (page === 'medicine') {
                    this.updateMedicineDisplay();
                }
            }

            updateFAB() {
                const fab = document.getElementById('fabBtn');
                if (!fab) return;

                fab.innerHTML = this.state.currentPage === 'quotation' ? '‚ûï' : 'üíä';
                fab.title = this.state.currentPage === 'quotation' ? 'Add Line Item' : 'Add Medicine';
            }

            // Enhanced Export/Import
            exportData() {
                try {
                    this.saveData();
                    const data = localStorage.getItem('quoteflow_pro_data');
                    const blob = new Blob([data], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `quoteflow-pro-backup-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    this.showStatus('Data exported successfully!', 'success');
                } catch (error) {
                    console.error('Export failed:', error);
                    this.showStatus('Export failed!', 'error');
                }
            }

            importData(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = e.target.result;
                        JSON.parse(data); // Validate JSON
                        localStorage.setItem('quoteflow_pro_data', data);
                        this.showStatus('Data imported successfully! Reloading...', 'success');
                        setTimeout(() => location.reload(), 1500);
                    } catch (error) {
                        console.error('Import failed:', error);
                        this.showStatus('Import failed! Invalid file format.', 'error');
                    }
                };
                reader.readAsText(file);
                
                // Reset file input
                event.target.value = '';
            }

            clearAllData() {
                if (confirm('‚ö†Ô∏è WARNING: This will delete ALL your data permanently!\n\nThis includes:\n‚Ä¢ All quotations and customer data\n‚Ä¢ All medicines and medication logs\n‚Ä¢ All settings and preferences\n\nThis action cannot be undone. Are you sure?')) {
                    localStorage.removeItem('quoteflow_pro_data');
                    this.showStatus('All data cleared! Reloading...', 'warning');
                    setTimeout(() => location.reload(), 1500);
                }
            }
        }

        // Initialize App State
        const appState = new AppStateManager();

        // Enhanced UI Functions
        function showAddMedicineModal() {
            appState.state.selectedTimes = [];
            appState.editingMedicineId = null;
            
            document.getElementById('medicineName').value = '';
            document.getElementById('medicineDosage').value = '';
            document.getElementById('medicineInstructions').value = '';
            
            document.querySelectorAll('#timeSlots .time-input').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById('addMedicineModal').classList.add('active');
            document.getElementById('overlay').classList.add('active');
        }

        function closeAddMedicineModal() {
            document.getElementById('addMedicineModal').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }

        function toggleTimeSlot(button, time) {
            if (appState.state.selectedTimes.includes(time)) {
                appState.state.selectedTimes = appState.state.selectedTimes.filter(t => t !== time);
                button.classList.remove('active');
            } else {
                appState.state.selectedTimes.push(time);
                button.classList.add('active');
            }
        }

        function addCustomTime() {
            const time = prompt('Enter time in 24-hour format (HH:MM, e.g., 14:30):');
            if (time && /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(time)) {
                const timeSlots = document.getElementById('timeSlots');
                const customBtn = timeSlots.querySelector('button:last-child');
                
                const newBtn = document.createElement('button');
                newBtn.type = 'button';
                newBtn.className = 'time-input';
                newBtn.textContent = appState.formatTime(time);
                newBtn.onclick = () => toggleTimeSlot(newBtn, time);
                
                timeSlots.insertBefore(newBtn, customBtn);
                toggleTimeSlot(newBtn, time);
            } else if (time) {
                appState.showStatus('Invalid time format! Use HH:MM (e.g., 14:30)', 'error');
            }
        }

        function toggleSettings() {
            const drawer = document.getElementById('settingsDrawer');
            const overlay = document.getElementById('overlay');
            const isOpen = drawer.classList.contains('open');
            
            if (isOpen) {
                drawer.classList.remove('open');
                overlay.classList.remove('active');
            } else {
                drawer.classList.add('open');
                overlay.classList.add('active');
            }
        }

        function closeModals() {
            document.getElementById('settingsDrawer').classList.remove('open');
            document.getElementById('addMedicineModal').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }

        function showAppInfo() {
            appState.showStatus('QuoteFlow Pro - Your Business & Health Manager', 'success', 2000);
        }

        function generateQuotation() {
            const requiredFields = ['companyName', 'customerName'];
            const missingFields = [];
            
            requiredFields.forEach(field => {
                const element = document.getElementById(field);
                if (!element?.value.trim()) {
                    missingFields.push(field.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase()));
                }
            });
            
            if (missingFields.length > 0) {
                appState.showStatus(`Please fill required fields: ${missingFields.join(', ')}`, 'error');
                return;
            }
            
            const lineItems = document.querySelectorAll('.line-item');
            if (lineItems.length === 0 || !Array.from(lineItems).some(item => 
                item.querySelector('.item-description')?.value.trim()
            )) {
                appState.showStatus('Please add at least one product or service', 'error');
                return;
            }
            
            appState.saveData();
            appState.showStatus('‚úÖ Quotation generated successfully!', 'success');
        }

        function previewQuotation() {
            appState.showStatus('Preview feature coming soon!', 'warning');
        }

        // Global function wrappers for backward compatibility
        function switchPage(page) { appState.switchPage(page); }
        function fabAction() { 
            if (appState.state.currentPage === 'quotation') {
                appState.addLineItem();
            } else {
                showAddMedicineModal();
            }
        }
        function addLineItem() { appState.addLineItem(); }
        function removeLineItem(button) { appState.removeLineItem(button); }
        function saveMedicine() { appState.saveMedicine(); }
        function markMedicineTaken(logId) { appState.markMedicineTaken(logId); }
        function markAllTaken() { appState.markAllTaken(); }
        function deleteMedicine(medicineId) { appState.deleteMedicine(medicineId); }
        function duplicateMedicine(medicineId) { appState.duplicateMedicine(medicineId); }
        function editMedicine(medicineId) { appState.editMedicine(medicineId); }
        function toggleTheme() { appState.toggleTheme(); }
        function exportData() { appState.exportData(); }
        function importData(event) { appState.importData(event); }
        function clearAllData() { appState.clearAllData(); }

        // Enhanced Auto-save
        function setupAutoSave() {
            let saveTimeout;
            
            const debouncedSave = () => {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => appState.saveData(), 1000);
            };
            
            document.addEventListener('input', debouncedSave);
            document.addEventListener('change', debouncedSave);
        }

        // Enhanced Initialization
        function initApp() {
            console.log('üöÄ Initializing QuoteFlow Pro...');
            
            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            const futureDate = new Date();
            futureDate.setDate(futureDate.getDate() + 30);
            
            const quotationDate = document.getElementById('quotationDate');
            const validUntil = document.getElementById('validUntil');
            
            if (quotationDate) quotationDate.value = today;
            if (validUntil) validUntil.value = futureDate.toISOString().split('T')[0];
            
            // Generate default quote number
            const quotationNumber = document.getElementById('quotationNumber');
            if (quotationNumber && !quotationNumber.value) {
                quotationNumber.value = `QT-${new Date().getFullYear()}-${String(Date.now()).slice(-6)}`;
            }
            
            // Load saved data
            appState.loadData();
            
            // Setup auto-save
            setupAutoSave();
            
            // Apply current page
            if (appState.state.currentPage) {
                switchPage(appState.state.currentPage);
            }
            
            // Setup calculation event listeners
            document.addEventListener('input', (e) => {
                if (e.target.matches('.item-quantity, .item-price, #taxRate')) {
                    if (e.target.matches('.item-quantity, .item-price')) {
                        const lineItem = e.target.closest('.line-item');
                        if (lineItem) appState.updateLineItemTotal(lineItem);
                    } else {
                        appState.updateCalculations();
                    }
                }
            });
            
            // Check for missed medications
            setTimeout(() => {
                const today = new Date().toDateString();
                const currentTime = new Date();
                const currentHour = currentTime.getHours();
                const currentMinute = currentTime.getMinutes();
                
                const updatedLog = appState.state.medicineLog.map(log => {
                    if (log.date === today && log.status === 'pending') {
                        const [schedHour, schedMinute] = log.scheduledTime.split(':').map(Number);
                        const scheduledTime = schedHour * 60 + schedMinute;
                        const currentTimeMinutes = currentHour * 60 + currentMinute;
                        
                        // Mark as missed if scheduled time was more than 2 hours ago
                        if (currentTimeMinutes - scheduledTime > 120) {
                            return { ...log, status: 'missed' };
                        }
                    }
                    return log;
                });
                
                if (JSON.stringify(updatedLog) !== JSON.stringify(appState.state.medicineLog)) {
                    appState.setState({ medicineLog: updatedLog });
                    appState.updateMedicineDisplay();
                }
            }, 1000);
            
            console.log('‚úÖ QuoteFlow Pro initialized successfully!');
            appState.showStatus('Welcome to QuoteFlow Pro! üöÄ', 'success');
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
        
        // Save data before page unload
        window.addEventListener('beforeunload', () => appState.saveData());
        
        // Handle visibility change to save data when app goes to background
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                appState.saveData();
            }
        });
    </script>
</body>
</html>
